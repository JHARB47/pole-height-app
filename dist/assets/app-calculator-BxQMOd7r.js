const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/app-geodata-OF3I9fsg.js","assets/zip-utils-BoTj1NZG.js","assets/polyfills-CELajPCl.js","assets/app-utils-BDwnIIkN.js","assets/app-calculations-BTm-MLQ7.js","assets/state-vendor-C5Drl_aA.js","assets/react-CcDwFy_c.js","assets/react-dom-CAPYOVrm.js","assets/vendor-Cv8-97MN.js","assets/app-permits-Dftu4pdj.js"])))=>i.map(i=>d[i]);
import{R as L,j as e,r as tt,u as Mt}from"./react-CcDwFy_c.js";import{P as Ce}from"./vendor-Cv8-97MN.js";import{u as ne,v as Ut,W as Bt,d as Pt,b as st,c as nt}from"./app-utils-BDwnIIkN.js";import{p as Oe,f as Qe,c as jt,D as bt,a as ut,b as pt,d as Vt,r as Gt}from"./app-calculations-BTm-MLQ7.js";import{S as Jt,E as zt}from"./app-editors-DF1OQL1O.js";import{S as vt}from"./app-diagrams-CPhSrkc4.js";import{M as ft,p as Zt,a as Kt,b as qt,c as Wt,d as Yt,i as Xt,s as Qt,g as St,m as es,E as ts,e as ss,f as ns,h as as,j as is,k as ls,l as rs}from"./app-io-D6-Ks0MZ.js";import{m as kt}from"./app-permits-Dftu4pdj.js";const os="modulepreload",cs=function(t){return"/"+t},Ct={},he=function(u,s,p){let c=Promise.resolve();if(s&&s.length>0){let P=function(S){return Promise.all(S.map(T=>Promise.resolve(T).then(j=>({status:"fulfilled",value:j}),j=>({status:"rejected",reason:j}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),m=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));c=P(s.map(S=>{if(S=cs(S),S in Ct)return;Ct[S]=!0;const T=S.endsWith(".css"),j=T?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${S}"]${j}`))return;const C=document.createElement("link");if(C.rel=T?"stylesheet":os,T||(C.as="script"),C.crossOrigin="",C.href=S,m&&C.setAttribute("nonce",m),document.head.appendChild(C),T)return new Promise((N,K)=>{C.addEventListener("load",N),C.addEventListener("error",()=>K(new Error(`Unable to preload CSS for ${S}`)))})}))}function b(r){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=r,window.dispatchEvent(m),!m.defaultPrevented)throw r}return c.then(r=>{for(const m of r||[])m.status==="rejected"&&b(m.reason);return u().catch(b)})},ds=L.lazy(()=>he(()=>Promise.resolve().then(()=>As),void 0));function ms(){return e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading calculator..."})]})}function Us(t){return e.jsx(tt.Suspense,{fallback:e.jsx(ms,{}),children:e.jsx(ds,{...t})})}function Lt(t,u=500){const[s,p]=tt.useState(t);return tt.useEffect(()=>{const c=setTimeout(()=>{p(t)},u);return()=>{clearTimeout(c)}},[t,u]),s}function us(){var it;const{poleHeight:t,poleClass:u,setPoleHeight:s,setPoleClass:p,jobs:c,currentJobId:b,setCurrentJobId:r,existingPowerHeight:m,existingPowerVoltage:P,setExistingPowerHeight:S,setExistingPowerVoltage:T,spanDistance:j,isNewConstruction:C,setIsNewConstruction:N,adjacentPoleHeight:K,attachmentType:Q,cableDiameter:O,windSpeed:V,spanEnvironment:D,streetLightHeight:Z,dripLoopHeight:q,proposedLineHeight:F,existingLines:h,iceThicknessIn:z,hasTransformer:H,setHasTransformer:o,powerReference:J,setPowerReference:W,setDripLoopHeight:X,setStreetLightHeight:a,setMakeReadyNotes:l,setAnalysis:d,setSpanDistance:k,setAdjacentPoleHeight:le,setAttachmentType:ue,setCableDiameter:Ee,setWindSpeed:De,setIceThicknessIn:_e,setSpanEnvironment:Re,setProposedLineHeight:Ke,presetProfile:Me,setPresetProfile:qe,customMinTopSpace:Ue,setCustomMinTopSpace:We,customRoadClearance:Be,setCustomRoadClearance:Ve,customCommToPower:Ge,setCustomCommToPower:Ye,useTickMarkFormat:i,setUseTickMarkFormat:x,projectName:E,setProjectName:y,applicantName:A,setApplicantName:U,jobNumber:R,setJobNumber:g,jobOwner:M,setJobOwner:re,submissionProfiles:w,currentSubmissionProfile:_,setCurrentSubmissionProfile:f,poleLatitude:v,setPoleLatitude:I,poleLongitude:Y,setPoleLongitude:se}=ne(Mt(n=>({poleHeight:n.poleHeight,poleClass:n.poleClass,setPoleHeight:n.setPoleHeight,setPoleClass:n.setPoleClass,jobs:n.jobs,currentJobId:n.currentJobId,setCurrentJobId:n.setCurrentJobId,existingPowerHeight:n.existingPowerHeight,existingPowerVoltage:n.existingPowerVoltage,setExistingPowerHeight:n.setExistingPowerHeight,setExistingPowerVoltage:n.setExistingPowerVoltage,spanDistance:n.spanDistance,isNewConstruction:n.isNewConstruction,setIsNewConstruction:n.setIsNewConstruction,adjacentPoleHeight:n.adjacentPoleHeight,attachmentType:n.attachmentType,cableDiameter:n.cableDiameter,windSpeed:n.windSpeed,spanEnvironment:n.spanEnvironment,streetLightHeight:n.streetLightHeight,dripLoopHeight:n.dripLoopHeight,proposedLineHeight:n.proposedLineHeight,existingLines:n.existingLines,iceThicknessIn:n.iceThicknessIn,hasTransformer:n.hasTransformer,setHasTransformer:n.setHasTransformer,powerReference:n.powerReference,setPowerReference:n.setPowerReference,setDripLoopHeight:n.setDripLoopHeight,setStreetLightHeight:n.setStreetLightHeight,setAnalysis:n.setAnalysis,setMakeReadyNotes:n.setMakeReadyNotes,setSpanDistance:n.setSpanDistance,setAdjacentPoleHeight:n.setAdjacentPoleHeight,setAttachmentType:n.setAttachmentType,setCableDiameter:n.setCableDiameter,setWindSpeed:n.setWindSpeed,setIceThicknessIn:n.setIceThicknessIn,setSpanEnvironment:n.setSpanEnvironment,setProposedLineHeight:n.setProposedLineHeight,presetProfile:n.presetProfile,setPresetProfile:n.setPresetProfile,customMinTopSpace:n.customMinTopSpace,setCustomMinTopSpace:n.setCustomMinTopSpace,customRoadClearance:n.customRoadClearance,setCustomRoadClearance:n.setCustomRoadClearance,customCommToPower:n.customCommToPower,setCustomCommToPower:n.setCustomCommToPower,useTickMarkFormat:n.useTickMarkFormat,setUseTickMarkFormat:n.setUseTickMarkFormat,projectName:n.projectName,setProjectName:n.setProjectName,applicantName:n.applicantName,setApplicantName:n.setApplicantName,jobNumber:n.jobNumber,setJobNumber:n.setJobNumber,jobOwner:n.jobOwner,setJobOwner:n.setJobOwner,submissionProfiles:n.submissionProfiles,currentSubmissionProfile:n.currentSubmissionProfile,setCurrentSubmissionProfile:n.setCurrentSubmissionProfile,poleLatitude:n.poleLatitude,setPoleLatitude:n.setPoleLatitude,poleLongitude:n.poleLongitude,setPoleLongitude:n.setPoleLongitude}))),[me,xe]=L.useState(!1),[de,ae]=L.useState(!1),[be,B]=L.useState(!1),[Ae,mt]=L.useState(null),[at,ht]=L.useState("job"),[te,Te]=L.useState(()=>{try{const n=localStorage.getItem("ppw:openSections");return n?JSON.parse(n):{job:!0,map:!0,spans:!0,existing:!0,field:!0,results:!0}}catch{return{job:!0,map:!0,spans:!0,existing:!0,field:!0,results:!0}}});tt.useEffect(()=>{try{localStorage.setItem("ppw:openSections",JSON.stringify(te))}catch{}},[te]),tt.useEffect(()=>{const oe=["job","map","spans","existing","field","results"].map(ye=>document.getElementById(ye)).filter(Boolean);if(!oe.length)return;const ve=new IntersectionObserver(ye=>{var Le,lt;const we=ye.filter(ke=>ke.isIntersecting).sort((ke,ot)=>ke.boundingClientRect.top-ot.boundingClientRect.top);(lt=(Le=we[0])==null?void 0:Le.target)!=null&&lt.id&&ht(we[0].target.id)},{rootMargin:"-40% 0px -55% 0px",threshold:[0,.25,.5,.75,1]});return oe.forEach(ye=>ye&&ve.observe(ye)),()=>ve.disconnect()},[me,de]),tt.useEffect(()=>{const n=h.filter(oe=>oe.makeReady&&oe.makeReadyHeight&&oe.height).map(oe=>{const ve=Le=>Qe(Oe(Le)),ye=(Oe(oe.makeReadyHeight)-Oe(oe.height))*12,we=Math.abs(Math.round(ye))*12.5;return`LWR (${oe.companyName||oe.type}) FROM ${ve(oe.height)} TO ${ve(oe.makeReadyHeight)} - Est. Cost: $${we}`});l(n.join(`
`))},[h,l]),tt.useEffect(()=>{const n=(ne.getState().jobs||[]).find(ct=>ct.id===ne.getState().currentJobId),oe=(n==null?void 0:n.submissionProfileName)||_,ve=(w||[]).find(ct=>ct.name===oe),ye=ve?{...ve,...(n==null?void 0:n.submissionProfileOverrides)||{}}:void 0,{results:we,warnings:Le,notes:lt,cost:ke,errors:ot}=jt({poleHeight:t,poleClass:u,poleLatitude:v,poleLongitude:Y,existingPowerHeight:m,existingPowerVoltage:P,spanDistance:j,isNewConstruction:C,adjacentPoleHeight:K,attachmentType:Q,cableDiameter:O,windSpeed:V,spanEnvironment:D,streetLightHeight:Z,dripLoopHeight:q,proposedLineHeight:F,existingLines:h,iceThicknessIn:z,hasTransformer:H,presetProfile:Me,customMinTopSpace:Ue,customRoadClearance:Be,customCommToPower:Ge,powerReference:J,jobOwner:M,submissionProfile:ye});if(ot){d({results:null,warnings:[],notes:[],cost:null});return}d({results:we,warnings:Le,notes:lt,cost:ke})},[t,u,v,Y,m,P,j,C,K,Q,O,V,D,Z,q,F,h,z,H,Me,Ue,Be,Ge,J,M,w,_,d]);const[ce,Je]=L.useState({valid:!0,errors:[],warnings:[]}),[ze,Pe]=L.useState(!1),Se=Lt(v,300),Xe=Lt(Y,300);L.useEffect(()=>{if(Se||Xe){Pe(!0);const n=Ut({latitude:Se,longitude:Xe});Je(n),Pe(!1)}else Je({valid:!0,errors:[],warnings:[]}),Pe(!1)},[Se,Xe]);const rt=async()=>{if(!("geolocation"in navigator)){alert("Geolocation is not supported by this browser.");return}try{const n=await new Promise((ye,we)=>{navigator.geolocation.getCurrentPosition(ye,we,{enableHighAccuracy:!0,timeout:1e4})}),{latitude:oe,longitude:ve}=n.coords||{};oe!=null&&ve!=null&&(I(oe.toFixed(6)),se(ve.toFixed(6)))}catch(n){alert(`Failed to get location: ${n instanceof Error?n.message:String(n)}`)}};return e.jsxs("div",{className:"p-3 md:p-4 space-y-4",children:[e.jsx("nav",{className:"workflow-nav no-print",children:e.jsx("div",{className:"mx-auto max-w-6xl px-3 md:px-6 flex items-center gap-1 overflow-x-auto",children:[{id:"job",label:"Job"},{id:"map",label:"Import/Map"},{id:"spans",label:"Spans"},{id:"existing",label:"Existing Lines"},{id:"field",label:"Field"},{id:"results",label:"Results"}].map((n,oe,ve)=>e.jsxs(L.Fragment,{children:[e.jsx("a",{href:`#${n.id}`,"aria-current":at===n.id?"step":void 0,className:"px-2 py-1 rounded whitespace-nowrap "+(at===n.id?"bg-blue-50 text-blue-700 font-semibold":"text-gray-700 hover:bg-gray-50"),children:n.label}),oe<ve.length-1?e.jsx("span",{className:"text-gray-300",children:"â€¢"}):null]},n.id))})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-lg md:text-xl font-semibold",children:"PolePlan Pro"}),e.jsx("span",{className:"hidden sm:inline text-xs text-gray-600",children:"Job:"}),e.jsxs("select",{className:"hidden sm:inline text-sm border rounded px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:b||"",onChange:n=>r(n.target.value),children:[e.jsx("option",{value:"",children:"-- None --"}),(c||[]).map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]}),e.jsxs("div",{className:"text-xs text-gray-600 hidden sm:block",children:["Click"," ",e.jsx("button",{className:"text-blue-600 hover:text-blue-800 underline",onClick:()=>B(!0),children:"Here"})," ","for Use Directions"]})]}),e.jsx("div",{id:"job",className:"anchor-offset"}),!me&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 no-print app-section",children:[e.jsxs("div",{className:"flex items-start justify-between md:col-span-2 xl:col-span-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"section-title",children:"Job Setup"}),e.jsx("div",{className:"section-subtitle",children:"Project info, GPS, design parameters, and profiles."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{sectionKey:"job",align:"right"}),e.jsx("button",{type:"button",className:"ml-2 px-3 py-2 text-sm border rounded bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors",onClick:()=>Te(n=>({...n,job:!n.job})),"aria-expanded":!!te.job,children:te.job?"Collapse":"Expand"})]})]}),te.job?e.jsxs(e.Fragment,{children:[e.jsx(et,{section:"job"}),e.jsx(fe,{label:"Project Name",value:E,onChange:n=>y(n.target.value)}),e.jsx(fe,{label:"Applicant",value:A,onChange:n=>U(n.target.value)}),e.jsx(fe,{label:"Job #",value:R,onChange:n=>g(n.target.value)}),e.jsx(Fs,{}),e.jsxs("div",{className:"md:col-span-2 xl:col-span-3 grid grid-cols-1 lg:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg border",children:[e.jsx(fe,{label:"Pole Latitude",value:v,onChange:n=>I(n.target.value),placeholder:"e.g., 40.123456"}),e.jsxs("div",{className:"grid grid-cols-[1fr_auto] gap-3 items-end",children:[e.jsx(fe,{label:"Pole Longitude",value:Y,onChange:n=>se(n.target.value),placeholder:"e.g., -82.987654"}),e.jsx("button",{type:"button",className:"h-11 px-4 border rounded text-sm bg-blue-50 hover:bg-blue-100 border-blue-300 text-blue-700 font-medium whitespace-nowrap",onClick:rt,title:"Use device GPS",children:"Use GPS"})]}),(v||Y)&&e.jsxs("div",{className:"md:col-span-2",children:[ze&&e.jsx("div",{className:"p-2 bg-blue-50 border border-blue-300 rounded text-sm",children:e.jsxs("div",{className:"font-medium text-blue-800 flex items-center gap-1",children:[e.jsx("span",{className:"animate-pulse",children:"ðŸ”„"})," Validating coordinates..."]})}),!ze&&!ce.valid&&ce.errors.length>0&&e.jsxs("div",{className:"p-2 bg-red-50 border border-red-300 rounded text-sm",children:[e.jsxs("div",{className:"font-medium text-red-800 flex items-center gap-1",children:[e.jsx("span",{children:"âŒ"})," Invalid Coordinates"]}),e.jsx("ul",{className:"mt-1 text-red-700 list-disc pl-5",children:ce.errors.map((n,oe)=>e.jsx("li",{children:n},oe))})]}),!ze&&ce.valid&&ce.warnings&&ce.warnings.length>0&&e.jsxs("div",{className:"p-2 bg-yellow-50 border border-yellow-300 rounded text-sm",children:[e.jsxs("div",{className:"font-medium text-yellow-800 flex items-center gap-1",children:[e.jsx("span",{children:"âš ï¸"})," Warning"]}),e.jsx("ul",{className:"mt-1 text-yellow-700 list-disc pl-5",children:ce.warnings.map((n,oe)=>e.jsx("li",{children:n},oe))})]}),!ze&&ce.valid&&(!ce.warnings||ce.warnings.length===0)&&e.jsxs("div",{className:"p-2 bg-green-50 border border-green-300 rounded text-sm",children:[e.jsxs("div",{className:"font-medium text-green-800 flex items-center gap-1",children:[e.jsx("span",{children:"âœ…"})," Valid Coordinates"]}),e.jsxs("div",{className:"text-green-700 text-xs mt-1",children:["WGS84: ",v,", ",Y]})]})]})]}),e.jsx(Ze,{label:"Preset Profile",value:Me,onChange:n=>qe(n.target.value),options:[{label:"None",value:""},...Object.values(bt.presets).map(n=>({label:n.label,value:n.value}))]}),e.jsx(Ze,{label:"Submission Profile",value:((it=(ne.getState().jobs||[]).find(n=>n.id===ne.getState().currentJobId))==null?void 0:it.submissionProfileName)||_,onChange:n=>{const oe=(ne.getState().jobs||[]).find(ve=>ve.id===ne.getState().currentJobId);oe?ne.getState().updateJob(oe.id,{submissionProfileName:n.target.value}):f(n.target.value)},options:(w||[]).map(n=>({label:n.label,value:n.name}))}),e.jsx(gs,{}),e.jsxs("label",{className:"text-sm text-gray-700 grid gap-2",children:[e.jsx("span",{className:"font-medium whitespace-nowrap text-left",children:"Owner (utility)"}),e.jsx("input",{list:"wv-power-companies-inline",className:"border rounded px-3 py-2 min-w-0 w-full text-base leading-normal bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:M,onChange:n=>re(n.target.value),placeholder:"e.g., Mon Power, Penelec"}),e.jsx("datalist",{id:"wv-power-companies-inline",children:Bt.power.map(n=>e.jsx("option",{value:n.short||n.name,children:n.name},`p-${n.name}`))})]}),e.jsx(fe,{label:"Pole Height (ft)",value:t,onChange:n=>s(n.target.value)}),e.jsx(fe,{label:"Pole Class",value:u,onChange:n=>p(n.target.value),placeholder:"e.g., Class 4"}),e.jsx(Ze,{label:"Construction",value:C?"new":"existing",onChange:n=>N(n.target.value==="new"),options:[{label:"New",value:"new"},{label:"Existing",value:"existing"}]}),e.jsx(Ze,{label:"Power Voltage",value:P,onChange:n=>T(n.target.value),options:[{label:"Distribution",value:"distribution"},{label:"Transmission",value:"transmission"},{label:"Communication",value:"communication"}]}),e.jsx(fe,{label:"Existing Power Height (ft/in)",value:m,onChange:n=>S(n.target.value)}),e.jsx(Ft,{label:"Transformer present",checked:!!H,onChange:n=>o(n.target.checked)}),e.jsx(fe,{label:"Street Light Height (ft/in)",value:Z,onChange:n=>a(n.target.value)}),e.jsx(fe,{label:"Drip Loop Height (ft/in)",value:q,onChange:n=>X(n.target.value)}),e.jsx(Ze,{label:"Power Reference",value:J,onChange:n=>W(n.target.value),options:[{label:"Auto",value:"auto"},{label:"Neutral",value:"neutral"},{label:"Secondary",value:"secondary"},{label:"Drip Loop",value:"dripLoop"},{label:"Power Conductor",value:"power"}]}),e.jsx(fe,{label:"Span (ft)",value:j,onChange:n=>k(n.target.value)}),e.jsx(fe,{label:"Adjacent Pole (ft)",value:K,onChange:n=>le(n.target.value)}),e.jsx(Ze,{label:"Cable",value:Q,onChange:n=>ue(n.target.value),options:bt.cableTypes.map(n=>({label:n.label,value:n.value}))}),e.jsx(fe,{label:"Cable Diameter (in)",value:O,onChange:n=>Ee(n.target.value),placeholder:"auto from cable"}),e.jsx(fe,{label:"Wind (mph)",value:V,onChange:n=>De(n.target.value)}),e.jsx(fe,{label:"Ice (in)",value:z,onChange:n=>_e(n.target.value)}),e.jsx(Ze,{label:"Environment",value:D,onChange:n=>Re(n.target.value),options:[{label:"Road",value:"road"},{label:"Interstate",value:"interstate"},{label:"Interstate (New Crossing)",value:"interstateNewCrossing"},{label:"Residential",value:"residential"},{label:"Pedestrian",value:"pedestrian"},{label:"Field",value:"field"},{label:"Residential Yard",value:"residentialYard"},{label:"Residential Driveway",value:"residentialDriveway"},{label:"Non-Residential Driveway / Alley / Parking",value:"nonResidentialDriveway"},{label:"Waterway",value:"waterway"},{label:"WV Highway",value:"wvHighway"},{label:"PA Highway",value:"paHighway"},{label:"OH Highway",value:"ohHighway"},{label:"MD Highway",value:"mdHighway"},{label:"Railroad Crossing (CSX)",value:"railroad"}]}),e.jsx(fe,{label:"Proposed Line (ft/in)",value:F,onChange:n=>Ke(n.target.value)}),e.jsx(fe,{label:"Override Min Top Space (ft)",value:Ue,onChange:n=>We(n.target.value),placeholder:"optional"}),e.jsx(fe,{label:"Override Road Clearance (ft)",value:Be,onChange:n=>Ve(n.target.value),placeholder:"optional"}),e.jsx(fe,{label:"Override Comm-Power (ft)",value:Ge,onChange:n=>Ye(n.target.value),placeholder:"optional"}),e.jsx(Ze,{label:"Display Format",value:i?"ticks":"verbose",onChange:n=>x(n.target.value==="ticks"),options:[{label:"Verbose (15ft 6in)",value:"verbose"},{label:`Tick Marks (15' 6")`,value:"ticks"}]})]}):null,te.job?e.jsx(Fe,{sectionKey:"job",align:"bottom"}):null]}),!me&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"map",className:"app-section anchor-offset",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"section-title",children:"Import & Mapping"}),e.jsx("div",{className:"section-subtitle",children:"Load KML/KMZ/Shapefile or CSV, map attributes, and batch-apply."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{sectionKey:"map",align:"right"}),e.jsx("button",{type:"button",className:"ml-2 px-2 py-1 text-xs border rounded",onClick:()=>Te(n=>({...n,map:!n.map})),"aria-expanded":!!te.map,children:te.map?"Collapse":"Expand"})]})]}),te.map?e.jsx(ks,{}):null,te.map?e.jsx(et,{section:"map"}):null,te.map?e.jsx(Fe,{sectionKey:"map",align:"bottom"}):null]}),e.jsxs("div",{id:"spans",className:"app-section anchor-offset",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"section-title",children:"Spans"}),e.jsx("div",{className:"section-subtitle",children:"Perâ€‘span environment, auto/manual length, and quick calculations."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{sectionKey:"spans",align:"right"}),e.jsx("button",{type:"button",className:"ml-2 px-2 py-1 text-xs border rounded",onClick:()=>Te(n=>({...n,spans:!n.spans})),"aria-expanded":!!te.spans,children:te.spans?"Collapse":"Expand"})]})]}),te.spans?e.jsx(Jt,{}):null,te.spans?e.jsx(et,{section:"spans"}):null,te.spans?e.jsx(Fe,{sectionKey:"spans",align:"bottom"}):null]}),e.jsxs("div",{id:"existing",className:"app-section anchor-offset",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"section-title",children:"Existing Lines"}),e.jsx("div",{className:"section-subtitle",children:"Track existing attachments and makeâ€‘ready."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{sectionKey:"existing",align:"right"}),e.jsx("button",{type:"button",className:"ml-2 px-2 py-1 text-xs border rounded",onClick:()=>Te(n=>({...n,existing:!n.existing})),"aria-expanded":!!te.existing,children:te.existing?"Collapse":"Expand"})]})]}),te.existing?e.jsx(zt,{}):null,te.existing?e.jsx(et,{section:"existing"}):null,te.existing?e.jsx(Fe,{sectionKey:"existing",align:"bottom"}):null]}),e.jsxs("div",{id:"field",className:"app-section anchor-offset",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"section-title",children:"Field Collection"}),e.jsx("div",{className:"section-subtitle",children:"Mobile capture with GPS, photos, and Draft/Done workflow."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hs,{}),e.jsx(Fe,{sectionKey:"field",align:"right"}),e.jsx("button",{type:"button",className:"ml-2 px-2 py-1 text-xs border rounded",onClick:()=>Te(n=>({...n,field:!n.field})),"aria-expanded":!!te.field,children:te.field?"Collapse":"Expand"})]})]}),te.field?e.jsx(Cs,{openHelp:n=>{mt(n),B(!0)},showBottomActions:!1}):null,te.field?e.jsx(et,{section:"field"}):null,te.field?e.jsx(Fe,{sectionKey:"field",align:"bottom"}):null]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 no-print",children:[e.jsx(Ns,{}),e.jsx(ws,{}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>{ae(!1),xe(n=>!n)},disabled:!me&&!ne.getState().results,title:!me&&!ne.getState().results?"Run analysis to view report":void 0,children:me?"Back to Editor":"View Report"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>{xe(!1),ae(n=>!n)},disabled:!ne.getState().importedSpans.length,children:de?"Back to Editor":"Batch Report"})]}),e.jsxs("div",{id:"results",className:"app-section anchor-offset",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"section-title",children:"Results"}),e.jsx("div",{className:"section-subtitle",children:"Summary outputs, reports, and exports."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{sectionKey:"results",align:"right"}),e.jsx("button",{type:"button",className:"ml-2 px-2 py-1 text-xs border rounded",onClick:()=>Te(n=>({...n,results:!n.results})),"aria-expanded":!!te.results,children:te.results?"Collapse":"Expand"})]})]}),te.results?e.jsx(ps,{children:me?e.jsx(ys,{}):de?e.jsx(Ls,{}):e.jsx(fs,{})}):null,te.results?e.jsx(et,{section:"results"}):null,te.results?e.jsx(Fe,{sectionKey:"results",align:"bottom"}):null]}),e.jsx(bs,{}),e.jsx(js,{}),e.jsx(Es,{open:be,onClose:()=>B(!1),initialSection:Ae})]})}class ps extends L.Component{constructor(u){super(u),this.state={hasError:!1,error:null}}static getDerivedStateFromError(u){return{hasError:!0,error:u}}componentDidCatch(u,s){console.error("Results render error:",u,s)}render(){return this.state.hasError?e.jsxs("div",{className:"border border-red-300 bg-red-50 text-red-800 rounded p-2",children:[e.jsx("div",{className:"font-medium",children:"Results couldnâ€™t render."}),e.jsx("div",{className:"text-xs break-anywhere",children:String(this.state.error)})]}):this.props.children}}function et({section:t}){const u=L.useMemo(()=>{switch(t){case"job":return["Set Owner to Mon Power when using FirstEnergy presets; this drives FE-specific targets.","Use the GPS button in Job Setup for accurate coordinates; each Field row can also capture GPS.","Submission Profile controls clearances (Commâ†’Power, Road, Min Top Space) and midspan targets.","Power Reference selects which power point is used (Neutral/Secondary/Drip Loop/Conductor).","Override fields are optional and apply on top of the active submission profile.",`Switch Display Format to Tick Marks for 15' 6" style readouts in Results.`];case"map":return["Imports support CSV, KML/KMZ, and Shapefiles; use presets for ArcGIS, ikeGPS, and Katapult Pro.","Prefer auto span length from coordinates when endpoints are present; manual is respected when set.","Use Auto-map to preview and apply field mappings; review differences before applying."];case"spans":return["Set environment per span to drive midspan clearance targets (road, residential, pedestrian, etc.).","Prefer auto length from endpoints (Haversine). You can override with a manual length if needed.","Use Compute/Recompute to refresh cached midspans; map links open in a new tab for quick checks."];case"existing":return["Capture existing attachments and propose make-ready heights. Cost is estimated at ~$12.50 per inch.","Use clear company names (e.g., Comcast) to improve make-ready summaries in the Results and Report."];case"field":return["One row per pole. Use GPS per row and attach a photo; EXIF GPS and timestamp are read when available.","Use Draft/Done to track status. â€œFirst 25â€ export aligns to typical FE SPANS limits.","Variance PASS/FAIL compares as-built vs planned attach using the active preset tolerance.","Scope is per Job. Set the current job at the top; exports include job profile metadata.","As a PWA, the app works offline. Sync by exporting CSV/ZIP when connectivity is available."];case"results":return["Standards Compliance shows PASS/FAIL for midspan ground clearance and Commâ†’Power separation.","The â€œBasisâ€ explains what controlled the recommended attach height in this scenario.","Switch display format (Verbose vs Tick Marks) in Job Setup to change readouts.","Use Export CSV/PDF or generate a Permit Pack for WV/PA/OH/MD Highway or Railroad."];default:return[]}},[t]);return u.length?e.jsxs("details",{className:"mt-2 mb-1",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-blue-800",children:"Tips"}),e.jsx("ul",{className:"mt-1 text-xs text-blue-900 bg-blue-50 border border-blue-200 rounded p-2 list-disc pl-5",children:u.map((s,p)=>e.jsx("li",{className:"mb-0.5",children:s},p))})]}):null}et.propTypes={section:Ce.string.isRequired};function Fe({sectionKey:t,align:u}){var b;const s=ne(),p=(b=s.uiSectionSaved)==null?void 0:b[t],c=p?`Saved ${new Date(p).toLocaleTimeString()}`:"Save";return e.jsx("div",{className:u==="bottom"?"mt-2 flex items-center gap-2 justify-end":"",children:e.jsx("button",{type:"button",className:"px-2 py-1 text-xs border rounded",onClick:()=>{var r;return(r=s.setSectionSaved)==null?void 0:r.call(s,t)},title:p?`Last saved: ${new Date(p).toLocaleString()}`:"Save section state",children:c})})}Fe.propTypes={sectionKey:Ce.string.isRequired,align:Ce.string};function hs(){var T,j,C,N,K,Q,O,V;const t=ne(),[u,s]=L.useState(!0),p=async D=>{const{buildGeoJSON:Z,exportGeoJSON:q,exportKML:F,exportKMZ:h}=await he(async()=>{const{buildGeoJSON:l,exportGeoJSON:d,exportKML:k,exportKMZ:le}=await import("./app-geodata-OF3I9fsg.js").then(ue=>ue.g);return{buildGeoJSON:l,exportGeoJSON:d,exportKML:k,exportKMZ:le}},__vite__mapDeps([0,1,2])),z=(t.jobs||[]).find(l=>l.id===t.currentJobId)||{},H=(t.collectedPoles||[]).filter(l=>!t.currentJobId||l.jobId===t.currentJobId),o=t.importedPoles||[],J=new Map;for(const l of o)l!=null&&l.id&&J.set(String(l.id),l);for(const l of H)l!=null&&l.id&&J.set(String(l.id),l);const W=H.length?Array.from(new Set([...H,...o.filter(l=>l&&l.id&&!H.find(d=>String(d.id)===String(l.id)))])):o;let X=[];(t.importedSpans||[]).length&&(X=(t.importedSpans||[]).map((l,d)=>({id:l.id||`S${d+1}`,fromId:l.fromId,toId:l.toId,length:l.length,proposedAttach:l.proposedAttach,environment:l.environment})));const a=Z({poles:W,spans:X,job:z});if(!a.features.length)return alert("No geolocated poles/spans to export");if(D==="geojson")return q(a,`${z.name||"job"}-geodata.geojson`);if(D==="kml")return F(a,`${z.name||"job"}-geodata.kml`);if(D==="kmz")return h(a,`${z.name||"job"}-geodata.kmz`)},c=()=>{const D=(t.jobs||[]).find(o=>o.id===t.currentJobId),Z=["id","latitude","longitude","height","class","powerHeight","voltage","hasTransformer","spanDistance","incomingBearingDeg","outgoingBearingDeg","PULL_ft","adjacentPoleHeight","attachmentType","status","hasPhoto","timestamp","asBuiltAttachHeight","asBuiltPowerHeight","varianceIn","variancePass","commCompany"],q=(t.collectedPoles||[]).filter(o=>!t.currentJobId||o.jobId===t.currentJobId).map(o=>{var J,W,X,a,l,d,k;return[o.id||"",o.latitude||"",o.longitude||"",o.height||"",o.poleClass||"",o.powerHeight||"",o.voltage||"",o.hasTransformer?"Y":"N",o.spanDistance||"",(J=o.incomingBearingDeg)!=null?J:"",(W=o.outgoingBearingDeg)!=null?W:"",(X=o.PULL_ft)!=null?X:"",o.adjacentPoleHeight||"",o.attachmentType||"",o.status||"draft",o.photoDataUrl?"Y":"N",o.timestamp||"",((a=o.asBuilt)==null?void 0:a.attachHeight)||"",((l=o.asBuilt)==null?void 0:l.powerHeight)||"",He((d=o.asBuilt)==null?void 0:d.attachHeight,o.height),je((k=o.asBuilt)==null?void 0:k.attachHeight,o.height,t.presetProfile),(D==null?void 0:D.commCompany)||""]}),F=[Z.join(","),...q.map(o=>o.map(J=>`${String(J).replaceAll('"','""')}`).join(","))].join(`
`),h=new Blob([F],{type:"text/csv;charset=utf-8;"}),z=URL.createObjectURL(h),H=document.createElement("a");H.href=z,H.download="collected-poles.csv",H.click(),URL.revokeObjectURL(z)},b=()=>{const D=(t.collectedPoles||[]).filter(o=>!t.currentJobId||o.jobId===t.currentJobId).slice(0,25),Z=["id","latitude","longitude","height","class","powerHeight","voltage","hasTransformer","spanDistance","incomingBearingDeg","outgoingBearingDeg","PULL_ft","adjacentPoleHeight","attachmentType","status","hasPhoto","timestamp","asBuiltAttachHeight","asBuiltPowerHeight","varianceIn","variancePass"],q=D.map(o=>{var J,W,X,a,l,d,k;return[o.id||"",o.latitude||"",o.longitude||"",o.height||"",o.poleClass||"",o.powerHeight||"",o.voltage||"",o.hasTransformer?"Y":"N",o.spanDistance||"",(J=o.incomingBearingDeg)!=null?J:"",(W=o.outgoingBearingDeg)!=null?W:"",(X=o.PULL_ft)!=null?X:"",o.adjacentPoleHeight||"",o.attachmentType||"",o.status||"draft",o.photoDataUrl?"Y":"N",o.timestamp||"",((a=o.asBuilt)==null?void 0:a.attachHeight)||"",((l=o.asBuilt)==null?void 0:l.powerHeight)||"",He((d=o.asBuilt)==null?void 0:d.attachHeight,o.height),je((k=o.asBuilt)==null?void 0:k.attachHeight,o.height,t.presetProfile)]}),F=[Z.join(","),...q.map(o=>o.map(J=>`${String(J).replaceAll('"','""')}`).join(","))].join(`
`),h=new Blob([F],{type:"text/csv;charset=utf-8;"}),z=URL.createObjectURL(h),H=document.createElement("a");H.href=z,H.download="collected-poles-first-25.csv",H.click(),URL.revokeObjectURL(z)},r=async()=>{try{const D=(await he(async()=>{const{default:a}=await import("./zip-utils-BoTj1NZG.js").then(l=>l.j);return{default:a}},__vite__mapDeps([1,2]))).default,Z=new D,q=(t.collectedPoles||[]).filter(a=>!t.currentJobId||a.jobId===t.currentJobId),F=(t.jobs||[]).find(a=>a.id===t.currentJobId),h=(()=>{const a=(F==null?void 0:F.submissionProfileName)||t.currentSubmissionProfile,l=(t.submissionProfiles||[]).find(d=>d.name===a)||{};return{...l,...(F==null?void 0:F.submissionProfileOverrides)||{},name:l==null?void 0:l.name}})(),z=q.map(a=>{var l,d;return{...a,_varianceIn:He((l=a.asBuilt)==null?void 0:l.attachHeight,a.height),_variancePass:je((d=a.asBuilt)==null?void 0:d.attachHeight,a.height,t.presetProfile)}}),{header:H,rows:o}=st("firstEnergy",z,F);if(Z.file("manifest.csv",nt(H,o)),Z.file("job-profile.json",JSON.stringify({jobId:(F==null?void 0:F.id)||"",jobName:(F==null?void 0:F.name)||"",owner:(F==null?void 0:F.jobOwner)||t.jobOwner||"",commCompany:(F==null?void 0:F.commCompany)||"",submissionProfile:h,includePhotos:u},null,2)),u){const a=Z.folder("photos"),l=[];for(const d of z){if(!d.photoDataUrl)continue;const k=d.id?String(d.id).replaceAll(/[^A-Za-z0-9_-]/g,"_"):`row-${l.length+1}`,le=String(d.photoDataUrl),ue=le.match(/^data:(.+);base64,(.*)$/),Ee=(ue==null?void 0:ue[1])||"image/jpeg",De=(ue==null?void 0:ue[2])||le.split(",")[1],_e=Ee.includes("png")?"png":Ee.includes("webp")?"webp":"jpg",Re=`${k}.${_e}`;De&&a&&(a.file(Re,De,{base64:!0}),l.push(`${k},${Re},${Ee}`))}l.length&&a&&a.file("index.csv",["id,file,mime",...l].join(`
`))}const J=await Z.generateAsync({type:"blob"}),W=URL.createObjectURL(J),X=document.createElement("a");X.href=W,X.download="fe-spans.zip",X.click(),URL.revokeObjectURL(W)}catch(D){alert(`ZIP export failed: ${(D==null?void 0:D.message)||D}`)}},m=async()=>{const D=(t.jobs||[]).find(q=>q.id===t.currentJobId),Z=(D==null?void 0:D.submissionProfileName)||t.currentSubmissionProfile;if(Z==="firstEnergy")return r();if(Z==="aep")return S();if(Z==="duke"){const q=(t.collectedPoles||[]).filter(F=>!t.currentJobId||F.jobId===t.currentJobId);return P(q)}return S()},P=async(D,Z)=>{const q=(await he(async()=>{const{default:k}=await import("./zip-utils-BoTj1NZG.js").then(le=>le.j);return{default:k}},__vite__mapDeps([1,2]))).default,F=new q,h=(t.jobs||[]).find(k=>k.id===t.currentJobId),z=(h==null?void 0:h.submissionProfileName)||t.currentSubmissionProfile,H=(()=>{const k=(t.submissionProfiles||[]).find(le=>le.name===z)||{};return{...k,...(h==null?void 0:h.submissionProfileOverrides)||{},name:k==null?void 0:k.name}})(),o=D.map(k=>{var le,ue;return{...k,_varianceIn:He((le=k.asBuilt)==null?void 0:le.attachHeight,k.height),_variancePass:je((ue=k.asBuilt)==null?void 0:ue.attachHeight,k.height,t.presetProfile)}}),{header:J,rows:W,fileLabel:X}=st(z,o,h);F.file("manifest.csv",nt(J,W)),F.file("job-profile.json",JSON.stringify({jobId:(h==null?void 0:h.id)||"",jobName:(h==null?void 0:h.name)||"",owner:(h==null?void 0:h.jobOwner)||t.jobOwner||"",commCompany:(h==null?void 0:h.commCompany)||"",submissionProfile:H,includePhotos:u},null,2));const a=await F.generateAsync({type:"blob"}),l=URL.createObjectURL(a),d=document.createElement("a");d.href=l,d.download=`${X}.zip`,d.click(),URL.revokeObjectURL(l)},S=async()=>{try{const D=(await he(async()=>{const{default:a}=await import("./zip-utils-BoTj1NZG.js").then(l=>l.j);return{default:a}},__vite__mapDeps([1,2]))).default,Z=new D,q=(t.collectedPoles||[]).filter(a=>!t.currentJobId||a.jobId===t.currentJobId),F=(t.jobs||[]).find(a=>a.id===t.currentJobId),h=(()=>{const a=(F==null?void 0:F.submissionProfileName)||t.currentSubmissionProfile,l=(t.submissionProfiles||[]).find(d=>d.name===a)||{};return{...l,...(F==null?void 0:F.submissionProfileOverrides)||{},name:l==null?void 0:l.name}})(),{header:z,rows:H,fileLabel:o}=st("aep",q,F);Z.file("manifest.csv",nt(z,H)),Z.file("job-profile.json",JSON.stringify({jobId:(F==null?void 0:F.id)||"",jobName:(F==null?void 0:F.name)||"",owner:(F==null?void 0:F.jobOwner)||t.jobOwner||"",commCompany:(F==null?void 0:F.commCompany)||"",submissionProfile:h,includePhotos:u},null,2));const J=await Z.generateAsync({type:"blob"}),W=URL.createObjectURL(J),X=document.createElement("a");X.href=W,X.download=`${o}.zip`,X.click(),URL.revokeObjectURL(W)}catch(D){alert(`ZIP export failed: ${(D==null?void 0:D.message)||D}`)}};return e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("label",{className:"inline-flex items-center gap-1",title:"Include photos when available in ZIP exports",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:D=>s(D.target.checked)}),"Photos"]}),e.jsx("button",{className:"px-2 py-1 border rounded",onClick:c,disabled:!((T=t.collectedPoles)!=null&&T.length),children:"Export CSV"}),e.jsx("button",{className:"px-2 py-1 border rounded",onClick:b,disabled:(((j=t.collectedPoles)==null?void 0:j.length)||0)<1,children:"First 25"}),e.jsx("button",{className:"px-2 py-1 border rounded",onClick:r,disabled:(((C=t.collectedPoles)==null?void 0:C.length)||0)<1,children:"FE SPANS"}),e.jsx("button",{className:"px-2 py-1 border rounded",onClick:m,disabled:(((N=t.collectedPoles)==null?void 0:N.length)||0)<1,children:"Utility ZIP"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"Geo:"}),e.jsx("button",{className:"px-2 py-1 border rounded",onClick:()=>p("geojson"),disabled:(((K=t.collectedPoles)==null?void 0:K.length)||0)<1,children:"GeoJSON"}),e.jsx("button",{className:"px-2 py-1 border rounded",onClick:()=>p("kml"),disabled:(((Q=t.collectedPoles)==null?void 0:Q.length)||0)<1,children:"KML"}),e.jsx("button",{className:"px-2 py-1 border rounded",onClick:()=>p("kmz"),disabled:(((O=t.collectedPoles)==null?void 0:O.length)||0)<1,children:"KMZ"})]}),e.jsx("button",{className:"px-2 py-1 border rounded",onClick:()=>{var D;return(D=t.setCollectedPoles)==null?void 0:D.call(t,[])},disabled:!((V=t.collectedPoles)!=null&&V.length),children:"Clear"})]})}function xs(t){var s,p;const u=bt.presets[t];return(p=(s=u==null?void 0:u.asBuiltTolerances)==null?void 0:s.attachHeightIn)!=null?p:2}function He(t,u){const s=Oe(t),p=Oe(u);if(s==null||p==null)return"";const c=Math.round((s-p)*12);return String(c)}function je(t,u,s){const p=Oe(t),c=Oe(u);if(p==null||c==null)return"";const b=xs(s);return Math.abs((p-c)*12)<=b?"PASS":"FAIL"}function It({open:t,onClose:u,current:s,proposal:p,onApply:c}){if(!t||!p)return null;const b=["pole","span","line"],r=(m,P)=>m===P?"text-gray-600":"text-blue-700";return e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded shadow-lg w-[90vw] max-w-2xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:"Auto-map Preview"}),e.jsx("button",{className:"text-sm",onClick:u,children:"Close"})]}),e.jsx("div",{className:"text-xs text-gray-600 mb-3",children:"Review proposed field mappings and click Apply to use them."}),e.jsx("div",{className:"grid md:grid-cols-3 gap-3 text-sm",children:b.map(m=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"font-medium mb-1",children:m}),Object.entries(p[m]||{}).map(([P,S])=>{var T,j;return e.jsxs("div",{className:"grid gap-0.5 mb-1",children:[e.jsx("div",{className:"text-xs uppercase text-gray-500",children:P}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Current:"," ",e.jsx("span",{className:"font-mono",children:((T=s[m])==null?void 0:T[P])||""})]}),e.jsxs("div",{className:`text-xs ${r((j=s[m])==null?void 0:j[P],S)}`,children:["Proposed: ",e.jsx("span",{className:"font-mono",children:S})]})]},P)})]},m))}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:c,children:"Apply"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:u,children:"Cancel"})]})]})})}It.propTypes={open:Ce.bool.isRequired,onClose:Ce.func.isRequired,current:Ce.object,proposal:Ce.object,onApply:Ce.func.isRequired};function fe({label:t,...u}){return e.jsxs("label",{className:"text-sm text-gray-700 grid gap-2",children:[e.jsx("span",{className:"font-medium whitespace-nowrap text-left",children:t}),e.jsx("input",{className:"border rounded px-3 py-2 min-w-0 w-full text-base leading-normal bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",...u})]})}fe.propTypes={label:Ce.string.isRequired};function Ze({label:t,options:u,...s}){return e.jsxs("label",{className:"text-sm text-gray-700 grid gap-2",children:[e.jsx("span",{className:"font-medium whitespace-nowrap text-left",children:t}),e.jsx("select",{className:"border rounded px-3 py-2 min-w-0 w-full text-base leading-normal bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",...s,children:u.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]})}Ze.propTypes={label:Ce.string.isRequired,options:Ce.arrayOf(Ce.shape({value:Ce.string.isRequired,label:Ce.string.isRequired})).isRequired};function Ft({label:t,...u}){return e.jsxs("label",{className:"text-sm text-gray-700 inline-flex items-center gap-3 mt-6 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-2",...u}),e.jsx("span",{className:"font-medium select-none",children:t})]})}Ft.propTypes={label:Ce.string.isRequired};function gs(){const t=ne(),{submissionProfiles:u,currentSubmissionProfile:s,updateSubmissionProfile:p}=t,c=(t.jobs||[]).find(C=>C.id===t.currentJobId),b=(c==null?void 0:c.submissionProfileName)||s,r=(u||[]).find(C=>C.name===b);if(!r)return null;const m={...r,...(c==null?void 0:c.submissionProfileOverrides)||{}},P=(C,N)=>{const K=Number(N);Number.isFinite(K)&&p(r.name,{[C]:K})},S=(C,N)=>{const K=Number(N);Number.isFinite(K)&&t.updateJob(c.id,{submissionProfileOverrides:{...c.submissionProfileOverrides||{},[C]:K}})},T=()=>{c&&t.updateJob(c.id,{submissionProfileOverrides:{}})},j=({label:C,field:N,unit:K})=>{var Q;return e.jsxs("label",{className:"text-sm text-gray-700 grid gap-2",children:[e.jsx("span",{className:"font-medium whitespace-nowrap text-left",children:C}),e.jsx("input",{className:"border rounded px-3 py-2 min-w-0 w-full text-base leading-normal bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(Q=m[N])!=null?Q:"",onChange:O=>c?S(N,O.target.value):P(N,O.target.value),placeholder:c?"override (blank uses profile)":""}),e.jsx("span",{className:"text-xs text-gray-500 -mt-1",children:K})]})};return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx(j,{label:"Commâ†’Power",field:"commToPowerIn",unit:"in"}),e.jsx(j,{label:"Min Top Space",field:"minTopSpaceFt",unit:"ft"}),e.jsx(j,{label:"Road Clearance",field:"roadClearanceFt",unit:"ft"}),e.jsx(j,{label:"Road Midspan Target",field:"envRoadFt",unit:"ft"}),e.jsx(j,{label:"Residential Midspan Target",field:"envResidentialFt",unit:"ft"}),e.jsx(j,{label:"Pedestrian Midspan Target",field:"envPedestrianFt",unit:"ft"}),e.jsx(j,{label:"Field Midspan Target",field:"envFieldFt",unit:"ft"}),e.jsx(j,{label:"Residential Yard Target",field:"envResidentialYardFt",unit:"ft"}),e.jsx(j,{label:"Residential Driveway Target",field:"envResidentialDrivewayFt",unit:"ft"}),e.jsx(j,{label:"Waterway Midspan Target",field:"envWaterwayFt",unit:"ft"}),e.jsx(j,{label:"WV Highway Target",field:"envWVHighwayFt",unit:"ft"}),e.jsx(j,{label:"PA Highway Target",field:"envPAHighwayFt",unit:"ft"}),e.jsx(j,{label:"OH Highway Target",field:"envOHHighwayFt",unit:"ft"}),e.jsx(j,{label:"MD Highway Target",field:"envMDHighwayFt",unit:"ft"}),e.jsx(j,{label:"Non-Residential Driveway Target",field:"envNonResidentialDrivewayFt",unit:"ft"}),e.jsx(j,{label:"Interstate Target",field:"envInterstateFt",unit:"ft"}),e.jsx(j,{label:"Interstate (New Crossing) Target",field:"envInterstateNewCrossingFt",unit:"ft"}),e.jsx(j,{label:"Railroad Crossing Target",field:"envRailroadFt",unit:"ft"}),e.jsx(j,{label:"Min Comm Attach Height",field:"minCommAttachFt",unit:"ft"}),c?e.jsxs("div",{className:"md:col-span-2 xl:col-span-3 text-sm text-blue-700 bg-blue-100 p-3 rounded border border-blue-200",children:["Using job-specific overrides."," ",e.jsx("button",{className:"underline font-medium hover:no-underline",onClick:T,children:"Reset overrides"})]}):e.jsx("div",{className:"md:col-span-2 xl:col-span-3 text-sm text-gray-600 bg-gray-100 p-3 rounded border",children:"Editing global submission profile defaults."})]})}function fs(){var P,S,T,j;const{results:t,warnings:u,engineeringNotes:s,costAnalysis:p,makeReadyNotes:c,useTickMarkFormat:b}=ne();if(!t)return e.jsx("div",{className:"text-gray-600",children:"Enter inputs to see results."});const{clearances:r}=t,m=b?ut:pt;return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"font-medium mb-2",children:"Pole"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsxs("div",{children:["Height: ",m(t.pole.inputHeight)]}),e.jsxs("div",{children:["Buried: ",m(t.pole.buriedFt)]}),e.jsxs("div",{children:["Above ground: ",m(t.pole.aboveGroundFt)]}),e.jsxs("div",{children:["Class: ",t.pole.classInfo]}),t.pole.latitude!=null&&t.pole.longitude!=null?e.jsxs("div",{children:["GPS: ",t.pole.latitude,", ",t.pole.longitude]}):null]})]}),e.jsx("div",{className:"section-divider"}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"font-medium mb-2",children:"Attachment & Span"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsxs("div",{children:["Proposed attach: ",m(t.attach.proposedAttachFt)]}),t.attach.recommendation?e.jsxs("div",{className:"text-xs text-gray-600",children:["Basis: ",t.attach.recommendation.basis," â€”"," ",t.attach.recommendation.detail]}):null,e.jsxs("div",{children:["Span: ",t.span.spanFt," ft"]}),e.jsxs("div",{children:["Wind: ",t.span.wind," mph"]}),e.jsxs("div",{children:["Sag: ",m(t.span.sagFt)]}),e.jsxs("div",{children:["Midspan: ",m(t.span.midspanFt)]}),e.jsx("div",{className:"my-2",children:e.jsx(vt,{attachFt:t.attach.proposedAttachFt,midspanFt:t.span.midspanFt,spanFt:t.span.spanFt,groundTargetFt:t.clearances.groundClearance})}),t.guy?e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"font-medium",children:"Guying"}),e.jsxs("div",{children:["Required: ",t.guy.required?"Yes":"No"]}),e.jsxs("div",{children:["Tension: ",(P=t.guy.tension)==null?void 0:P.toFixed(0)," lb"]}),e.jsxs("div",{children:["Angle: ",(S=t.guy.angle)==null?void 0:S.toFixed(0),"Â°"]}),e.jsxs("div",{children:["Lead: ",(T=t.guy.leadDistance)==null?void 0:T.toFixed(1)," ft"]}),e.jsxs("div",{children:["Guy attach height: ",m(t.guy.guyHeight)]}),t.guy.totalCost?e.jsxs("div",{children:["Guy cost: $",t.guy.totalCost]}):null]}):null]})]}),e.jsx("div",{className:"section-divider"}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"font-medium mb-2",children:"Clearances (targets)"}),e.jsxs("div",{className:"text-sm text-gray-700 grid grid-cols-2 gap-x-4 gap-y-1",children:[e.jsxs("div",{children:["Ground: ",m(r.groundClearance)]}),e.jsxs("div",{children:["Road: ",m(r.roadClearance)]}),e.jsxs("div",{children:["Min top space: ",m(r.minimumPoleTopSpace)]}),"powerClearanceDistribution"in r&&e.jsxs("div",{children:["Power (dist): ",m(r.powerClearanceDistribution)]}),"powerClearanceTransmission"in r&&e.jsxs("div",{children:["Power (trans): ",m(r.powerClearanceTransmission)]})]})]}),e.jsx(vs,{}),c?e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"font-medium mb-2",children:"Make-ready"}),e.jsx("pre",{className:"text-xs whitespace-pre-wrap text-gray-700",children:c}),e.jsxs("div",{className:"text-sm text-gray-700 mt-2",children:["Make-ready total: $",(j=t.makeReadyTotal)!=null?j:0]})]}):null,u!=null&&u.length?e.jsxs("div",{className:"rounded border border-yellow-300 bg-yellow-50 p-3",children:[e.jsx("div",{className:"font-medium mb-2",children:"Warnings"}),e.jsx("ul",{className:"list-disc pl-5 text-sm text-yellow-800",children:u.map((C,N)=>e.jsx("li",{children:C},N))})]}):null,s!=null&&s.length?e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"font-medium mb-2",children:"Notes"}),e.jsx("ul",{className:"list-disc pl-5 text-sm text-gray-700",children:s.map((C,N)=>e.jsx("li",{children:C},N))})]}):null,e.jsxs("div",{className:"text-sm text-gray-600",children:["Estimated cost: $",p!=null?p:0]})]})}function bs(){const t=ne(),[u,s]=L.useState([]);return L.useEffect(()=>{(async()=>{try{const{getTemplatesForEnvironment:p}=await he(async()=>{const{getTemplatesForEnvironment:b}=await import("./app-utils-BDwnIIkN.js").then(r=>r.p);return{getTemplatesForEnvironment:b}},__vite__mapDeps([3,4,5,6,7,2,8])),c=p(t.spanEnvironment);s(c||[])}catch{}})()},[t.spanEnvironment]),u!=null&&u.length?e.jsxs("div",{className:"rounded border p-3 no-print",children:[e.jsx("div",{className:"font-medium mb-2",children:"Agency Templates & Resources"}),e.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["Environment: ",t.spanEnvironment]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3 text-sm",children:u.map(p=>{var c,b;return e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"font-medium mb-1",children:p.name}),(c=p.resources)!=null&&c.length?e.jsx("ul",{className:"list-disc pl-5",children:p.resources.map((r,m)=>e.jsxs("li",{className:"mb-1",children:[e.jsx("a",{className:"text-blue-700 underline",href:r.url,target:"_blank",rel:"noreferrer",children:r.label}),r.notes?e.jsx("div",{className:"text-xs text-gray-600",children:r.notes}):null]},m))}):e.jsx("div",{className:"text-xs text-gray-500",children:"No direct resources listed."}),(b=p.requirements)!=null&&b.length?e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs uppercase text-gray-500",children:"Common Requirements"}),e.jsx("ul",{className:"list-disc pl-5 text-sm",children:p.requirements.map((r,m)=>e.jsx("li",{children:r},m))})]}):null]},p.key)})})]}):null}function js(){const t=ne(),[u,s]=L.useState(null),[p,c]=L.useState(""),[b,r]=L.useState(""),[m,P]=L.useState(""),S=t.spanEnvironment,T=["wvHighway","paHighway","ohHighway","mdHighway","railroad"].includes(S),[j,C]=L.useState({}),[N,K]=L.useState("Default");L.useEffect(()=>{(async()=>{if(!T||!t.results){C({});return}try{const h=(ne.getState().jobs||[]).find(d=>d.id===ne.getState().currentJobId),z=(h==null?void 0:h.submissionProfileName)||ne.getState().currentSubmissionProfile,H=(ne.getState().submissionProfiles||[]).find(d=>d.name===z)||{},o={...H,...(h==null?void 0:h.submissionProfileOverrides)||{},name:H==null?void 0:H.name},J=kt({env:S,results:ne.getState().results,job:h,effectiveProfile:o,cachedMidspans:ne.getState().cachedMidspans,store:ne.getState()}),{buildMM109Fields:W,buildCSXFields:X,buildStateHighwayFields:a}=await he(async()=>{const{buildMM109Fields:d,buildCSXFields:k,buildStateHighwayFields:le}=await import("./app-utils-BDwnIIkN.js").then(ue=>ue.f);return{buildMM109Fields:d,buildCSXFields:k,buildStateHighwayFields:le}},__vite__mapDeps([3,4,5,6,7,2,8]));let l;S==="railroad"?l=X(J):S==="wvHighway"?l=W(J):S==="paHighway"?l=a(J,"PennDOT"):S==="ohHighway"?l=a(J,"ODOT"):S==="mdHighway"?l=a(J,"MDOT SHA"):l=W(J),C(l),c(d=>d||JSON.stringify([{key:"applicant",pageIndex:0,x:100,y:700,size:10},{key:"jobName",pageIndex:0,x:100,y:684,size:10},{key:"jobNumber",pageIndex:0,x:100,y:668,size:10},{key:"poleLatitude",pageIndex:0,x:400,y:700,size:10},{key:"poleLongitude",pageIndex:0,x:400,y:684,size:10}],null,2))}catch(h){console.warn&&console.warn("Form fields build failed",h),C({})}})()},[T,S]);const Q=async()=>{try{if(r(""),!u){r("Select an official PDF to fill.");return}if(!j){r("Run analysis and select a supported environment.");return}let h;try{h=JSON.parse(p||"[]")}catch{r("Layout JSON is invalid.");return}if(typeof(u==null?void 0:u.arrayBuffer)!="function"){r("Selected file is not a valid PDF Blob/File.");return}const z=new Uint8Array(await u.arrayBuffer()),{fillPdfWithFields:H}=await he(async()=>{const{fillPdfWithFields:a}=await import("./app-permits-Dftu4pdj.js").then(l=>l.p);return{fillPdfWithFields:a}},__vite__mapDeps([9,3,4,5,6,7,2,8])),o=await H(z,j,h),J=new Blob([o],{type:"application/pdf"}),W=URL.createObjectURL(J),X=document.createElement("a");X.href=W,X.download="filled-form.pdf",X.click(),URL.revokeObjectURL(W),r("Filled PDF downloaded.")}catch(h){r(`Autofill failed: ${(h==null?void 0:h.message)||h}`)}},O=L.useMemo(()=>{var H,o;const h=t.currentJobId||"_global",z=((o=(H=t.pdfLayouts)==null?void 0:H[h])==null?void 0:o[S])||{};return Object.keys(z).sort()},[t.pdfLayouts,t.currentJobId,S]),V=()=>{try{const h=JSON.parse(p||"[]");t.savePdfLayout(S,N||"Default",h),r(`Saved preset "${N||"Default"}" for ${S}.`)}catch{r("Layout JSON is invalid.")}},D=h=>{var o,J,W;const z=t.currentJobId||"_global",H=(W=(J=(o=t.pdfLayouts)==null?void 0:o[z])==null?void 0:J[S])==null?void 0:W[h];if(!H){r("Preset not found.");return}c(JSON.stringify(H,null,2)),K(h),r(`Loaded preset "${h}".`)},Z=h=>{t.removePdfLayout(S,h),r(`Deleted preset "${h}".`)},q=async()=>{try{if(r(""),P(""),!u){r("Select an official PDF to analyze.");return}const h=new Uint8Array(await u.arrayBuffer()),{getPdfMeta:z,fillPdfAuto:H}=await he(async()=>{const{getPdfMeta:d,fillPdfAuto:k}=await import("./app-permits-Dftu4pdj.js").then(le=>le.p);return{getPdfMeta:d,fillPdfAuto:k}},__vite__mapDeps([9,3,4,5,6,7,2,8])),o=await z(h),J=`${o.pages} page(s), first ${Math.round(o.firstPage.width)}x${Math.round(o.firstPage.height)}`;if(P(`Detected PDF: ${J}. Using default layout for ${S}.`),!j){r("Run analysis first for normalized fields.");return}const W=await H(h,S,j,void 0),X=new Blob([W],{type:"application/pdf"}),a=URL.createObjectURL(X),l=document.createElement("a");l.href=a,l.download="filled-form-auto.pdf",l.click(),URL.revokeObjectURL(a),r("Auto-filled PDF downloaded.")}catch(h){r(`Auto-layout failed: ${(h==null?void 0:h.message)||h}`)}},F=async()=>{try{if(r(""),!u){r("Select an official PDF to fill.");return}if(!j){r("Run analysis and select a supported environment.");return}const h=new Uint8Array(await u.arrayBuffer()),{fillAcroFormByName:z}=await he(async()=>{const{fillAcroFormByName:X}=await import("./app-permits-Dftu4pdj.js").then(a=>a.p);return{fillAcroFormByName:X}},__vite__mapDeps([9,3,4,5,6,7,2,8])),H=await z(h,S,j),o=new Blob([H],{type:"application/pdf"}),J=URL.createObjectURL(o),W=document.createElement("a");W.href=J,W.download="filled-form-fields.pdf",W.click(),URL.revokeObjectURL(J),r("Filled PDF (form fields) downloaded.")}catch(h){r(`Form fill failed: ${(h==null?void 0:h.message)||h}`)}};return T?e.jsxs("div",{className:"rounded border p-3 no-print",children:[e.jsx("div",{className:"font-medium mb-2",children:"Form Autofill (Upload Official PDF)"}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Use this helper to overlay your current job fields onto an official PDF template. Provide a simple layout JSON mapping (key â†’ page/x/y/size). Start with the example and adjust coordinates to your form."}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-2 items-end",children:[e.jsxs("label",{className:"text-sm text-gray-700 grid gap-1",children:[e.jsx("span",{className:"font-medium",children:"Official PDF"}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:h=>{var z;return s(((z=h.target.files)==null?void 0:z[0])||null)}})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("label",{className:"text-sm text-gray-700 grid gap-1",children:[e.jsx("span",{className:"font-medium",children:"Layout JSON"}),e.jsx("textarea",{className:"border rounded p-2 text-xs h-28",value:p,onChange:h=>c(h.target.value),placeholder:'[{"key":"applicant","pageIndex":0,"x":100,"y":700,"size":10}]'})]})})]}),e.jsxs("div",{className:"mt-2 grid md:grid-cols-3 gap-2 items-end",children:[e.jsxs("div",{className:"grid gap-1 text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Preset Name"}),e.jsx("input",{className:"border rounded px-2 py-1",value:N,onChange:h=>K(h.target.value),placeholder:"Default"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:V,disabled:!p,children:"Save Preset"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Scope: ",t.currentJobId?"Job":"Global"," | Env: ",S]})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("select",{className:"border rounded px-2 py-1 text-sm",onChange:h=>h.target.value&&D(h.target.value),value:"",children:[e.jsx("option",{value:"",disabled:!0,children:"Load presetâ€¦"}),O.map(h=>e.jsx("option",{value:h,children:h},h))]}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>N&&Z(N),disabled:!N,children:"Delete"})]})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2 flex-wrap",children:[e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:Q,disabled:!u||!j,children:"Fill PDF"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:q,disabled:!u||!j,children:"Auto-Layout & Fill"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:F,disabled:!u||!j,children:"Fill by Form Fields"}),e.jsx("div",{className:"text-xs text-gray-600",children:b})]}),m?e.jsx("div",{className:"text-xs text-amber-700 mt-1",children:m}):null,j?e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-700",children:"Normalized Fields (available keys)"}),e.jsx("pre",{className:"text-[11px] bg-gray-50 p-2 rounded overflow-auto max-h-64 break-anywhere",children:JSON.stringify(j,null,2)})]}):null]}):null}function vs(){var V,D,Z;const t=ne(),{results:u}=t;if(!u)return null;const s=t.useTickMarkFormat?ut:pt,p=u.span.midspanFt,c=u.clearances.groundClearance,b=p==null?!0:p>=c,r=u.clearances.powerClearanceDistribution||40/12,m=Oe(t.existingPowerHeight),P=u.attach.proposedAttachFt,S=m!=null&&P!=null?m-P:null,T=S==null?!0:S>=r,j=Math.round(r*12),C=(t.jobs||[]).find(q=>q.id===t.currentJobId),N=(C==null?void 0:C.submissionProfileName)||t.currentSubmissionProfile,K=(t.submissionProfiles||[]).find(q=>q.name===N)||{},Q={...K,...(C==null?void 0:C.submissionProfileOverrides)||{},name:K==null?void 0:K.name},O=((V=u.attach)==null?void 0:V.recommendation)||{};return e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"font-medium mb-2",children:"Standards Compliance"}),e.jsxs("div",{className:"text-sm grid md:grid-cols-2 gap-2",children:[e.jsxs("div",{className:b?"text-emerald-700":"text-red-700",children:["Ground/Midspan: ",p!=null?s(p):"â€”"," vs target"," ",s(c)," â€” ",b?"PASS":"FAIL"]}),e.jsxs("div",{className:T?"text-emerald-700":"text-red-700",children:["Comm-to-Power at pole: ",S!=null?s(S):"â€”"," vs target"," ",s(r)," (",j,'") â€” ',T?"PASS":"FAIL"]})]}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:'FE/Mon Power presets enforce 18 ft over roads and 44" comm-to-power. NESC or utility default is typically 40" when FE doesnâ€™t apply.'}),e.jsxs("div",{className:"mt-2 text-xs text-gray-700 grid md:grid-cols-3 gap-2",children:[e.jsxs("div",{children:["Owner: ",t.jobOwner||"â€”"]}),e.jsxs("div",{children:["Profile: ",Q.name||"â€”"]}),e.jsxs("div",{children:["Min Comm Attach:"," ",Q.minCommAttachFt!=null?s(Q.minCommAttachFt):"â€”"]}),e.jsxs("div",{className:"md:col-span-3",children:["Basis: ",O.basis||"â€”",O.detail?` â€” ${O.detail}`:""]}),e.jsxs("div",{children:["Separation Used:"," ",O.clearanceIn!=null?`${O.clearanceIn}"`:"â€”"]}),e.jsxs("div",{children:["Controlling: ",((D=O.controlling)==null?void 0:D.name)||"â€”",((Z=O.controlling)==null?void 0:Z.ft)!=null?` @ ${s(O.controlling.ft)}`:""]})]})]})}function ys(){var j;const{results:t,warnings:u,engineeringNotes:s,makeReadyNotes:p,costAnalysis:c,projectName:b,applicantName:r,jobNumber:m,logoDataUrl:P,existingLines:S}=ne(),T=L.useMemo(()=>{try{const C=(S||[]).reduce((N,K)=>{if(!(K!=null&&K.makeReady))return N;const Q=Oe(K.height),O=Oe(K.makeReadyHeight);if(Q==null||O==null)return N;const V=K.companyName||"â€”",D=Math.abs(Math.round((O-Q)*12)),Z=D*12.5,q=N[V]||{rows:0,deltaInches:0,totalCost:0};return q.rows+=1,q.deltaInches+=D,q.totalCost+=Z,N[V]=q,N},{});return Object.entries(C)}catch(C){return console.error("Error aggregating existing lines:",C),[]}},[S]);return t?e.jsxs("div",{className:"grid gap-4 text-left",children:[e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Pole Attachment Report"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Project: ",b||"â€”"," | Applicant: ",r||"â€”"," | Job #: ",m||"â€”"]})]}),e.jsxs("div",{className:"text-right",children:[P?e.jsx("img",{src:P,alt:"Logo",className:"h-10 inline-block"}):e.jsx("div",{className:"text-2xl font-bold",children:"PolePro"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Generated ",new Date().toLocaleDateString()]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Pole"}),e.jsxs("div",{children:["Height: ",Qe(t.pole.inputHeight)," | Above-ground:"," ",Qe(t.pole.aboveGroundFt)," | Buried:"," ",Qe(t.pole.buriedFt)]}),t.pole.latitude!=null&&t.pole.longitude!=null?e.jsxs("div",{children:["GPS: ",t.pole.latitude,", ",t.pole.longitude]}):null]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Attachment & Span"}),e.jsxs("div",{children:["Attach: ",t.attach.proposedAttachFmt," | Span:"," ",t.span.spanFt," ft | Sag: ",t.span.sagFmt," | Midspan:"," ",t.span.midspanFmt]}),e.jsx("div",{className:"my-2",children:e.jsx(vt,{attachFt:t.attach.proposedAttachFt,midspanFt:t.span.midspanFt,spanFt:t.span.spanFt,groundTargetFt:t.clearances.groundClearance})}),t.guy?e.jsxs("div",{children:["Guying: ",t.guy.required?"Required":"Not required"," | Tension: ",Math.round(t.guy.tension||0)," lb | Angle:"," ",Math.round(t.guy.angle||0),"Â°"]}):null]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Clearances (targets)"}),e.jsxs("div",{children:["Ground: ",Qe(t.clearances.groundClearance)," | Road:"," ",Qe(t.clearances.roadClearance)," | Min top:"," ",Qe(t.clearances.minimumPoleTopSpace)]})]}),p?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Make-ready"}),e.jsx("pre",{className:"text-xs whitespace-pre-wrap break-anywhere",children:p}),e.jsxs("div",{className:"mt-1",children:["Make-ready total: $",(j=t.makeReadyTotal)!=null?j:0]})]}):null,T!=null&&T.length?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Make-ready Summary (by company)"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600",children:[e.jsx("th",{className:"p-1",children:"Company"}),e.jsx("th",{className:"p-1",children:"Rows"}),e.jsx("th",{className:"p-1",children:"Î” (in)"}),e.jsx("th",{className:"p-1",children:"Est. Cost"})]})}),e.jsx("tbody",{children:T.map(([C,N])=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-1",children:C}),e.jsx("td",{className:"p-1",children:N.rows}),e.jsx("td",{className:"p-1",children:N.deltaInches}),e.jsxs("td",{className:"p-1",children:["$",N.totalCost]})]},C))})]})]}):null,u!=null&&u.length?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Warnings"}),e.jsx("ul",{className:"list-disc pl-5 text-sm",children:u.map((C,N)=>e.jsx("li",{children:C},N))})]}):null,s!=null&&s.length?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Engineering Notes"}),e.jsx("ul",{className:"list-disc pl-5 text-sm",children:s.map((C,N)=>e.jsx("li",{children:C},N))})]}):null,e.jsxs("div",{className:"font-semibold",children:["Estimated Cost: $",c!=null?c:0]}),e.jsx("div",{className:"no-print",children:e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>window.print(),children:"Print / Save PDF"})})]}):e.jsx("div",{className:"text-sm text-gray-600",children:"No results to display. Please compute analysis first."})}function Ns(){const t=ne(),u=()=>({poleHeight:t.poleHeight,poleClass:t.poleClass,existingPowerHeight:t.existingPowerHeight,existingPowerVoltage:t.existingPowerVoltage,spanDistance:t.spanDistance,adjacentPoleHeight:t.adjacentPoleHeight,attachmentType:t.attachmentType,cableDiameter:t.cableDiameter,windSpeed:t.windSpeed,spanEnvironment:t.spanEnvironment,streetLightHeight:t.streetLightHeight,dripLoopHeight:t.dripLoopHeight,proposedLineHeight:t.proposedLineHeight,iceThicknessIn:t.iceThicknessIn,hasTransformer:t.hasTransformer,presetProfile:t.presetProfile,existingLines:t.existingLines}),s=p=>{p&&(t.setPoleHeight(p.poleHeight),t.setPoleClass(p.poleClass),t.setExistingPowerHeight(p.existingPowerHeight),t.setExistingPowerVoltage(p.existingPowerVoltage),t.setSpanDistance(p.spanDistance),t.setAdjacentPoleHeight(p.adjacentPoleHeight),t.setAttachmentType(p.attachmentType),t.setCableDiameter(p.cableDiameter),t.setWindSpeed(p.windSpeed),t.setSpanEnvironment(p.spanEnvironment),t.setStreetLightHeight(p.streetLightHeight),t.setDripLoopHeight(p.dripLoopHeight),t.setProposedLineHeight(p.proposedLineHeight),t.setIceThicknessIn(p.iceThicknessIn),t.setHasTransformer(p.hasTransformer),t.setPresetProfile(p.presetProfile),t.setExistingLines(p.existingLines))};return e.jsxs("div",{className:"flex items-center gap-2 my-2",children:[e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>t.setScenarioA(u()),children:"Save A"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>t.setScenarioB(u()),children:"Save B"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>s(t.scenarioA),disabled:!t.scenarioA,children:"Load A"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>s(t.scenarioB),disabled:!t.scenarioB,children:"Load B"})]})}function ws(){const{results:t,warnings:u,makeReadyNotes:s,useTickMarkFormat:p}=ne(),c=()=>{const r=Gt(t,u,s,{useTickMarks:p}),m=new Blob([r],{type:"text/csv;charset=utf-8;"}),P=URL.createObjectURL(m),S=document.createElement("a");S.href=P,S.download="pole-analysis.csv",S.click(),URL.revokeObjectURL(P)},b=()=>{window.print()};return e.jsxs("div",{className:"flex items-center gap-2 my-2",children:[e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:c,disabled:!t,children:"Export CSV"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:b,disabled:!t,children:"Export PDF"}),e.jsx(Ps,{}),e.jsx(Ss,{})]})}function Ps(){const t=ne(),[u,s]=L.useState(!1),[p,c]=L.useState(!1),b=L.useRef(null),r=L.useCallback(()=>{c(!0),b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{he(()=>import("./app-utils-BDwnIIkN.js").then(T=>T.e),__vite__mapDeps([3,4,5,6,7,2,8])).then(T=>{var j;return(j=T.loadPdfLib)==null?void 0:j.call(T)}).then(()=>s(!0)).catch(()=>{})},150)},[]),m=L.useCallback(()=>{c(!1),b.current&&(clearTimeout(b.current),b.current=null)},[]),P=async()=>{var T,j,C,N,K,Q,O,V,D,Z,q,F,h,z,H,o,J,W,X,a,l,d,k,le,ue,Ee,De,_e,Re,Ke,Me,qe,Ue,We,Be,Ve,Ge,Ye,i,x,E,y,A,U,R;try{const g=(await he(async()=>{const{default:$}=await import("./zip-utils-BoTj1NZG.js").then(ee=>ee.j);return{default:$}},__vite__mapDeps([1,2]))).default,M=new g,{buildMM109PDF:re,buildCSXPDF:w}=await he(async()=>{const{buildMM109PDF:$,buildCSXPDF:ee}=await import("./app-permits-Dftu4pdj.js").then(G=>G.a);return{buildMM109PDF:$,buildCSXPDF:ee}},__vite__mapDeps([9,3,4,5,6,7,2,8])),{buildMM109Fields:_,buildCSXFields:f,buildStateHighwayFields:v}=await he(async()=>{const{buildMM109Fields:$,buildCSXFields:ee,buildStateHighwayFields:G}=await import("./app-utils-BDwnIIkN.js").then(pe=>pe.f);return{buildMM109Fields:$,buildCSXFields:ee,buildStateHighwayFields:G}},__vite__mapDeps([3,4,5,6,7,2,8])),{detectPermitIssues:I}=await he(async()=>{const{detectPermitIssues:$}=await import("./app-utils-BDwnIIkN.js").then(ee=>ee.g);return{detectPermitIssues:$}},__vite__mapDeps([3,4,5,6,7,2,8])),{buildTemplatesText:Y}=await he(async()=>{const{buildTemplatesText:$}=await import("./app-utils-BDwnIIkN.js").then(ee=>ee.p);return{buildTemplatesText:$}},__vite__mapDeps([3,4,5,6,7,2,8])),se=(t.jobs||[]).find($=>$.id===t.currentJobId),me=(se==null?void 0:se.submissionProfileName)||t.currentSubmissionProfile,xe=(t.submissionProfiles||[]).find($=>$.name===me)||{},de={...xe,...(se==null?void 0:se.submissionProfileOverrides)||{},name:xe==null?void 0:xe.name},ae=t.spanEnvironment,be=t.results;if(!be){alert("Run analysis first.");return}const B=kt({env:ae,results:be,job:se,effectiveProfile:de,cachedMidspans:t.cachedMidspans,store:t});M.file("permit/summary.json",JSON.stringify(B,null,2));let Ae;ae==="railroad"?Ae=f(B):ae==="wvHighway"?Ae=_(B):ae==="paHighway"?Ae=v(B,"PennDOT"):ae==="ohHighway"?Ae=v(B,"ODOT"):ae==="mdHighway"?Ae=v(B,"MDOT SHA"):Ae=_(B),M.file("permit/fields.json",JSON.stringify(Ae,null,2));const mt=Y(ae);mt&&M.file("permit/templates.txt",mt);const at=I(B),ht=at.length?["# Issues detected","",...at.map($=>`- ${$}`)].join(`
`):`# Issues detected

None`;M.file("permit/issues.txt",ht);try{const $=(t.collectedPoles||[]).filter(ee=>!t.currentJobId||ee.jobId===t.currentJobId);if($.length){const ee=["id","latitude","longitude","plannedAttach","asBuiltAttach","varianceIn","variancePass","hasPhoto","status","timestamp"],G=$.map(ge=>{var $e,Nt,wt;return[ge.id||"",ge.latitude||"",ge.longitude||"",ge.height||"",(($e=ge.asBuilt)==null?void 0:$e.attachHeight)||"",He((Nt=ge.asBuilt)==null?void 0:Nt.attachHeight,ge.height),je((wt=ge.asBuilt)==null?void 0:wt.attachHeight,ge.height,t.presetProfile),ge.photoDataUrl?"Y":"N",ge.status||"draft",ge.timestamp||""]}),pe=[ee.join(","),...G.map(ge=>ge.map($e=>`${String($e).replaceAll('"','""')}`).join(","))].join(`
`);M.file("permit/pci-summary.csv",pe);const ie=$.filter(ge=>(ge.status||"draft")==="done").length,Ie=$.filter(ge=>{var $e;return je(($e=ge.asBuilt)==null?void 0:$e.attachHeight,ge.height,t.presetProfile)==="PASS"}).length,$t=$.filter(ge=>{var $e;return je(($e=ge.asBuilt)==null?void 0:$e.attachHeight,ge.height,t.presetProfile)==="FAIL"}).length,Ot=$.filter(ge=>!!ge.photoDataUrl).length,_t=["# PCI Summary","",`Total: ${$.length}`,`Done: ${ie}`,`PASS: ${Ie}`,`FAIL: ${$t}`,`Photos: ${Ot}`].join(`
`);M.file("permit/pci-summary.txt",_t)}}catch{}if((t.cachedMidspans||[]).length){const $=[["spanId","environment","spanFt","spanLenSource","midspanFt","targetFt","attachFt","pass","deficitFt","deltaFt","midLat","midLon","fromId","toId","fromLat","fromLon","toLat","toLon","segments"]];for(const G of t.cachedMidspans||[])$.push([(T=G.spanId)!=null?T:"",(j=G.environment)!=null?j:"",(C=G.spanFt)!=null?C:"",(N=G.spanLenSource)!=null?N:"",(K=G.midspanFt)!=null?K:"",(Q=G.targetFt)!=null?Q:"",(O=G.attachFt)!=null?O:"",G.pass===!0?"PASS":G.pass===!1?"FAIL":"",(V=G.deficitFt)!=null?V:"",(D=G.deltaFt)!=null?D:"",(Z=G.midLat)!=null?Z:"",(q=G.midLon)!=null?q:"",(F=G.fromId)!=null?F:"",(h=G.toId)!=null?h:"",(z=G.fromLat)!=null?z:"",(H=G.fromLon)!=null?H:"",(o=G.toLat)!=null?o:"",(J=G.toLon)!=null?J:"",Array.isArray(G.segments)?G.segments.map(pe=>`${pe.env}:${pe.portion||""}`).join("|"):""]);const ee=$.map(G=>G.map(pe=>String(pe).replaceAll('"','""')).map(pe=>pe.includes(",")?`"${pe}"`:pe).join(",")).join(`
`);M.file("permit/cached-midspans.csv",ee);try{const G=[["spanId","environment","midspanFt","targetFt","status"]];for(const ie of t.cachedMidspans||[]){const Ie=ie.midspanFt!=null&&ie.targetFt!=null?Number(ie.midspanFt)>=Number(ie.targetFt):"";G.push([(W=ie.spanId)!=null?W:"",(X=ie.environment)!=null?X:"",(a=ie.midspanFt)!=null?a:"",(l=ie.targetFt)!=null?l:"",Ie===""?"":Ie?"PASS":"FAIL"])}const pe=G.map(ie=>ie.map(Ie=>String(Ie).replaceAll('"','""')).join(",")).join(`
`);M.file("permit/midspan-eval.csv",pe)}catch{}try{const G=[["spanId","environment","pass","deficitFt","deltaFt","spanLenSource","spanFt","midspanFt","targetFt","fromId","toId","midLat","midLon"]];for(const ie of t.cachedMidspans||[])G.push([(d=ie.spanId)!=null?d:"",(k=ie.environment)!=null?k:"",ie.pass===!0?"PASS":ie.pass===!1?"FAIL":"",(le=ie.deficitFt)!=null?le:"",(ue=ie.deltaFt)!=null?ue:"",(Ee=ie.spanLenSource)!=null?Ee:"",(De=ie.spanFt)!=null?De:"",(_e=ie.midspanFt)!=null?_e:"",(Re=ie.targetFt)!=null?Re:"",(Ke=ie.fromId)!=null?Ke:"",(Me=ie.toId)!=null?Me:"",(qe=ie.midLat)!=null?qe:"",(Ue=ie.midLon)!=null?Ue:""]);const pe=G.map(ie=>ie.map(Ie=>String(Ie).replaceAll('"','""')).join(",")).join(`
`);M.file("permit/qa-summary.csv",pe)}catch{}}const te=800,Te=300,ce=40,Je=Te-ce,ze=$=>{const ee=Math.max((be.attach.proposedAttachFt||0)+5,(be.span.midspanFt||0)+5,(be.clearances.groundClearance||0)+5),G=Je-($||0)/Math.max(1,ee)*(Te-2*ce);return Math.max(ce,Math.min(Je,G))},Pe=ce+60,Se=te-ce-60,Xe=ze(be.attach.proposedAttachFt||0),rt=ze(be.attach.proposedAttachFt||0),it=ze(be.span.midspanFt||0),n=ze(((Be=(We=B==null?void 0:B.span)==null?void 0:We.targetFt)!=null?Be:be.clearances.groundClearance)||0),oe=`M ${Pe} ${Xe} Q ${(Pe+Se)/2} ${it} ${Se} ${rt}`,ve=be.span.spanFt||0,ye=Se-Pe,we=ce,Le=Te-10,lt=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="${te}" height="${Te}" viewBox="0 0 ${te} ${Te}">
  <rect width="100%" height="100%" fill="#fff"/>
  <g stroke="#333" stroke-width="2" fill="none">
    <line x1="${Pe}" y1="${Je}" x2="${Pe}" y2="${ce}"/>
    <line x1="${Se}" y1="${Je}" x2="${Se}" y2="${ce}"/>
    <path d="${oe}" stroke="#1f77b4"/>
    <line x1="${ce}" y1="${Je}" x2="${te-ce}" y2="${Je}" stroke="#666" stroke-dasharray="4 4"/>
    <line x1="${ce}" y1="${n}" x2="${te-ce}" y2="${n}" stroke="#e53935" stroke-dasharray="6 6"/>
  </g>
  <g stroke="#000" stroke-width="1" fill="none">
    <line x1="${we}" y1="${Le}" x2="${we+ye}" y2="${Le}"/>
    <line x1="${we}" y1="${Le-5}" x2="${we}" y2="${Le+5}"/>
    <line x1="${we+ye}" y1="${Le-5}" x2="${we+ye}" y2="${Le+5}"/>
  </g>
  <g fill="#1f77b4" stroke="none">
    <circle cx="${Pe}" cy="${Xe}" r="3"/>
    <circle cx="${Se}" cy="${rt}" r="3"/>
    <circle cx="${(Pe+Se)/2}" cy="${it}" r="3"/>
  </g>
  <g font-family="sans-serif" font-size="12" fill="#333">
    <text x="${Pe-20}" y="${ce+12}" transform="rotate(-90 ${Pe-20} ${ce+12})">Pole</text>
    <text x="${Se+20}" y="${ce+12}" transform="rotate(90 ${Se+20} ${ce+12})">Pole</text>
    <text x="${Pe+6}" y="${Xe-6}" fill="#1f77b4">Attach A</text>
    <text x="${Se-6}" y="${rt-6}" fill="#1f77b4" text-anchor="end">Attach B</text>
    <text x="${(Pe+Se)/2+6}" y="${it-8}" fill="#1f77b4">Midspan ${((Ge=(Ve=be.span.midspanFt)==null?void 0:Ve.toFixed)==null?void 0:Ge.call(Ve,1))||be.span.midspanFt} ft</text>
    <text x="${te/2}" y="${n-6}" text-anchor="middle" fill="#e53935">Ground target ${((x=(i=(Ye=B==null?void 0:B.span)==null?void 0:Ye.targetFt)==null?void 0:i.toFixed)==null?void 0:x.call(i,1))||((E=B==null?void 0:B.span)==null?void 0:E.targetFt)} ft</text>
    <text x="${we+ye/2}" y="${Le-6}" text-anchor="middle">~${Math.round(ve)} ft</text>
    <text x="${ce}" y="20" fill="#555">${(B==null?void 0:B.type)||""} â€” target ${((y=B==null?void 0:B.span)==null?void 0:y.targetFt)||""} ft (${((A=B==null?void 0:B.span)==null?void 0:A.targetSource)||"computed"})</text>
  </g>
</svg>`;M.file("permit/plan-profile.svg",lt);try{const{buildGeoJSON:$}=await he(async()=>{const{buildGeoJSON:pe}=await import("./app-geodata-OF3I9fsg.js").then(ie=>ie.g);return{buildGeoJSON:pe}},__vite__mapDeps([0,1,2])),ee=t.collectedPoles||t.importedPoles||[],G=t.importedSpans||[];if(ee.length||G.length){const pe=$({poles:ee,spans:G,job:se});M.file("permit/geodata.geojson",JSON.stringify(pe,null,2))}}catch{}if(ae==="wvHighway"){const $=await re(B);M.file("permit/mm109-draft.pdf",$)}else if(ae==="railroad"){const $=await w(B);M.file("permit/railroad-draft.pdf",$)}const ke=(t.collectedPoles||[]).filter($=>!t.currentJobId||$.jobId===t.currentJobId),ot=ke.filter($=>($.status||"draft")==="done").length,ct=ke.filter($=>{var ee;return je((ee=$.asBuilt)==null?void 0:ee.attachHeight,$.height,t.presetProfile)==="PASS"}).length,Et=ke.filter($=>{var ee;return je((ee=$.asBuilt)==null?void 0:ee.attachHeight,$.height,t.presetProfile)==="FAIL"}).length,At=ke.filter($=>!!$.photoDataUrl).length,Tt=$=>{const ee=Math.abs(Number($)||0);return ee<=2?'â‰¤2"':ee<=6?'3â€“6"':ee<=12?'7â€“12"':'>12"'},dt={'â‰¤2"':0,'3â€“6"':0,'7â€“12"':0,'>12"':0};for(const $ of ke){const ee=Number($.height)||0,G=Number((U=$.asBuilt)==null?void 0:U.attachHeight)||0;if(!ee||!G)continue;const pe=(G-ee)*12;dt[Tt(pe)]++}const xt=t.cachedMidspans||[],Ne=(()=>{if(!xt.length)return null;const $={total:xt.length,pass:0,fail:0,unknown:0,sources:{auto:0,lengthFt:0,estimatedLengthFt:0,unknown:0},withEndpoints:0},ee={"â‰¤5ft":0,"6â€“15ft":0,"16â€“30ft":0,">30ft":0};for(const G of xt){G.pass===!0?$.pass++:G.pass===!1?$.fail++:$.unknown++;const pe=G.spanLenSource||"unknown";$.sources[pe]=($.sources[pe]||0)+1,!!(G.fromLat&&G.fromLon&&G.toLat&&G.toLon)&&$.withEndpoints++;const Ie=Number(G.deltaFt);Number.isFinite(Ie)&&(Ie<=5?ee["â‰¤5ft"]++:Ie<=15?ee["6â€“15ft"]++:Ie<=30?ee["16â€“30ft"]++:ee[">30ft"]++)}return{counts:$,buckets:ee}})(),Dt=["# Permit Package","",`Type: ${B.type}`,`Job: ${B.job.name} (${B.job.jobNumber})`,`Environment: ${ae}`,`Submission Profile: ${B.job.submissionProfileName||(de==null?void 0:de.name)||""}`,`Manifest Type: ${(de==null?void 0:de.manifestType)||""}`,`Target Source: ${((R=B==null?void 0:B.span)==null?void 0:R.targetSource)||"computed"}`,`Issues: ${at.length}`,"",Ne?`QA/QC â€” Spans cached: ${Ne.counts.total} | PASS: ${Ne.counts.pass} | FAIL: ${Ne.counts.fail} | Unknown: ${Ne.counts.unknown}`:"",Ne?`QA/QC â€” With endpoints: ${Ne.counts.withEndpoints} | Sources â€” auto: ${Ne.counts.sources.auto}, manual: ${Ne.counts.sources.lengthFt}, est: ${Ne.counts.sources.estimatedLengthFt}, unknown: ${Ne.counts.sources.unknown}`:"",Ne?`QA/QC â€” Î” buckets (ft): â‰¤5: ${Ne.buckets["â‰¤5ft"]}, 6â€“15: ${Ne.buckets["6â€“15ft"]}, 16â€“30: ${Ne.buckets["16â€“30ft"]}, >30: ${Ne.buckets[">30ft"]}`:"","",ke.length?`PCI Totals â€” Done: ${ot} | PASS: ${ct} | FAIL: ${Et} | Photos: ${At}`:"",ke.length?`Variance buckets (in): â‰¤2: ${dt['â‰¤2"']} | 3â€“6: ${dt['3â€“6"']} | 7â€“12: ${dt['7â€“12"']} | >12: ${dt['>12"']}`:"",(ke.length,""),"Files:","- summary.json: Data used to prepare the application","- fields.json: Normalized key-value fields for form population (MM109/CSX)","- plan-profile.svg: Simple plan/profile diagram","- templates.txt: Official template links and requirements for the selected agency","- cached-midspans.csv: Cached spans with midspan/target used, plus PASS/FAIL and Î” when available","- midspan-eval.csv: PASS/FAIL evaluation of cached midspans versus targets","- qa-summary.csv: Per-span QA/QC export (PASS/FAIL, deficit, Î”, sources)","- pci-summary.csv: Post Construction Inspection rollup for collected poles (if any)","- pci-summary.txt: Totals for PCI (done/pass/fail/photos)","- checklist.txt: Pre-submission checklist to validate required fields","- issues.txt: Auto-detected missing fields or data gaps",ae==="wvHighway"?"- mm109-draft.pdf: Draft application with populated fields":"",ae==="paHighway"||ae==="ohHighway"||ae==="mdHighway"?"- (no draft PDF included; use fields.json + summary)":"",ae==="railroad"?"- railroad-draft.pdf: Draft CSX application with populated fields":""].join(`
`);M.file("permit/README.txt",Dt);const Ht=["# Pre-submission Checklist","",`- [${B.job.name?"x":" "}] Job name`,`- [${B.job.jobNumber?"x":" "}] Job number`,`- [${B.job.applicant?"x":" "}] Applicant`,`- [${B.pole.heightFt?"x":" "}] Pole height`,`- [${B.power.heightFt?"x":" "}] Power height`,`- [${B.span.lengthFt?"x":" "}] Span length`,`- [${B.span.midspanFt?"x":" "}] Midspan`,`- [${B.span.targetFt?"x":" "}] Ground clearance target`,"","Attach supporting photos, maps, and any utility-specific forms as needed."].join(`
`);M.file("permit/checklist.txt",Ht);const Rt=await M.generateAsync({type:"blob"}),yt=URL.createObjectURL(Rt),gt=document.createElement("a");gt.href=yt,gt.download=`${B.type.replace(/[^A-Za-z0-9_-]/g,"_")}_permit_pack.zip`,gt.click(),URL.revokeObjectURL(yt)}catch(g){alert(`Permit pack failed: ${(g==null?void 0:g.message)||g}`)}},S=["wvHighway","paHighway","ohHighway","mdHighway","railroad"].includes(t.spanEnvironment);return e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onMouseEnter:r,onMouseLeave:m,onClick:P,disabled:!t.results||!S,title:S?"Generate permit package":"Select WV Highway or Railroad environment",children:"Export Permit Pack"}),p&&!u?e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"Warming up PDF toolsâ€¦"}):null]})}function Ss(){const t=ne(),[u,s]=L.useState(!1),[p,c]=L.useState("csv"),[b,r]=L.useState("generic"),[m,P]=L.useState(!0),[S,T]=L.useState(!0),[j,C]=L.useState(!0),[N,K]=L.useState("");L.useEffect(()=>{const O=(t.jobs||[]).find(V=>V.id===t.currentJobId);O!=null&&O.exportProfile&&r(O.exportProfile)},[t.jobs,t.currentJobId]);const Q=async()=>{try{K("");const O=(await he(async()=>{const{default:H}=await import("./zip-utils-BoTj1NZG.js").then(o=>o.j);return{default:H}},__vite__mapDeps([1,2]))).default,V=new O,D=m?t.importedPoles||[]:[],Z=S?t.importedSpans||[]:[],q=j?t.existingLines||[]:[];if(p==="csv"){if(D.length&&V.file("export/poles.csv",ss(D,b)),Z.length&&V.file("export/spans.csv",ns(Z,b)),q.length&&V.file("export/existing-lines.csv",as(q,b)),b==="firstEnergy"&&(t.cachedMidspans||[]).length){const H=(t.jobs||[]).find(o=>o.id===t.currentJobId);V.file("export/fe-joint-use.csv",is({cachedMidspans:t.cachedMidspans,job:H}))}}else if(p==="geojson"){const H=ls({poles:D,spans:Z});V.file("export/data.geojson",JSON.stringify(H))}else if(p==="kml"){const H=rs({poles:D,spans:Z});V.file("export/data.kml",H)}else if(p==="shapefile")try{const{buildGeoJSON:H,exportShapefile:o}=await he(async()=>{const{buildGeoJSON:X,exportShapefile:a}=await import("./app-geodata-OF3I9fsg.js").then(l=>l.g);return{buildGeoJSON:X,exportShapefile:a}},__vite__mapDeps([0,1,2])),J=H({poles:D,spans:Z}),W=await o(J,"data-shapefile.zip",!1);W?(V.file("export/data-shapefile.zip",W),V.file("export/data.geojson",JSON.stringify(J)),V.file("export/README.txt","Shapefile (ZIP) and GeoJSON provided. Shapefile generated via CDN-loaded shp-write.")):(V.file("export/data.geojson",JSON.stringify(J)),V.file("export/README.txt","Shapefile export unavailable; GeoJSON included as an alternative."),K("Shapefile export unavailable; provided GeoJSON instead."))}catch(H){console.warn("Shapefile export failed completely",H),K(`Export failed: ${H.message}`)}const F=await V.generateAsync({type:"blob"}),h=URL.createObjectURL(F),z=document.createElement("a");z.href=h,z.download=`interop-export-${b}.zip`,z.click(),URL.revokeObjectURL(h),s(!1)}catch(O){console.error("Export failed:",O),K(`Export failed: ${O.message}`)}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>s(!0),children:"Interop Export"}),u?e.jsx("div",{className:"fixed inset-0 bg-black/30 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded shadow-lg w-[90vw] max-w-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:"Interop Export"}),e.jsx("button",{className:"text-sm",onClick:()=>s(!1),children:"Close"})]}),e.jsxs("div",{className:"grid gap-2 text-sm",children:[e.jsxs("label",{className:"grid gap-1",children:[e.jsx("span",{className:"font-medium",children:"Preset"}),e.jsx("select",{className:"border rounded px-2 py-1",value:b,onChange:O=>r(O.target.value),children:(ts||[]).map(O=>e.jsx("option",{value:O.value,children:O.label},O.value))})]}),e.jsxs("label",{className:"grid gap-1",children:[e.jsx("span",{className:"font-medium",children:"Format"}),e.jsxs("select",{className:"border rounded px-2 py-1",value:p,onChange:O=>c(O.target.value),children:[e.jsx("option",{value:"csv",children:"CSV (ZIP)"}),e.jsx("option",{value:"geojson",children:"GeoJSON (ZIP)"}),e.jsx("option",{value:"kml",children:"KML (ZIP)"}),e.jsx("option",{value:"shapefile",children:"Shapefile (ZIP)"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-1",children:[e.jsxs("label",{className:"inline-flex items-center gap-1 text-sm",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:O=>P(O.target.checked)})," ","Poles"]}),e.jsxs("label",{className:"inline-flex items-center gap-1 text-sm",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:O=>T(O.target.checked)})," ","Spans"]}),e.jsxs("label",{className:"inline-flex items-center gap-1 text-sm",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:O=>C(O.target.checked)})," ","Existing Lines"]})]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Uses current jobâ€™s export profile by default. CSV headers align to the chosen preset."}),N&&e.jsx("div",{className:"mt-2 text-sm text-red-600",children:N}),e.jsx("button",{className:"mt-2 px-3 py-1 border rounded",onClick:Q,children:"Export"})]})]})}):null]})}function Cs({openHelp:t,showBottomActions:u=!0}){var Re,Ke,Me,qe,Ue,We,Be,Ve,Ge,Ye;const s=ne(),[p,c]=L.useState(""),[b,r]=L.useState(!1),[m,P]=L.useState(""),S=L.useRef(null),T=L.useRef(null),[j,C]=L.useState("all"),[N,K]=L.useState("all"),[Q,O]=L.useState("all"),[V,D]=L.useState(!0),[Z,q]=L.useState(""),F=async i=>{if(!("geolocation"in navigator)){alert("Geolocation not supported");return}try{const x=await new Promise((A,U)=>navigator.geolocation.getCurrentPosition(A,U,{enableHighAccuracy:!0,timeout:1e4})),{latitude:E,longitude:y}=x.coords||{};E!=null&&y!=null&&s.updateCollectedPole(i,{latitude:E.toFixed(6),longitude:y.toFixed(6)})}catch(x){alert(`Failed to get location: ${(x==null?void 0:x.message)||x}`)}},h=async()=>{var i;r(!0);try{const E={id:p||`${(((i=s.collectedPoles)==null?void 0:i.length)||0)+1}`,latitude:s.poleLatitude||"",longitude:s.poleLongitude||"",height:s.poleHeight||"",poleClass:s.poleClass||"",powerHeight:s.existingPowerHeight||"",voltage:s.existingPowerVoltage||"distribution",hasTransformer:!!s.hasTransformer,spanDistance:s.spanDistance||"",adjacentPoleHeight:s.adjacentPoleHeight||"",attachmentType:s.attachmentType||"",status:"done",photoDataUrl:m||"",timestamp:Z||new Date().toISOString(),jobId:s.currentJobId||""};s.addCollectedPole(E),c(""),s.setPoleLatitude(""),s.setPoleLongitude(""),P("")}finally{r(!1)}},z=async()=>{var i;r(!0);try{const E={id:p||`${(((i=s.collectedPoles)==null?void 0:i.length)||0)+1}`,latitude:s.poleLatitude||"",longitude:s.poleLongitude||"",height:s.poleHeight||"",poleClass:s.poleClass||"",powerHeight:s.existingPowerHeight||"",voltage:s.existingPowerVoltage||"distribution",hasTransformer:!!s.hasTransformer,spanDistance:s.spanDistance||"",adjacentPoleHeight:s.adjacentPoleHeight||"",attachmentType:s.attachmentType||"",status:"draft",photoDataUrl:m||"",timestamp:Z||new Date().toISOString(),jobId:s.currentJobId||""};s.addCollectedPole(E),c(""),P("")}finally{r(!1)}},H=async i=>{if(i)try{const x=new FileReader;x.onload=async()=>{var y,A;const E=String(x.result||"");P(E);try{const{default:U}=await he(async()=>{const{default:g}=await import("./vendor-Cv8-97MN.js").then(M=>M.x);return{default:g}},__vite__mapDeps([8,2])),R=await U(i,{gps:!0});if(R){const g=(y=R.GPS)==null?void 0:y.latitude,M=(A=R.GPS)==null?void 0:A.longitude,re=R.DateTimeOriginal||R.CreateDate;typeof g=="number"&&typeof M=="number"&&(s.poleLatitude||s.setPoleLatitude(g.toFixed(6)),s.poleLongitude||s.setPoleLongitude(M.toFixed(6))),re&&!isNaN(new Date(re).getTime())&&q(new Date(re).toISOString())}}catch{}},x.readAsDataURL(i)}catch{}},o=()=>{const i=(s.jobs||[]).find(g=>g.id===s.currentJobId),x=["id","latitude","longitude","height","class","powerHeight","voltage","hasTransformer","spanDistance","adjacentPoleHeight","attachmentType","status","hasPhoto","timestamp","asBuiltAttachHeight","asBuiltPowerHeight","varianceIn","variancePass","commCompany"],E=(s.collectedPoles||[]).filter(g=>!s.currentJobId||g.jobId===s.currentJobId).map(g=>{var M,re,w,_;return[g.id||"",g.latitude||"",g.longitude||"",g.height||"",g.poleClass||"",g.powerHeight||"",g.voltage||"",g.hasTransformer?"Y":"N",g.spanDistance||"",g.adjacentPoleHeight||"",g.attachmentType||"",g.status||"draft",g.photoDataUrl?"Y":"N",g.timestamp||"",((M=g.asBuilt)==null?void 0:M.attachHeight)||"",((re=g.asBuilt)==null?void 0:re.powerHeight)||"",He((w=g.asBuilt)==null?void 0:w.attachHeight,g.height),je((_=g.asBuilt)==null?void 0:_.attachHeight,g.height,s.presetProfile),(i==null?void 0:i.commCompany)||""]}),y=[x.join(","),...E.map(g=>g.map(M=>`${String(M).replaceAll('"','""')}`).join(","))].join(`
`),A=new Blob([y],{type:"text/csv;charset=utf-8;"}),U=URL.createObjectURL(A),R=document.createElement("a");R.href=U,R.download="collected-poles.csv",R.click(),URL.revokeObjectURL(U)},J=()=>{const i=(s.collectedPoles||[]).filter(g=>!s.currentJobId||g.jobId===s.currentJobId).slice(0,25),x=["id","latitude","longitude","height","class","powerHeight","voltage","hasTransformer","spanDistance","adjacentPoleHeight","attachmentType","status","hasPhoto","timestamp","asBuiltAttachHeight","asBuiltPowerHeight","varianceIn","variancePass"],E=i.map(g=>{var M,re,w,_;return[g.id||"",g.latitude||"",g.longitude||"",g.height||"",g.poleClass||"",g.powerHeight||"",g.voltage||"",g.hasTransformer?"Y":"N",g.spanDistance||"",g.adjacentPoleHeight||"",g.attachmentType||"",g.status||"draft",g.photoDataUrl?"Y":"N",g.timestamp||"",((M=g.asBuilt)==null?void 0:M.attachHeight)||"",((re=g.asBuilt)==null?void 0:re.powerHeight)||"",He((w=g.asBuilt)==null?void 0:w.attachHeight,g.height),je((_=g.asBuilt)==null?void 0:_.attachHeight,g.height,s.presetProfile)]}),y=[x.join(","),...E.map(g=>g.map(M=>`${String(M).replaceAll('"','""')}`).join(","))].join(`
`),A=new Blob([y],{type:"text/csv;charset=utf-8;"}),U=URL.createObjectURL(A),R=document.createElement("a");R.href=U,R.download="collected-poles-first-25.csv",R.click(),URL.revokeObjectURL(U)},W=async()=>{try{const i=(await he(async()=>{const{default:f}=await import("./zip-utils-BoTj1NZG.js").then(v=>v.j);return{default:f}},__vite__mapDeps([1,2]))).default,x=new i,E=(s.collectedPoles||[]).filter(f=>!s.currentJobId||f.jobId===s.currentJobId),y=(s.jobs||[]).find(f=>f.id===s.currentJobId),A=(()=>{const f=(y==null?void 0:y.submissionProfileName)||s.currentSubmissionProfile,v=(s.submissionProfiles||[]).find(I=>I.name===f)||{};return{...v,...(y==null?void 0:y.submissionProfileOverrides)||{},name:v==null?void 0:v.name}})(),U=E.map(f=>{var v,I;return{...f,_varianceIn:He((v=f.asBuilt)==null?void 0:v.attachHeight,f.height),_variancePass:je((I=f.asBuilt)==null?void 0:I.attachHeight,f.height,s.presetProfile)}}),{header:R,rows:g,fileLabel:M}=st("firstEnergy",U,y);if(x.file("manifest.csv",nt(R,g)),x.file("job-profile.json",JSON.stringify({jobId:(y==null?void 0:y.id)||"",jobName:(y==null?void 0:y.name)||"",owner:(y==null?void 0:y.jobOwner)||s.jobOwner||"",commCompany:(y==null?void 0:y.commCompany)||"",submissionProfile:A,includePhotos:V},null,2)),V){const f=x.folder("photos"),v=[];for(const I of U){if(!I.photoDataUrl)continue;const Y=I.id?String(I.id).replaceAll(/[^A-Za-z0-9_-]/g,"_"):`row-${v.length+1}`,se=String(I.photoDataUrl),me=se.match(/^data:(.+);base64,(.*)$/),xe=(me==null?void 0:me[1])||"image/jpeg",de=(me==null?void 0:me[2])||se.split(",")[1],ae=xe.includes("png")?"png":xe.includes("webp")?"webp":"jpg",be=`${Y}.${ae}`;de&&f&&(f.file(be,de,{base64:!0}),v.push(`${Y},${be},${xe}`))}v.length&&f&&f.file("index.csv",["id,file,mime",...v].join(`
`))}const re=await x.generateAsync({type:"blob"}),w=URL.createObjectURL(re),_=document.createElement("a");_.href=w,_.download=`${M}.zip`,_.click(),URL.revokeObjectURL(w)}catch(i){alert(`ZIP export failed: ${(i==null?void 0:i.message)||i}`)}},X=async()=>{try{const i=(await he(async()=>{const{default:_}=await import("./zip-utils-BoTj1NZG.js").then(f=>f.j);return{default:_}},__vite__mapDeps([1,2]))).default,x=new i,E=(s.collectedPoles||[]).filter(_=>!s.currentJobId||_.jobId===s.currentJobId),y=(s.jobs||[]).find(_=>_.id===s.currentJobId),A=(()=>{const _=(y==null?void 0:y.submissionProfileName)||s.currentSubmissionProfile,f=(s.submissionProfiles||[]).find(v=>v.name===_)||{};return{...f,...(y==null?void 0:y.submissionProfileOverrides)||{},name:f==null?void 0:f.name}})(),{header:U,rows:R,fileLabel:g}=st("aep",E,y);if(x.file("manifest.csv",nt(U,R)),x.file("job-profile.json",JSON.stringify({jobId:(y==null?void 0:y.id)||"",jobName:(y==null?void 0:y.name)||"",owner:(y==null?void 0:y.jobOwner)||s.jobOwner||"",commCompany:(y==null?void 0:y.commCompany)||"",submissionProfile:A,includePhotos:V},null,2)),V){const _=x.folder("photos"),f=[];for(const v of E){if(!v.photoDataUrl)continue;const I=v.id?String(v.id).replaceAll(/[^A-Za-z0-9_-]/g,"_"):`row-${f.length+1}`,Y=String(v.photoDataUrl),se=Y.match(/^data:(.+);base64,(.*)$/),me=(se==null?void 0:se[1])||"image/jpeg",xe=(se==null?void 0:se[2])||Y.split(",")[1],de=me.includes("png")?"png":me.includes("webp")?"webp":"jpg",ae=`${I}.${de}`;xe&&_&&(_.file(ae,xe,{base64:!0}),f.push(`${I},${ae},${me}`))}f.length&&_&&_.file("index.csv",["id,file,mime",...f].join(`
`))}const M=await x.generateAsync({type:"blob"}),re=URL.createObjectURL(M),w=document.createElement("a");w.href=re,w.download=`${g}.zip`,w.click(),URL.revokeObjectURL(re)}catch(i){alert(`ZIP export failed: ${(i==null?void 0:i.message)||i}`)}},a=async()=>{const i=(s.jobs||[]).find(E=>E.id===s.currentJobId),x=(i==null?void 0:i.submissionProfileName)||s.currentSubmissionProfile;if(x==="firstEnergy")return W();if(x==="aep")return X();if(x==="duke"){const E=(s.collectedPoles||[]).filter(y=>!s.currentJobId||y.jobId===s.currentJobId);return De(E,"")}return X()},l=L.useMemo(()=>(s.collectedPoles||[]).filter(x=>!s.currentJobId||x.jobId===s.currentJobId).filter(x=>{var E;if(j!=="all"&&(x.status||"draft")!==j||N==="with"&&!x.photoDataUrl||N==="without"&&x.photoDataUrl)return!1;if(Q!=="all"){const y=je((E=x.asBuilt)==null?void 0:E.attachHeight,x.height,s.presetProfile);if(Q==="pass"&&y!=="PASS"||Q==="fail"&&y!=="FAIL")return!1}return!0}),[s.collectedPoles,s.currentJobId,j,N,Q,s.presetProfile]),d=L.useMemo(()=>{const i=(s.collectedPoles||[]).filter(R=>!s.currentJobId||R.jobId===s.currentJobId),x=i.length,E=i.filter(R=>(R.status||"draft")==="done").length,y=i.filter(R=>!!R.photoDataUrl).length,A=i.filter(R=>{var g;return je((g=R.asBuilt)==null?void 0:g.attachHeight,R.height,s.presetProfile)==="PASS"}).length,U=i.filter(R=>{var g;return je((g=R.asBuilt)==null?void 0:g.attachHeight,R.height,s.presetProfile)==="FAIL"}).length;return{total:x,done:E,withPhoto:y,pass:A,fail:U}},[s.collectedPoles,s.currentJobId,s.presetProfile]),k=async()=>{const i=(await he(async()=>{const{default:v}=await import("./zip-utils-BoTj1NZG.js").then(I=>I.j);return{default:v}},__vite__mapDeps([1,2]))).default,x=new i,E=(s.jobs||[]).find(v=>v.id===s.currentJobId),y=(E==null?void 0:E.submissionProfileName)||s.currentSubmissionProfile,A=(()=>{const v=(s.submissionProfiles||[]).find(I=>I.name===y)||{};return{...v,...(E==null?void 0:E.submissionProfileOverrides)||{},name:v==null?void 0:v.name}})(),U=l,R=U.map(v=>{var I,Y;return{...v,_varianceIn:He((I=v.asBuilt)==null?void 0:I.attachHeight,v.height),_variancePass:je((Y=v.asBuilt)==null?void 0:Y.attachHeight,v.height,s.presetProfile)}}),{header:g,rows:M,fileLabel:re}=st(y,R,E);if(x.file("manifest.csv",nt(g,M)),x.file("job-profile.json",JSON.stringify({jobId:(E==null?void 0:E.id)||"",jobName:(E==null?void 0:E.name)||"",owner:(E==null?void 0:E.jobOwner)||s.jobOwner||"",commCompany:(E==null?void 0:E.commCompany)||"",submissionProfile:A,includePhotos:V,filter:{status:j,photo:N,variance:Q}},null,2)),V){const v=x.folder("photos"),I=[];for(const Y of U){if(!Y.photoDataUrl)continue;const se=Y.id?String(Y.id).replaceAll(/[^A-Za-z0-9_-]/g,"_"):`row-${I.length+1}`,me=String(Y.photoDataUrl),xe=me.match(/^data:(.+);base64,(.*)$/),de=(xe==null?void 0:xe[1])||"image/jpeg",ae=(xe==null?void 0:xe[2])||me.split(",")[1],be=de.includes("png")?"png":de.includes("webp")?"webp":"jpg",B=`${se}.${be}`;ae&&v&&(v.file(B,ae,{base64:!0}),I.push(`${se},${B},${de}`))}I.length&&v&&v.file("index.csv",["id,file,mime",...I].join(`
`))}const w=await x.generateAsync({type:"blob"}),_=URL.createObjectURL(w),f=document.createElement("a");f.href=_,f.download=`${re}-filtered.zip`,f.click(),URL.revokeObjectURL(_)},le=async()=>{const i=l.filter(x=>(x.status||"draft")==="done");await De(i,"-done")},ue=async()=>{const i=l.filter(x=>{var E;return je((E=x.asBuilt)==null?void 0:E.attachHeight,x.height,s.presetProfile)==="FAIL"});await De(i,"-fail")},Ee=async i=>{const{buildGeoJSON:x,exportGeoJSON:E,exportKML:y,exportKMZ:A}=await he(async()=>{const{buildGeoJSON:f,exportGeoJSON:v,exportKML:I,exportKMZ:Y}=await import("./app-geodata-OF3I9fsg.js").then(se=>se.g);return{buildGeoJSON:f,exportGeoJSON:v,exportKML:I,exportKMZ:Y}},__vite__mapDeps([0,1,2])),U=(s.jobs||[]).find(f=>f.id===s.currentJobId)||{},R=(s.collectedPoles||[]).filter(f=>!s.currentJobId||f.jobId===s.currentJobId),g=s.importedPoles||[],M=new Map;for(const f of g)f!=null&&f.id&&M.set(String(f.id),f);for(const f of R)f!=null&&f.id&&M.set(String(f.id),f);const re=R.length?Array.from(new Set([...R,...g.filter(f=>f&&f.id&&!R.find(v=>String(v.id)===String(f.id)))])):g;let w=[];if((s.importedSpans||[]).length)w=(s.importedSpans||[]).map((f,v)=>({id:f.id||`S${v+1}`,fromId:f.fromId,toId:f.toId,length:f.length,proposedAttach:f.proposedAttach,environment:f.environment}));else for(let f=1;f<R.length;f++){const v=R[f-1],I=R[f];v!=null&&v.latitude&&(v!=null&&v.longitude)&&(I!=null&&I.latitude)&&(I!=null&&I.longitude)&&w.push({id:`${v.id||f-1}-${I.id||f}`,fromId:v.id,toId:I.id,length:v.spanDistance||"",proposedAttach:I.height||""})}const _=x({poles:re,spans:w,job:U});if(!_.features.length)return alert("No geolocated poles/spans to export");if(i==="geojson")return E(_,`${U.name||"job"}-geodata.geojson`);if(i==="kml")return y(_,`${U.name||"job"}-geodata.kml`);if(i==="kmz")return A(_,`${U.name||"job"}-geodata.kmz`)},De=async(i,x)=>{const E=(await he(async()=>{const{default:I}=await import("./zip-utils-BoTj1NZG.js").then(Y=>Y.j);return{default:I}},__vite__mapDeps([1,2]))).default,y=new E,A=(s.jobs||[]).find(I=>I.id===s.currentJobId),U=(A==null?void 0:A.submissionProfileName)||s.currentSubmissionProfile,R=(()=>{const I=(s.submissionProfiles||[]).find(Y=>Y.name===U)||{};return{...I,...(A==null?void 0:A.submissionProfileOverrides)||{},name:I==null?void 0:I.name}})(),g=i.map(I=>{var Y,se;return{...I,_varianceIn:He((Y=I.asBuilt)==null?void 0:Y.attachHeight,I.height),_variancePass:je((se=I.asBuilt)==null?void 0:se.attachHeight,I.height,s.presetProfile)}}),{header:M,rows:re,fileLabel:w}=st(U,g,A);if(y.file("manifest.csv",nt(M,re)),y.file("job-profile.json",JSON.stringify({jobId:(A==null?void 0:A.id)||"",jobName:(A==null?void 0:A.name)||"",owner:(A==null?void 0:A.jobOwner)||s.jobOwner||"",commCompany:(A==null?void 0:A.commCompany)||"",submissionProfile:R,includePhotos:V,subset:x},null,2)),V){const I=y.folder("photos"),Y=[];for(const se of i){if(!se.photoDataUrl)continue;const me=se.id?String(se.id).replaceAll(/[^A-Za-z0-9_-]/g,"_"):`row-${Y.length+1}`,xe=String(se.photoDataUrl),de=xe.match(/^data:(.+);base64,(.*)$/),ae=(de==null?void 0:de[1])||"image/jpeg",be=(de==null?void 0:de[2])||xe.split(",")[1],B=ae.includes("png")?"png":ae.includes("webp")?"webp":"jpg",Ae=`${me}.${B}`;be&&I&&(I.file(Ae,be,{base64:!0}),Y.push(`${me},${Ae},${ae}`))}Y.length&&I&&I.file("index.csv",["id,file,mime",...Y].join(`
`))}const _=await y.generateAsync({type:"blob"}),f=URL.createObjectURL(_),v=document.createElement("a");v.href=f,v.download=`${w}${x}.zip`,v.click(),URL.revokeObjectURL(f)},_e=L.useMemo(()=>{const i=(s.collectedPoles||[]).filter(A=>!s.currentJobId||A.jobId===s.currentJobId),x=new Map;i.forEach(A=>{A!=null&&A.id&&x.set(String(A.id),A)});const E=(s.importedSpans||[]).length?s.importedSpans:i.slice(1).map((A,U)=>{var R,g,M;return{fromId:(R=i[U])==null?void 0:R.id,toId:A.id,id:`${((g=i[U])==null?void 0:g.id)||U}-${A.id||U+1}`,length:(M=i[U])==null?void 0:M.spanDistance}}),y=[];for(const A of E){const U=A.fromId?x.get(String(A.fromId)):null,R=A.toId?x.get(String(A.toId)):null;if(!U||!R)continue;const g=(s.jobs||[]).find(f=>f.id===s.currentJobId),M=(g==null?void 0:g.submissionProfileName)||s.currentSubmissionProfile,re=(s.submissionProfiles||[]).find(f=>f.name===M),w=re?{...re,...(g==null?void 0:g.submissionProfileOverrides)||{}}:void 0,_=jt({poleHeight:U.height,poleClass:U.poleClass,poleLatitude:U.latitude,poleLongitude:U.longitude,adjacentPoleHeight:R.height,adjacentPoleLatitude:R.latitude,adjacentPoleLongitude:R.longitude,existingPowerHeight:U.powerHeight,existingPowerVoltage:s.existingPowerVoltage,spanDistance:A.length,isNewConstruction:s.isNewConstruction,attachmentType:s.attachmentType,cableDiameter:s.cableDiameter,windSpeed:s.windSpeed,spanEnvironment:s.spanEnvironment,dripLoopHeight:s.dripLoopHeight,proposedLineHeight:U.height,existingLines:s.existingLines,iceThicknessIn:s.iceThicknessIn,hasTransformer:U.hasTransformer,presetProfile:s.presetProfile,customMinTopSpace:s.customMinTopSpace,customRoadClearance:s.customRoadClearance,customCommToPower:s.customCommToPower,powerReference:s.powerReference,jobOwner:s.jobOwner,submissionProfile:w,adjacentPowerHeight:R.powerHeight});_!=null&&_.results&&y.push({id:A.id||`${U.id}-${R.id}`,from:U.id,to:R.id,midspanFt:_.results.span.midspanFt,groundTargetFt:_.results.clearances.groundClearance})}return y},[s]);return e.jsxs("div",{className:"rounded border p-3 no-print",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:["Field Collection",e.jsx("button",{className:"text-xs px-2 py-0.5 border rounded text-blue-700 border-blue-300 hover:bg-blue-50",onClick:()=>t&&t("help-field-collection"),title:"Open Help to Field Collection",children:"Help"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Collected: ",d.total," (Done: ",d.done,", Pass: ",d.pass,", Fail: ",d.fail,", Photos: ",d.withPhoto,') | Max per FE batch: 25 â€” Hint: set Owner to "Mon Power" (FirstEnergy) when applicable']})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 mb-3",children:[e.jsxs("label",{className:"text-sm text-gray-700 grid gap-1",children:[e.jsx("span",{className:"font-medium",children:"Filter Status"}),e.jsxs("select",{className:"border rounded px-2 py-1",value:j,onChange:i=>C(i.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"done",children:"Done"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700 grid gap-1",children:[e.jsx("span",{className:"font-medium",children:"Filter Photos"}),e.jsxs("select",{className:"border rounded px-2 py-1",value:N,onChange:i=>K(i.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"with",children:"With Photo"}),e.jsx("option",{value:"without",children:"Without Photo"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700 grid gap-1",children:[e.jsx("span",{className:"font-medium",children:"Filter FE Variance"}),e.jsxs("select",{className:"border rounded px-2 py-1",value:Q,onChange:i=>O(i.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"pass",children:"PASS"}),e.jsx("option",{value:"fail",children:"FAIL"})]})]}),e.jsxs("div",{className:"text-xs text-gray-600 flex items-end",children:["Job:"," ",s.currentJobId&&((Re=(s.jobs||[]).find(i=>i.id===s.currentJobId))==null?void 0:Re.name)||"â€”"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx(fe,{label:"Pole ID",value:p,onChange:i=>c(i.target.value),placeholder:"e.g., Tag # or temp"}),e.jsx(fe,{label:"Latitude",value:s.poleLatitude,onChange:i=>s.setPoleLatitude(i.target.value),placeholder:"40.123456"}),e.jsxs("div",{className:"grid grid-cols-[1fr_auto] gap-2 items-end",children:[e.jsx(fe,{label:"Longitude",value:s.poleLongitude,onChange:i=>s.setPoleLongitude(i.target.value),placeholder:"-82.987654"}),e.jsx("button",{className:"h-9 px-3 border rounded text-sm",onClick:async()=>{if(!("geolocation"in navigator)){alert("Geolocation not supported");return}try{const i=await new Promise((y,A)=>navigator.geolocation.getCurrentPosition(y,A,{enableHighAccuracy:!0,timeout:1e4})),{latitude:x,longitude:E}=i.coords||{};x!=null&&E!=null&&(s.setPoleLatitude(x.toFixed(6)),s.setPoleLongitude(E.toFixed(6)))}catch(i){alert(`Failed to get location: ${(i==null?void 0:i.message)||i}`)}},children:"GPS"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 items-end",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Photo"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"h-9 px-2 border rounded text-sm",onClick:()=>{var i;return(i=T.current)==null?void 0:i.click()},title:"Take photo",children:"Camera"}),e.jsx("button",{className:"h-9 px-2 border rounded text-sm",onClick:()=>{var i;return(i=S.current)==null?void 0:i.click()},title:"Choose from library",children:"Library"}),m?e.jsx("img",{src:m,alt:"preview",className:"h-9 w-9 object-cover rounded border"}):null,m?e.jsx("button",{className:"h-9 px-2 border rounded text-sm",onClick:()=>P(""),children:"Remove"}):null,e.jsx("input",{ref:T,type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:i=>{var x;return H((x=i.target.files)==null?void 0:x[0])}}),e.jsx("input",{ref:S,type:"file",accept:"image/*",className:"hidden",onChange:i=>{var x;return H((x=i.target.files)==null?void 0:x[0])}})]})]}),e.jsxs("div",{className:"flex items-end justify-end gap-2",children:[e.jsx("button",{className:"h-9 px-3 border rounded text-sm",onClick:z,disabled:b,children:"Save Draft"}),e.jsx("button",{className:"h-9 px-3 border rounded text-sm",onClick:h,disabled:b,children:"DONE"})]})]})]}),u?e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsxs("label",{className:"text-xs inline-flex items-center gap-2 mr-1",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:V,onChange:i=>D(i.target.checked)}),e.jsx("span",{children:"Include photos"})]}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:o,disabled:!((Ke=s.collectedPoles)!=null&&Ke.length),children:"Export CSV"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:J,disabled:(((Me=s.collectedPoles)==null?void 0:Me.length)||0)<1,children:"Export First 25"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:W,disabled:(((qe=s.collectedPoles)==null?void 0:qe.length)||0)<1,children:"Export FE SPANS ZIP"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:a,disabled:(((Ue=s.collectedPoles)==null?void 0:Ue.length)||0)<1,children:"Export Utility ZIP (Profile)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Geospatial:"}),e.jsx("button",{className:"px-2 py-1 border rounded text-xs",onClick:()=>Ee("geojson"),disabled:(((We=s.collectedPoles)==null?void 0:We.length)||0)<1,children:"GeoJSON"}),e.jsx("button",{className:"px-2 py-1 border rounded text-xs",onClick:()=>Ee("kml"),disabled:(((Be=s.collectedPoles)==null?void 0:Be.length)||0)<1,children:"KML"}),e.jsx("button",{className:"px-2 py-1 border rounded text-xs",onClick:()=>Ee("kmz"),disabled:(((Ve=s.collectedPoles)==null?void 0:Ve.length)||0)<1,children:"KMZ"})]}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:X,disabled:(((Ge=s.collectedPoles)==null?void 0:Ge.length)||0)<1,children:"Export AEP ZIP"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:k,disabled:!l.length,children:"Export Filtered ZIP"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:le,disabled:!l.length,children:"Export DONE-only"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:ue,disabled:!l.length,children:"Export FAIL-only"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>{var i;return(i=s.setCollectedPoles)==null?void 0:i.call(s,[])},disabled:!((Ye=s.collectedPoles)!=null&&Ye.length),children:"Clear"})]}):null,e.jsxs("div",{className:"mt-3 overflow-auto",children:[_e.length?e.jsxs("div",{className:"mb-3 rounded border p-2",children:[e.jsx("div",{className:"font-medium mb-1",children:"Midspan Verification"}),e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600",children:[e.jsx("th",{className:"p-1",children:"Span"}),e.jsx("th",{className:"p-1",children:"Midspan"}),e.jsx("th",{className:"p-1",children:"Target"}),e.jsx("th",{className:"p-1",children:"Status"})]})}),e.jsx("tbody",{children:_e.map(i=>{const x=i.midspanFt==null?!1:i.midspanFt>=i.groundTargetFt;return e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"p-1",children:[i.from," â†’ ",i.to]}),e.jsx("td",{className:"p-1",children:i.midspanFt!=null?s.useTickMarkFormat?ut(i.midspanFt):pt(i.midspanFt):"â€”"}),e.jsx("td",{className:"p-1",children:s.useTickMarkFormat?ut(i.groundTargetFt):pt(i.groundTargetFt)}),e.jsx("td",{className:x?"p-1 text-emerald-700":"p-1 text-red-700",children:x?"PASS":"FAIL"})]},i.id)})})]}),e.jsx("div",{className:"text-[11px] text-gray-600 mt-1",children:"Midspan is evaluated only when both poles of the span are collected. Span distance is auto-derived from geolocation when not provided. Make-ready lowering at either end propagates to midspan in the calculation."})]}):null,e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2 mb-2 text-sm",children:[e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Total"}),e.jsx("div",{className:"text-lg font-semibold",children:d.total})]}),e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Done"}),e.jsx("div",{className:"text-lg font-semibold",children:d.done})]}),e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Photos"}),e.jsx("div",{className:"text-lg font-semibold",children:d.withPhoto})]}),e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"PASS"}),e.jsx("div",{className:"text-lg font-semibold text-emerald-700",children:d.pass})]}),e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"FAIL"}),e.jsx("div",{className:"text-lg font-semibold text-red-700",children:d.fail})]})]}),e.jsxs("table",{className:"w-full text-sm min-w-[920px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600",children:[e.jsx("th",{className:"p-2",children:"ID"}),e.jsx("th",{className:"p-2",children:"Latitude"}),e.jsx("th",{className:"p-2",children:"Longitude"}),e.jsx("th",{className:"p-2",children:"Height"}),e.jsx("th",{className:"p-2",children:"Class"}),e.jsx("th",{className:"p-2",children:"Power Ht"}),e.jsx("th",{className:"p-2",children:"Voltage"}),e.jsx("th",{className:"p-2",children:"XFMR"}),e.jsx("th",{className:"p-2",children:"Span"}),e.jsx("th",{className:"p-2",children:"InÂ°"}),e.jsx("th",{className:"p-2",children:"OutÂ°"}),e.jsx("th",{className:"p-2",children:"PULL (ft)"}),e.jsx("th",{className:"p-2",children:"Autofill"}),e.jsx("th",{className:"p-2",children:"As-built Attach"}),e.jsx("th",{className:"p-2",children:"As-built Power"}),e.jsx("th",{className:"p-2",children:"Î” (in)"}),e.jsx("th",{className:"p-2",children:"FE Pass"}),e.jsx("th",{className:"p-2",children:"Photo"}),e.jsx("th",{className:"p-2",children:"Status"}),e.jsx("th",{className:"p-2",children:"Actions"})]})}),e.jsx("tbody",{children:l.map((i,x)=>{var E,y,A,U,R,g,M,re;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-28",value:i.id||"",onChange:w=>s.updateCollectedPole(x,{id:w.target.value})})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"grid grid-cols-[1fr_auto] gap-2 items-center",children:[e.jsx("input",{className:"border rounded px-2 py-1 w-32",value:i.latitude||"",onChange:w=>s.updateCollectedPole(x,{latitude:w.target.value})}),e.jsx("button",{className:"px-2 py-1 border rounded text-xs",onClick:()=>F(x),children:"GPS"})]})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-32",value:i.longitude||"",onChange:w=>s.updateCollectedPole(x,{longitude:w.target.value})})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-24",value:i.height||"",onChange:w=>s.updateCollectedPole(x,{height:w.target.value}),placeholder:"ft/in"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-24",value:i.poleClass||"",onChange:w=>s.updateCollectedPole(x,{poleClass:w.target.value})})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-24",value:i.powerHeight||"",onChange:w=>s.updateCollectedPole(x,{powerHeight:w.target.value}),placeholder:"ft/in"})}),e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:"border rounded px-2 py-1",value:i.voltage||"distribution",onChange:w=>s.updateCollectedPole(x,{voltage:w.target.value}),children:[e.jsx("option",{value:"distribution",children:"distribution"}),e.jsx("option",{value:"transmission",children:"transmission"}),e.jsx("option",{value:"communication",children:"communication"})]})}),e.jsx("td",{className:"p-2 text-center",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:!!i.hasTransformer,onChange:w=>s.updateCollectedPole(x,{hasTransformer:w.target.checked})})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-20",value:i.spanDistance||"",onChange:w=>s.updateCollectedPole(x,{spanDistance:w.target.value})})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-20",placeholder:"InÂ°",value:(E=i.incomingBearingDeg)!=null?E:"",onChange:w=>s.updateCollectedPole(x,{incomingBearingDeg:w.target.value===""?"":Number(w.target.value)})})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-20",placeholder:"OutÂ°",value:(y=i.outgoingBearingDeg)!=null?y:"",onChange:w=>s.updateCollectedPole(x,{outgoingBearingDeg:w.target.value===""?"":Number(w.target.value)})})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-24",placeholder:"PULL ft",value:(A=i.PULL_ft)!=null?A:"",onChange:w=>s.updateCollectedPole(x,{PULL_ft:w.target.value})})}),e.jsx("td",{className:"p-2",children:e.jsx("button",{className:"px-2 py-1 border rounded text-xs",onClick:()=>{const w=Number(i.incomingBearingDeg),_=Number(i.outgoingBearingDeg),f=Number(i.spanDistance)||Number(s.spanDistance)||100;if(Number.isFinite(w)&&Number.isFinite(_)){const{pullFt:v}=Vt({incomingBearingDeg:w,outgoingBearingDeg:_,baseSpanFt:f});s.updateCollectedPole(x,{PULL_ft:Math.round(v*100)/100})}},children:"Autofill"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-28",value:((U=i.asBuilt)==null?void 0:U.attachHeight)||"",onChange:w=>s.updateCollectedPole(x,{asBuilt:{...i.asBuilt||{},attachHeight:w.target.value}}),placeholder:"ft/in"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-28",value:((R=i.asBuilt)==null?void 0:R.powerHeight)||"",onChange:w=>s.updateCollectedPole(x,{asBuilt:{...i.asBuilt||{},powerHeight:w.target.value}}),placeholder:"ft/in"})}),e.jsx("td",{className:"p-2 w-20",children:He((g=i.asBuilt)==null?void 0:g.attachHeight,i.height)}),e.jsx("td",{className:"p-2 w-24",children:e.jsx("span",{className:je((M=i.asBuilt)==null?void 0:M.attachHeight,i.height,s.presetProfile)==="PASS"?"text-emerald-700":"text-red-700",children:je((re=i.asBuilt)==null?void 0:re.attachHeight,i.height,s.presetProfile)})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[i.photoDataUrl?e.jsx("img",{src:i.photoDataUrl,alt:"photo",className:"h-10 w-10 object-cover rounded border"}):e.jsx("span",{className:"text-xs text-gray-500",children:"None"}),e.jsx("label",{className:"hidden",children:e.jsx("input",{type:"file",accept:"image/*",capture:"environment",onChange:w=>{var v;const _=(v=w.target.files)==null?void 0:v[0];if(!_)return;const f=new FileReader;f.onload=()=>s.updateCollectedPole(x,{photoDataUrl:String(f.result||"")}),f.readAsDataURL(_),w.target.value=""}})}),e.jsx("button",{className:"px-2 py-1 border rounded text-xs",onClick:()=>{const w=document.createElement("input");w.type="file",w.accept="image/*",w.setAttribute("capture","environment"),w.onchange=_=>{var I,Y;const f=(Y=(I=_.target)==null?void 0:I.files)==null?void 0:Y[0];if(!f)return;const v=new FileReader;v.onload=()=>s.updateCollectedPole(x,{photoDataUrl:String(v.result||"")}),v.readAsDataURL(f)},w.click()},children:"Camera"}),e.jsx("button",{className:"px-2 py-1 border rounded text-xs",onClick:()=>{const w=document.createElement("input");w.type="file",w.accept="image/*",w.onchange=_=>{var I,Y;const f=(Y=(I=_.target)==null?void 0:I.files)==null?void 0:Y[0];if(!f)return;const v=new FileReader;v.onload=()=>s.updateCollectedPole(x,{photoDataUrl:String(v.result||"")}),v.readAsDataURL(f)},w.click()},children:"Library"}),i.photoDataUrl?e.jsx("button",{className:"px-2 py-1 border rounded text-xs",onClick:()=>s.updateCollectedPole(x,{photoDataUrl:""}),children:"Remove"}):null]})}),e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:"border rounded px-2 py-1",value:i.status||"draft",onChange:w=>s.updateCollectedPole(x,{status:w.target.value}),children:[e.jsx("option",{value:"draft",children:"draft"}),e.jsx("option",{value:"done",children:"done"})]})}),e.jsx("td",{className:"p-2 text-right",children:e.jsx("button",{className:"text-xs text-red-600",onClick:()=>s.removeCollectedPole(x),children:"Delete"})})]},`${i.id}-${x}`)})})]})]})]})}function Ls(){var p;const t=ne(),u=L.useMemo(()=>{const c=new Map;for(const b of t.importedPoles||[])b!=null&&b.id&&c.set(String(b.id),b);return c},[t.importedPoles]),s=L.useMemo(()=>{var b;const c=[];for(const r of t.importedSpans||[]){const m=r.fromId?u.get(String(r.fromId)):null,P=r.toId?u.get(String(r.toId)):null,S=(m==null?void 0:m.latitude)!=null&&(m==null?void 0:m.longitude)!=null&&(P==null?void 0:P.latitude)!=null&&(P==null?void 0:P.longitude)!=null?Math.round((()=>{const N=q=>q*Math.PI/180,Q=N((Number(P.latitude)||0)-(Number(m.latitude)||0)),O=N((Number(P.longitude)||0)-(Number(m.longitude)||0)),V=Math.sin(Q/2)**2+Math.cos(N(Number(m.latitude)||0))*Math.cos(N(Number(P.latitude)||0))*Math.sin(O/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(V),Math.sqrt(1-V)))*3.28084})()):void 0,T=!!t.preferAutoSpanLength,j={poleHeight:(m==null?void 0:m.height)||t.poleHeight,poleClass:(m==null?void 0:m.class)||t.poleClass,existingPowerHeight:(m==null?void 0:m.powerHeight)||t.existingPowerHeight,existingPowerVoltage:t.existingPowerVoltage,spanDistance:T?S||r.length||t.spanDistance:r.length||t.spanDistance||S,isNewConstruction:t.isNewConstruction,adjacentPoleHeight:(P==null?void 0:P.height)||t.adjacentPoleHeight,attachmentType:t.attachmentType,cableDiameter:t.cableDiameter,windSpeed:t.windSpeed,spanEnvironment:t.spanEnvironment,streetLightHeight:t.streetLightHeight,dripLoopHeight:t.dripLoopHeight,proposedLineHeight:r.proposedAttach||t.proposedLineHeight,existingLines:(b=t.importedExistingLines)!=null&&b.length?t.importedExistingLines:t.existingLines,iceThicknessIn:t.iceThicknessIn,hasTransformer:!!(m!=null&&m.hasTransformer)||t.hasTransformer,presetProfile:t.presetProfile,customMinTopSpace:t.customMinTopSpace,customRoadClearance:t.customRoadClearance,customCommToPower:t.customCommToPower},C=jt({...j,powerReference:t.powerReference,jobOwner:t.jobOwner,submissionProfile:(t.submissionProfiles||[]).find(N=>N.name===t.currentSubmissionProfile)});C!=null&&C.results&&c.push({span:r,from:m,to:P,...C})}return c},[t,u]);return s.length?e.jsxs("div",{className:"grid gap-6 text-left",children:[s.map((c,b)=>{var r,m,P,S,T,j;return e.jsxs("div",{className:b>0?"page-break":"",children:[e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold",children:["Span Report ",(r=c.span)!=null&&r.id?`#${c.span.id}`:`#${b+1}`]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Project: ",t.projectName||"â€”"," | Applicant:"," ",t.applicantName||"â€”"," | Job #: ",t.jobNumber||"â€”"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["From: ",((m=c.from)==null?void 0:m.id)||"â€”"," to ",((P=c.to)==null?void 0:P.id)||"â€”"," | Length:"," ",Math.round(c.results.span.spanFt)," ft"]})]}),e.jsxs("div",{className:"text-right",children:[t.logoDataUrl?e.jsx("img",{src:t.logoDataUrl,alt:"Logo",className:"h-10 inline-block"}):e.jsx("div",{className:"text-2xl font-bold",children:"PolePro"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Generated ",new Date().toLocaleDateString()]})]})]}),e.jsxs("div",{className:"mt-2",children:["Attach: ",c.results.attach.proposedAttachFmt," | Sag:"," ",c.results.span.sagFmt," | Midspan: ",c.results.span.midspanFmt]}),e.jsx("div",{className:"my-2",children:e.jsx(vt,{attachFt:c.results.attach.proposedAttachFt,midspanFt:c.results.span.midspanFt,spanFt:c.results.span.spanFt,groundTargetFt:c.results.clearances.groundClearance})}),(S=c.warnings)!=null&&S.length?e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"font-medium",children:"Warnings"}),e.jsx("ul",{className:"list-disc pl-5 text-sm",children:c.warnings.map((C,N)=>e.jsx("li",{children:C},N))})]}):null,(T=c.notes)!=null&&T.length?e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"font-medium",children:"Notes"}),e.jsx("ul",{className:"list-disc pl-5 text-sm",children:c.notes.map((C,N)=>e.jsx("li",{children:C},N))})]}):null,e.jsxs("div",{className:"mt-2 text-sm text-gray-700",children:["Estimated cost: $",(j=c.cost)!=null?j:0]})]},b)}),(p=t.importedPoles)!=null&&p.length?e.jsxs("div",{className:"page-break",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Pole Profile Sheets"}),e.jsx("div",{className:"grid gap-4",children:t.importedPoles.map((c,b)=>{var r,m,P;return e.jsxs("div",{className:b>0?"page-break":"",children:[e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Pole ",c.id||`#${b+1}`]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Project: ",t.projectName||"â€”"," | Applicant:"," ",t.applicantName||"â€”"," | Job #:"," ",t.jobNumber||"â€”"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Height: ",c.height?`${Math.round(c.height)} ft`:"â€”"," | Class: ",c.class||"â€”"," | Power Height:"," ",(r=c.powerHeight)!=null?r:"â€”"]})]}),e.jsxs("div",{className:"text-right",children:[t.logoDataUrl?e.jsx("img",{src:t.logoDataUrl,alt:"Logo",className:"h-10 inline-block"}):e.jsx("div",{className:"text-2xl font-bold",children:"PolePro"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Generated ",new Date().toLocaleDateString()]})]})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-700",children:["Transformer: ",c.hasTransformer?"Yes":"No"," | Location:"," ",(m=c.latitude)!=null?m:"â€”",", ",(P=c.longitude)!=null?P:"â€”"]})]},c.id||b)})})]}):null,e.jsx("div",{className:"no-print",children:e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>window.print(),children:"Print Batch"})})]}):e.jsx("div",{className:"text-gray-600",children:"No imported spans to report."})}function ks(){const t=ne(),[u,s]=L.useState(null),[p,c]=L.useState(""),[b,r]=L.useState(ft[0].mapping),[m,P]=L.useState({poles:0,spans:0,lines:0}),[S,T]=L.useState(""),[j,C]=L.useState(""),[N,K]=L.useState(""),[Q,O]=L.useState([]),[V,D]=L.useState([]),[Z,q]=L.useState(!1),[F,h]=L.useState(!1),[z,H]=L.useState(null),[o,J]=L.useState({pole:[],span:[],line:[]}),W=async()=>{var a;if(u)try{c("Parsingâ€¦");const l=await Xt(u);try{const k=Qt(l),le=k.poles[0]?St(k.poles[0]):[],ue=k.lines[0]?St(k.lines[0]):[];J({pole:le,span:ue,line:ue})}catch(k){console.error("Error analyzing feature attributes:",k),J({pole:[],span:[],line:[]})}c("Mappingâ€¦");const d=es(l,b);if(d.poleTable[0]){const k=d.poleTable[0];k.height&&t.setPoleHeight(String(Math.round(k.height))),k.class&&t.setPoleClass(k.class),k.powerHeight&&t.setExistingPowerHeight(String(k.powerHeight)),k.hasTransformer&&t.setHasTransformer(!0)}if(d.spanTable[0]){const k=d.spanTable[0];k.length&&t.setSpanDistance(String(Math.round(k.length))),k.proposedAttach&&t.setProposedLineHeight(String(k.proposedAttach))}(a=d.existingLines)!=null&&a.length&&t.setExistingLines(d.existingLines),t.setImportedPoles(d.poleTable),t.setImportedSpans(d.spanTable),t.setImportedExistingLines(d.existingLines),P({poles:d.poleTable.length,spans:d.spanTable.length,lines:d.existingLines.length}),c(`Imported ${d.poleTable.length} poles, ${d.spanTable.length} spans, ${d.existingLines.length} lines.`)}catch(l){c(`Import failed: ${l.message||l}`)}},X=(a,l,d)=>r(k=>({...k,[a]:{...k[a],[l]:d}}));return e.jsxs("div",{className:"rounded border p-3 no-print",children:[e.jsx("div",{className:"font-medium mb-2",children:"Import KML/KMZ/Shapefile"}),e.jsxs("div",{className:"grid gap-2 md:grid-cols-3",children:[e.jsxs("label",{className:"text-sm text-gray-700 grid gap-1",children:[e.jsx("span",{className:"font-medium",children:"File"}),e.jsx("input",{type:"file",accept:".kml,.kmz,.zip,.shp,.dbf",onChange:a=>{var l;return s(((l=a.target.files)==null?void 0:l[0])||null)}})]}),e.jsx("button",{className:"self-end h-9 px-3 border rounded",onClick:W,disabled:!u,children:"Import"}),e.jsx("div",{className:"self-end text-sm text-gray-600",children:p})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 mt-2",children:[e.jsxs("label",{className:"text-sm text-gray-700 grid gap-1",children:[e.jsx("span",{className:"font-medium",children:"Mapping Preset"}),e.jsx("select",{className:"border rounded px-2 py-1",value:t.mappingPreset,onChange:a=>{t.setMappingPreset(a.target.value);const l=ft.find(d=>d.value===a.target.value);l&&r(l.mapping)},children:ft.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-end",children:["Batch: ",m.poles," poles, ",m.spans," spans,"," ",m.lines," lines loaded"]}),e.jsx("button",{className:"self-end h-9 px-3 border rounded",onClick:()=>{var l;const a={poleTable:t.importedPoles,spanTable:t.importedSpans,existingLines:t.importedExistingLines};if(a.poleTable[0]){const d=a.poleTable[0];d.height&&t.setPoleHeight(String(Math.round(d.height))),d.class&&t.setPoleClass(d.class),d.powerHeight&&t.setExistingPowerHeight(String(d.powerHeight)),t.setHasTransformer(!!d.hasTransformer)}if(a.spanTable[0]){const d=a.spanTable[0];d.length&&t.setSpanDistance(String(Math.round(d.length))),d.proposedAttach&&t.setProposedLineHeight(String(d.proposedAttach))}(l=a.existingLines)!=null&&l.length&&t.setExistingLines(a.existingLines)},disabled:!m.poles&&!m.spans,children:"Apply First Record"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 mt-2",children:[e.jsxs("label",{className:"text-sm text-gray-700 grid gap-1",children:[e.jsx("span",{className:"font-medium",children:"Saved Profile"}),e.jsxs("select",{className:"border rounded px-2 py-1",onChange:a=>{const l=(t.mappingProfiles||[]).find(d=>d.name===a.target.value);l&&r(l.mapping)},children:[e.jsx("option",{value:"",children:"Selectâ€¦"}),(t.mappingProfiles||[]).map(a=>e.jsx("option",{value:a.name,children:a.name},a.name))]})]}),e.jsx("button",{className:"self-end h-9 px-3 border rounded",onClick:()=>q(!0),children:"Configure Mapping"}),e.jsx("button",{className:"self-end h-9 px-3 border rounded",onClick:()=>{const a=prompt("Delete saved profile by name:");a&&t.removeMappingProfile(a)},children:"Delete Profile"}),e.jsx("button",{className:"self-end h-9 px-3 border rounded",onClick:()=>{const a=prompt("Rename which profile? Enter existing name:");if(!a)return;const l=prompt("New name:");l&&t.renameMappingProfile(a,l)},children:"Rename Profile"}),e.jsx("button",{className:"self-end h-9 px-3 border rounded",onClick:()=>{const a=(d,k)=>(d||[]).find(le=>k.some(ue=>le.toLowerCase().includes(ue)))||"",l={pole:{...b.pole,id:a(o.pole,["id","pole"]),height:a(o.pole,["height","hgt","ht"]),class:a(o.pole,["class"]),powerHeight:a(o.pole,["power","primary","pwr"]),hasTransformer:a(o.pole,["xfmr","transformer"])},span:{...b.span,id:a(o.span,["id","span"]),fromId:a(o.span,["from","a","start"]),toId:a(o.span,["to","b","end"]),length:a(o.span,["length","len","span"]),proposedAttach:a(o.span,["attach","proposed"])},line:{...b.line,type:a(o.line,["type","line"]),height:a(o.line,["height","hgt","ht"]),company:a(o.line,["comp","company","owner"]),makeReady:a(o.line,["mr","make"]),makeReadyHeight:a(o.line,["mr_h","new","mrh"])}};H(l),h(!0)},children:"Auto-map"}),e.jsx("button",{className:"self-end h-9 px-3 border rounded",onClick:()=>{try{const a=new Blob([JSON.stringify(t.mappingProfiles||[],null,2)],{type:"application/json"}),l=URL.createObjectURL(a),d=document.createElement("a");d.href=l,d.download="mapping-profiles.json",d.click(),URL.revokeObjectURL(l)}catch(a){console.error("Failed to export mapping profiles:",a)}},children:"Export Profiles"}),e.jsxs("label",{className:"self-end h-9 px-3 border rounded inline-flex items-center gap-2 cursor-pointer",children:[e.jsx("span",{children:"Import Profiles"}),e.jsx("input",{type:"file",accept:"application/json",className:"hidden",onChange:async a=>{var d;const l=(d=a.target.files)==null?void 0:d[0];if(l){try{const k=await l.text(),le=JSON.parse(k);Array.isArray(le)&&t.setMappingProfiles(le)}catch(k){console.error("Failed to import mapping profiles:",k)}a.target.value=""}}})]})]}),e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-700",children:"Mapping (attributes â†’ fields)"}),e.jsx("div",{className:"grid md:grid-cols-3 gap-3 mt-2 text-sm",children:Object.entries(b).map(([a,l])=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"font-medium mb-1",children:a}),Object.entries(l).map(([d,k])=>e.jsxs("label",{className:"grid gap-1 mb-1",children:[e.jsx("span",{className:"text-xs uppercase text-gray-500",children:d}),e.jsx("input",{className:"border rounded px-2 py-1",value:k,onChange:le=>X(a,d,le.target.value)})]},d))]},a))})]}),e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-700",children:"Import Poles from CSV"}),e.jsxs("div",{className:"grid gap-2 mt-2",children:[e.jsx("textarea",{className:"border rounded p-2 text-xs h-28",placeholder:"Paste CSV with headers (example): id,height,class,power_ht,xfmr,latitude,longitude",value:j,onChange:a=>C(a.target.value)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>{const a=Zt(j,b.pole);a.length&&(t.setImportedPoles(a),P(l=>({...l,poles:a.length})),O([]))},children:"Load (Raw)"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm bg-blue-50 hover:bg-blue-100",onClick:async()=>{const{data:a,errors:l}=await Kt(j,b.pole);a.length&&(t.setImportedPoles(a),P(d=>({...d,poles:a.length}))),O(l||[])},children:"Load + Validate"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Populates the Imported Poles table used by batch/exports"})]}),!!Q.length&&e.jsxs("div",{className:"text-xs text-red-600 border border-red-200 rounded p-2 bg-red-50 max-h-40 flex flex-col gap-1","aria-live":"polite",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-semibold",children:["Pole Validation Issues (",Q.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"px-2 py-0.5 border rounded bg-white text-red-700 hover:bg-red-100",onClick:()=>Pt(Q,"pole_validation_errors.csv"),children:"Export"}),e.jsx("button",{type:"button",className:"px-2 py-0.5 border rounded bg-white text-gray-600 hover:bg-gray-100",onClick:()=>O([]),children:"Clear"})]})]}),e.jsxs("ul",{className:"list-disc pl-4 space-y-0.5 overflow-auto",children:[Q.slice(0,8).map((a,l)=>e.jsx("li",{children:a},l)),Q.length>8&&e.jsxs("li",{children:["â€¦ ",Q.length-8," more"]})]})]})]})]}),e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-700",children:"Import Spans from CSV"}),e.jsxs("div",{className:"grid gap-2 mt-2",children:[e.jsx("textarea",{className:"border rounded p-2 text-xs h-28",placeholder:"Paste CSV with headers (example): id,from_id,to_id,length,attach",value:N,onChange:a=>K(a.target.value)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>{const a=qt(N,b.span);a.length&&(t.setImportedSpans(a),P(l=>({...l,spans:a.length})),D([]))},children:"Load (Raw)"}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm bg-blue-50 hover:bg-blue-100",onClick:async()=>{const{data:a,errors:l}=await Wt(N,b.span);a.length&&(t.setImportedSpans(a),P(d=>({...d,spans:a.length}))),D(l||[])},children:"Load + Validate"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Populates the Imported Spans table used by batch/exports"})]}),!!V.length&&e.jsxs("div",{className:"text-xs text-red-600 border border-red-200 rounded p-2 bg-red-50 max-h-40 flex flex-col gap-1","aria-live":"polite",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-semibold",children:["Span Validation Issues (",V.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"px-2 py-0.5 border rounded bg-white text-red-700 hover:bg-red-100",onClick:()=>Pt(V,"span_validation_errors.csv"),children:"Export"}),e.jsx("button",{type:"button",className:"px-2 py-0.5 border rounded bg-white text-gray-600 hover:bg-gray-100",onClick:()=>D([]),children:"Clear"})]})]}),e.jsxs("ul",{className:"list-disc pl-4 space-y-0.5 overflow-auto",children:[V.slice(0,8).map((a,l)=>e.jsx("li",{children:a},l)),V.length>8&&e.jsxs("li",{children:["â€¦ ",V.length-8," more"]})]})]})]})]}),e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-700",children:"Import Existing Lines from CSV"}),e.jsxs("div",{className:"grid gap-2 mt-2",children:[e.jsx("textarea",{className:"border rounded p-2 text-xs h-28",placeholder:"Paste CSV with headers: type,height,company,makeReady,makeReadyHeight",value:S,onChange:a=>T(a.target.value)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>{const a=Yt(S,b.line);a.length&&t.setExistingLines(a)},children:"Use CSV"}),e.jsx("div",{className:"text-xs text-gray-600",children:"This replaces the Existing Lines table"})]})]})]}),e.jsx(Is,{open:Z,onClose:()=>q(!1),mapping:b,onChange:r,attrKeys:o,onSave:(a,l)=>{t.addMappingProfile(a,l),q(!1)}}),e.jsx(It,{open:F,onClose:()=>h(!1),current:b,proposal:z,onApply:()=>{z&&r(z),h(!1)}})]})}function Is({open:t,onClose:u,mapping:s,onChange:p,attrKeys:c,onSave:b}){const[r,m]=L.useState("");if(!t)return null;const P=["pole","span","line"],S=(T,j,C)=>p(N=>({...N,[T]:{...N[T],[j]:C}}));return e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded shadow-lg w-[90vw] max-w-3xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:"Configure Mapping"}),e.jsx("button",{className:"text-sm",onClick:u,children:"Close"})]}),e.jsx("div",{className:"text-xs text-gray-600 mb-3",children:"Click a detected attribute on the right to fill a field."}),e.jsx("div",{className:"grid md:grid-cols-3 gap-3 text-sm",children:P.map(T=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"font-medium mb-1",children:T}),Object.entries(s[T]||{}).map(([j,C])=>e.jsxs("div",{className:"grid grid-cols-2 gap-1 items-center mb-1",children:[e.jsx("div",{className:"text-xs uppercase text-gray-500",children:j}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:C,onChange:N=>S(T,j,N.target.value)}),e.jsx("div",{className:"flex flex-wrap gap-1",children:(c[T]||[]).slice(0,6).map(N=>e.jsx("button",{className:"text-[10px] px-1 py-0.5 border rounded",onClick:()=>S(T,j,N),children:N},N))})]})]},j))]},T))}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx("input",{className:"border rounded px-2 py-1 text-sm",placeholder:"Save as profile name",value:r,onChange:T=>m(T.target.value)}),e.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>{r&&b(r,s)},children:"Save Profile"})]})]})})}function Fs(){const{setLogoDataUrl:t}=ne(),u=async s=>{var b;const p=(b=s.target.files)==null?void 0:b[0];if(!p)return;const c=new FileReader;c.onload=()=>t(c.result),c.readAsDataURL(p)};return e.jsxs("label",{className:"text-sm text-gray-700 grid gap-1",children:[e.jsx("span",{className:"font-medium",children:"Logo"}),e.jsx("input",{type:"file",accept:"image/*",className:"border rounded px-2 py-1",onChange:u})]})}function Es({open:t,onClose:u,initialSection:s}){if(L.useEffect(()=>{if(!t||!s)return;const b=setTimeout(()=>{const r=document.getElementById(s);r&&r.scrollIntoView({behavior:"smooth",block:"start"})},50);return()=>clearTimeout(b)},[t,s]),!t)return null;const p=()=>{const b=`Project Name,Pole Height,Pole Class,Existing Power Height,Span Distance,Wind Speed
Sample Project 1,35ft,Class 4,30' 6",150,90
Sample Project 2,40',Class 3,32ft 0in,200,85
Sample Project 3,45ft,Class 2,35' 6",175,95`,r=new Blob([b],{type:"text/csv"}),m=URL.createObjectURL(r),P=document.createElement("a");P.href=m,P.download="sample-pole-data.csv",P.click(),URL.revokeObjectURL(m)},c=()=>{const b=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2">
  <Document>
    <name>Sample Pole Data</name>
    <Placemark>
      <name>Pole 1</name>
      <ExtendedData>
        <Data name="height"><value>35ft</value></Data>
        <Data name="class"><value>Class 4</value></Data>
        <Data name="power_ht"><value>30' 6"</value></Data>
      </ExtendedData>
      <Point><coordinates>-82.5,40.0,0</coordinates></Point>
    </Placemark>
  </Document>
</kml>`,r=new Blob([b],{type:"application/vnd.google-earth.kml+xml"}),m=URL.createObjectURL(r),P=document.createElement("a");P.href=m,P.download="sample-poles.kml",P.click(),URL.revokeObjectURL(m)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-auto break-anywhere",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Application Use Directions"}),e.jsx("button",{onClick:u,className:"text-gray-500 hover:text-gray-700 text-xl",children:"Ã—"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-3",children:"ðŸ“ Rules & Suggestions (How to use this tool effectively)"}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded",children:[e.jsx("h4",{className:"font-medium mb-1",children:"Global"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Data autoâ€‘saves locally as you type. The section â€œSaveâ€ buttons record a timestamp for your reference."}),e.jsx("li",{children:"Opening links uses a new tab so you donâ€™t lose work. Downloads are generated inâ€‘browser; no data leaves your device unless you export."}),e.jsx("li",{children:"Use the sticky workflow nav to jump between sections; collapsed sections still retain their data."}),e.jsx("li",{children:`Height inputs accept tick marks (15' 6") or verbose (15ft 6in). Prefer consistent formatting per job.`})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("h4",{className:"font-medium mb-1",children:"Job Setup"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:'Pick a Submission Profile before running reports; FE subsidiaries enable 44" commâ€‘toâ€‘power rules.'}),e.jsx("li",{children:"Set power reference (Neutral/Secondary/Drip Loop/Power) to align with field conditions."}),e.jsx("li",{children:"Use the Profile Tuner to adjust targets when a permit requires specific values."})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("h4",{className:"font-medium mb-1",children:"Import & Map"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Map headers using presets for ArcGIS/ikeGPS/Katapult Pro; save your mapping for reuse."}),e.jsx("li",{children:"Spans with endpoints get auto lengths (Haversine). If no field length is present, geometry is used."}),e.jsx("li",{children:"KML/KMZ/Shapefile: ensure coordinates are WGS84 (EPSG:4326) for best results."})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("h4",{className:"font-medium mb-1",children:"Spans Editor"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Prefer Auto Length uses endpoints first; manual length is a fallback when auto is missing."}),e.jsx("li",{children:"Î” (delta) = |manual âˆ’ auto|. Default bigâ€‘Î” threshold is 10 ft (configurable)."}),e.jsx("li",{children:"Compute/Recompute All refreshes Cached Midspans used by Batch Report and Permit Pack."})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("h4",{className:"font-medium mb-1",children:"Existing Lines"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Use Makeâ€‘Ready only when vertical moves are intended; enter new heights to estimate costs."}),e.jsx("li",{children:"Keep owner/company filled for downstream cost allocation and submission artifacts."})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("h4",{className:"font-medium mb-1",children:"Field Collection"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Tap GPS per row to capture fresh coordinates; EXIF from photos augments GPS/time when available."}),e.jsx("li",{children:"Mark DONE only after verifying ID, GPS, and key heights; use filters to review Drafts/FAILs."}),e.jsx("li",{children:"First 25 export is optimized for utilities like FirstEnergy SPANS."})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("h4",{className:"font-medium mb-1",children:"Results & Exports"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"PASS/FAIL badges compare midspan or separations to the controlling target (segmentâ€‘aware)."}),e.jsx("li",{children:"Permit Pack requires Cached Midspans for QA/QC summaries; run Recompute All beforehand."}),e.jsx("li",{children:"Include Photos option packs images alongside manifests when generating utility ZIPs."})]})]})]}),e.jsxs("div",{className:"bg-amber-50 p-3 rounded",children:[e.jsx("h4",{className:"font-medium mb-1",children:"Calculations & Assumptions"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Sag uses a parabolic approximation with wind/ice factors from your inputs and cable type."}),e.jsx("li",{children:"Midspan = average attach âˆ’ sag. Ground target derives from Submission Profile + segments."}),e.jsx("li",{children:"Asâ€‘built variance tolerance defaults to 2 in unless overridden by the profile/owner."}),e.jsx("li",{children:"Auto length uses Haversine over WGS84; results are rounded to whole feet for readability."}),e.jsx("li",{children:"Guy guidance is advisory and based on tension thresholds; confirm with utility standards."})]})]}),e.jsxs("div",{className:"bg-emerald-50 p-3 rounded",children:[e.jsx("h4",{className:"font-medium mb-1",children:"Accessibility & Reliability"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Large touch targets and compact headers keep actions reachable on mobile."}),e.jsx("li",{children:"App is a PWA; basic offline caching applies. Very large images can affect memory on older devices."}),e.jsx("li",{children:"Use newâ€‘tab links for external resources to avoid accidental navigation away from the app."})]})]})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-700 mb-3",children:"ðŸš€ Quick Start Guide"}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Create/Select a Job:"})," Use the Job Setup panel to create a job (name, applicant, job #, preset, Owner). Select it to make it active."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Enter Basic Data:"})," Project name, pole height, and existing conditions"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Select Construction Type:"})," New construction or existing pole attachment"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Add Span Information:"})," Distance, adjacent pole height, wind conditions"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Use GPS (optional):"})," Tap â€œGPSâ€ beside Latitude/Longitude to autofill device coordinates"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Configure Existing Lines:"})," Add communication and power lines on the pole"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Field Collection (mobile):"})," For each pole, set ID, tap GPS, attach a photo (Camera/Library), then"," ",e.jsx("em",{children:"Save Draft"})," or ",e.jsx("em",{children:"DONE"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Review Results:"})," Check clearances, make-ready requirements, and cost estimates"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Export:"})," Use Export CSV, or for utility batches use â€œExport First 25â€"]})]})})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-sky-700 mb-3",children:"ðŸ—‚ï¸ Jobs & Setup"}),e.jsxs("div",{className:"bg-sky-50 p-4 rounded-lg text-sm space-y-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Jobs"})," let you group multiple poles under the same project metadata (name, applicant, job #, preset, notes)."]}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Create:"})," Use Job Setup to add a job and it becomes the active job."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Select:"})," Use the header dropdown to switch active jobs anytime."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Auto-link:"})," Collected poles are tagged to the active job."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Exports:"})," Collected CSV exports are filtered to the active job when one is selected."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Owner default:"}),' Set an Owner (e.g., Mon Power). FE subsidiaries activate 44" comm-to-power rules automatically.']})]})]})]}),e.jsxs("section",{id:"help-field-collection",children:[e.jsx("h3",{className:"text-lg font-semibold text-emerald-700 mb-3",children:"ðŸ“ Field Collection (Mobile + GPS + Photos)"}),e.jsxs("div",{className:"bg-emerald-50 p-4 rounded-lg text-sm space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-1",children:"Collect a pole"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsxs("li",{children:["Enter ",e.jsx("strong",{children:"Pole ID"})," (tag or temporary ID)"]}),e.jsxs("li",{children:["Tap ",e.jsx("strong",{children:"GPS"})," to capture"," ",e.jsx("em",{children:"Latitude/Longitude"})," from your device"]}),e.jsxs("li",{children:["Attach a ",e.jsx("strong",{children:"Photo"})," using ",e.jsx("em",{children:"Camera"})," ","(prompts for permission) or ",e.jsx("em",{children:"Library"})]}),e.jsxs("li",{children:["Tap ",e.jsx("strong",{children:"Save Draft"})," to keep editing later, or"," ",e.jsx("strong",{children:"DONE"})," to finalize the entry"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-1",children:"Manage collected poles"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Edit inline:"})," ID, GPS, heights, voltage, transformer, span"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Per-row GPS:"})," Use the row ",e.jsx("em",{children:"GPS"})," ","button to refresh coordinates on that row"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Status:"})," Switch between ",e.jsx("em",{children:"draft"})," and"," ",e.jsx("em",{children:"done"})," per row"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"QA Filters:"})," Use Status/Photos/PASS-FAIL filters and the dashboard counters to speed up review"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Photos:"})," Add/replace via ",e.jsx("em",{children:"Camera"})," or"," ",e.jsx("em",{children:"Library"}),"; preview and ",e.jsx("em",{children:"Remove"})," supported"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Persistence:"})," Entries are cached in your browser and survive refreshes"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-1",children:"Export & utility batches"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Export CSV:"})," Full table including"," ",e.jsx("em",{children:"status"})," and ",e.jsx("em",{children:"hasPhoto"})," columns"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Export First 25:"})," Creates a CSV of the first 25 rows for utilities like FirstEnergy"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Note:"})," Photos arenâ€™t embedded in the CSV; only a ",e.jsx("em",{children:"hasPhoto"})," flag is included"]})]})]}),e.jsx("div",{className:"text-xs text-gray-600",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Privacy & Permissions:"})," GPS and camera access are requested by your browser. Data stays on your device unless you export or share it."]})})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-green-700 mb-3",children:"ðŸ“Š Input Parameters Explained"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"Pole Information"}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Pole Height:"})," Total height of the pole in feet. For new construction, this determines burial depth (typically 10% + 2ft minimum) and above-ground height available for attachments."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Pole Class:"})," Wood pole classification (Class 1-6) indicating load capacity. Class 1 = highest capacity (~3800 lbf), Class 6 = lowest (~1200 lbf)."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Construction Type:"})," 'New' for virgin poles, 'Existing' for adding to poles with existing infrastructure."]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"Power System"}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Power Voltage:"})," 'Distribution' (4-35kV), 'Transmission' (>35kV), or 'Communication' for comm-only poles."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Existing Power Height:"})," Height of the lowest power conductor. Critical for NESC clearance calculations."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Transformer Present:"})," Indicates additional equipment complexity and potential clearance issues."]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"Span Configuration"}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Span Distance:"})," Horizontal distance to adjacent pole. Affects sag calculations and guy requirements."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Adjacent Pole Height:"})," Height of the far-end pole. Used for midspan clearance calculations."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Wind Speed:"})," Design wind speed (typically 60-110 mph). Higher winds increase loading and sag."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ice Thickness:"})," Ice loading in inches. Increases conductor weight and wind profile."]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"Cable & Environment"}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Cable Type:"})," Predefined cable characteristics (weight, tension, diameter) affecting sag calculations."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Environment:"})," 'Road' (higher clearances), 'Residential', or 'Pedestrian' areas affect NESC requirements."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Proposed Line Height:"})," Target attachment height for your new communication line."]})]})]})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-700 mb-3",children:"âš–ï¸ NESC & Regulatory Standards"}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg text-sm space-y-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"National Electrical Safety Code (NESC):"})," The application implements NESC Table 232-1 clearance requirements for different voltage classes and environments."]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:"Ground Clearances (NESC)"}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[e.jsx("li",{children:"Communication over roads: 15.5 ft minimum"}),e.jsx("li",{children:"Communication over pedestrian areas: 9.5 ft minimum"}),e.jsx("li",{children:"Distribution power over roads: 23 ft minimum"}),e.jsx("li",{children:"Transmission power over roads: 28.5 ft minimum"})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:"Vertical Separations"}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[e.jsx("li",{children:"Communication to power (distribution): 40 inches"}),e.jsx("li",{children:"Communication to power (transmission): 6 feet"}),e.jsx("li",{children:"Communication to communication: 12 inches"}),e.jsx("li",{children:"Minimum pole top space: 12 inches"})]})]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"FirstEnergy Specific:"}),' When "FirstEnergy" preset is selected, additional utility-specific requirements are applied including 18 ft road clearance and specific attachment procedures.']})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-700 mb-3",children:"ðŸ§® Calculation References"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-sm",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Sag Calculation"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Formula:"})," Sag = (w Ã— LÂ²) / (8 Ã— T)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Where:"})," w = effective weight per foot (including wind loading), L = span length, T = cable tension"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Wind Loading:"})," Calculated using q = 0.00256 Ã— VÂ² (where V = wind speed in mph)"]})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-sm",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Midspan Height"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Formula:"})," Midspan = ((Attach Height A + Attach Height B) / 2) - Sag"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Critical Check:"})," Midspan height must exceed ground clearance requirements"]})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-sm",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Guy Wire Analysis"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tension Calculation:"})," Based on horizontal loading from cable tension and wind forces"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Geometry:"})," Guy angle typically 30-60Â°, lead distance = guy height Ã— 0.5"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Threshold:"})," Guy recommended when tension exceeds 500 lbf"]})]})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-700 mb-3",children:"ðŸ“ Data Input Guidelines"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Height Format Support"}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tick Mark Format:"}),` 35' (feet), 6" (inches), 35'6" (feet and inches)`]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Verbose Format:"})," 35ft (feet), 6in (inches), 35ft 6in (feet and inches)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Decimal Support:"})," 35.5' or 35.5ft for half-foot measurements"]}),e.jsx("p",{className:"text-orange-700 font-medium mt-2",children:'Use the "Display Format" dropdown to choose your preferred format throughout the application.'})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Existing Lines Data Table"}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Line Type:"})," Select from Communication, Drop (Comm), Neutral, or Power Secondary"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Height:"})," Current attachment height of the existing line"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Company:"})," Owning utility or service provider (for cost allocation)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Make Ready:"})," Check if line needs to be moved to accommodate new attachment"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"New Height:"})," Target height after make-ready work (if applicable)"]})]})]})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-teal-700 mb-3",children:"ðŸ“ Import/Export Features"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Supported Import Formats"}),e.jsxs("div",{className:"bg-teal-50 p-3 rounded text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"KML/KMZ:"})," Google Earth files with pole location and attribute data"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Shapefile:"})," GIS data (.zip with .shp, .dbf, .shx files)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"CSV:"})," Paste data for ",e.jsx("em",{children:"Poles"}),","," ",e.jsx("em",{children:"Spans"}),", or ",e.jsx("em",{children:"Existing Lines"})," in the Import panel (headers can be mapped via presets or custom profiles)"]})]}),e.jsxs("div",{className:"mt-3 space-x-2",children:[e.jsx("button",{onClick:c,className:"px-3 py-1 bg-teal-600 text-white rounded text-sm hover:bg-teal-700",children:"Download Sample KML"}),e.jsx("button",{onClick:p,className:"px-3 py-1 bg-teal-600 text-white rounded text-sm hover:bg-teal-700",children:"Download Sample CSV"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Export Options"}),e.jsxs("div",{className:"bg-teal-50 p-3 rounded text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"CSV Export:"})," Analysis results in spreadsheet format with your preferred height formatting"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"PDF Report:"})," Professional printable report with project details, calculations, and diagrams"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Batch Report:"})," Multiple pole analysis when importing geospatial data"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"FirstEnergy SPANS ZIP:"})," Job-scoped package with manifest.csv and photos/ suitable for SPANS submissions (max 25 per application recommended)"]})]})]})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-indigo-700 mb-3",children:"ðŸ’° Cost Analysis"}),e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Base Construction Cost:"})," $150 for new construction, $200 for existing pole attachment"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Make-Ready Cost:"})," $12.50 per inch of vertical adjustment required"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Guy Wire Cost:"})," $350 base + tension-based scaling (up to $1000 for high-load conditions)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Transformer Complexity:"})," $300 additional for poles with transformers"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Special Engineering:"})," $500 additional for spans exceeding 300 feet"]})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"ðŸ”§ Common Issues & Troubleshooting"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded text-sm",children:[e.jsx("p",{children:e.jsx("strong",{children:'Warning: "CRITICAL: midspan clearance"'})}),e.jsx("p",{children:"Solution: Increase pole height, reduce span length, or move attachment point higher"})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded text-sm",children:[e.jsx("p",{children:e.jsx("strong",{children:'"Pole clearance" violations'})}),e.jsx("p",{children:"Solution: Adjust proposed line height or enable make-ready for conflicting lines"})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded text-sm",children:[e.jsx("p",{children:e.jsx("strong",{children:"Guy wire required"})}),e.jsx("p",{children:"Solution: Normal for long spans or high winds. Consider reducing span or increasing pole class"})]})]})]}),e.jsxs("div",{className:"bg-blue-100 p-4 rounded-lg text-sm",children:[e.jsx("p",{className:"font-medium text-blue-800",children:"ðŸ’¡ Pro Tip:"}),e.jsx("p",{children:"Use the scenario A/B feature to compare different pole heights or configurations. Save your mapping profiles when working with consistent data sources to speed up future imports."})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 px-6 py-4 border-t",children:e.jsx("button",{onClick:u,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Close Help"})})]})})}const As=Object.freeze(Object.defineProperty({__proto__:null,default:us},Symbol.toStringTag,{value:"Module"}));export{Us as L,he as _};
//# sourceMappingURL=app-calculator-BxQMOd7r.js.map

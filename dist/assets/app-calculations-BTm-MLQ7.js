function se(e,a,o){return Number.isNaN(e)?a:Math.min(o,Math.max(a,e))}function qe(e){return e*Math.PI/180}function Me(e){let a=e%360;return a<0&&(a+=360),a}function ke(e,a){const o=Me(e),r=Me(a),t=Math.abs(o-r),l=Math.min(t,360-t);return se(l,0,180)}function je(e,a=100){const o=se(e,0,180),r=a*Math.sin(qe(o/2));return se(r,0,a)}function ze({incomingBearingDeg:e,outgoingBearingDeg:a,baseSpanFt:o=100}){const r=ke(e,a),t=je(r,o);return{thetaDeg:r,pullFt:t}}function N(e){var m;if(e==null)return null;if(typeof e=="number"&&!Number.isNaN(e))return e;const a=String(e).trim().toLowerCase();if(a==="")return null;const o=a.match(/^(\d+(?:\.\d+)?)\s*(?:""|"|in)$/i);if(o)return(parseFloat(o[1])||0)/12;const r=a.match(/^(\d+(?:\.\d+)?)\s*(?:'|ft)$/i);if(r)return parseFloat(r[1])||0;const t=a.match(/^(\d+(?:\.\d+)?)\s*(?:'|ft)\s*(\d+(?:\.\d+)?)\s*(?:""|"|in)?$/i);if(t){const g=parseFloat(t[1])||0,b=parseFloat((m=t[2])!=null?m:"0")||0;return g+b/12}const l=Number(a.replace(/[^0-9.-]/g,""));return Number.isFinite(l)?l:null}function $(e,{compact:a=!1,tickMarks:o=!1}={}){if(e==null||Number.isNaN(e))return"--";const r=e<0,t=Math.abs(e);let l=Math.floor(t),m=Math.round((t-l)*12);m===12&&(l+=1,m=0);const g=r?"-":"";return o?a?`${g}${l}' ${m}"`:`${g}${l}' ${m}"`:a?`${g}${l}' ${m}"`:`${g}${l}ft ${m}in`}function te(e){if(e==null||Number.isNaN(e))return"--";const a=e<0,o=Math.abs(e);let r=Math.floor(o),t=Math.round((o-r)*12);return t===12&&(r+=1,t=0),`${a?"-":""}${r}' ${t}"`}function Ye(e){if(e==null||Number.isNaN(e))return"--";const a=e<0,o=Math.abs(e);let r=Math.floor(o),t=Math.round((o-r)*12);return t===12&&(r+=1,t=0),`${a?"-":""}${r}ft ${t}in`}const ce={cableTypes:[{label:'ADSS (0.5")',value:"adss",weight:.08,tension:1200,diameter:.5},{label:'Coax (0.75")',value:"coax",weight:.12,tension:1500,diameter:.75},{label:'Copper (0.5")',value:"copper",weight:.1,tension:1400,diameter:.5},{label:'Triplex (1.0")',value:"triplex",weight:.2,tension:1800,diameter:1},{label:'Generic Comm (0.6")',value:"communication",weight:.1,tension:1400,diameter:.6},{label:'Messenger-lashed Fiber (0.6")',value:"messenger_fiber",weight:.14,tension:1600,diameter:.6},{label:'Overlash on Existing Messenger (0.6")',value:"overlash",weight:.18,tension:1800,diameter:.6}],presets:{firstEnergy:{label:"FirstEnergy",value:"firstEnergy",voltage:"distribution",minTopSpace:2,roadClearance:18,commToPower:44/12,asBuiltTolerances:{attachHeightIn:2}},firstEnergyMonPower:{label:"FirstEnergy - Mon Power",value:"firstEnergyMonPower",voltage:"distribution",minTopSpace:2,roadClearance:18,commToPower:44/12,asBuiltTolerances:{attachHeightIn:2}},pse:{label:"PSE",value:"pse",voltage:"distribution",minTopSpace:2,roadClearance:18,commToPower:42/12,asBuiltTolerances:{attachHeightIn:4}},duke:{label:"Duke",value:"duke",voltage:"distribution",minTopSpace:2,roadClearance:18,commToPower:40/12,asBuiltTolerances:{attachHeightIn:4}},nationalGrid:{label:"National Grid",value:"nationalGrid",voltage:"distribution",minTopSpace:2,roadClearance:18,commToPower:40/12,asBuiltTolerances:{attachHeightIn:4}}}},$e=["firstenergy","mon power","monpower","penelec","potomac edison","west penn power","jcp&l","jersey central power","ohio edison","illuminating company","toledo edison"];function Be(e="communication",a="road"){const o={communication:{groundClearance:a==="road"?15.5:9.5,roadClearance:18,powerClearanceDistribution:3.3333333333333335,powerClearanceTransmission:6,minimumPoleTopSpace:1,commToCommVertical:1,commToCommMidspan:.5,neutralClearance:1.6666666666666667,dropWireClearance:.5},distribution:{groundClearance:a==="road"?23:18,roadClearance:25,powerClearanceDistribution:0,powerClearanceTransmission:4,minimumPoleTopSpace:2},transmission:{groundClearance:a==="road"?28.5:23,roadClearance:30,powerClearanceDistribution:0,powerClearanceTransmission:6,minimumPoleTopSpace:4}};return o[e]||o.communication}function Oe(e,a){if(!a)return e;const o=ce.presets[a];if(!o)return e;const r={...e};return typeof o.minTopSpace=="number"&&(r.minimumPoleTopSpace=o.minTopSpace),typeof o.roadClearance=="number"&&(r.roadClearance=o.roadClearance),typeof o.commToPower=="number"&&(r.powerClearanceDistribution=o.commToPower),r}function _e(e,a=[],o="",{useTickMarks:r=!1}={}){var m;if(!e)return"";const t=[],l=r?te:$;return t.push("Section,Field,Value"),t.push(`Pole,Height,${l(e.pole.inputHeight)}`),t.push(`Pole,Buried,${l(e.pole.buriedFt)}`),t.push(`Pole,Above Ground,${l(e.pole.aboveGroundFt)}`),e.pole.latitude!=null&&e.pole.longitude!=null&&(t.push(`Pole,Latitude,${e.pole.latitude}`),t.push(`Pole,Longitude,${e.pole.longitude}`)),t.push(`Attach,Proposed,${r?te(e.attach.proposedAttachFt):e.attach.proposedAttachFmt}`),(m=e.attach)!=null&&m.recommendation&&(t.push(`Attach,Rule Basis,${e.attach.recommendation.basis}`),t.push(`Attach,Rule Detail,${e.attach.recommendation.detail}`),e.attach.recommendation.clearanceIn!=null&&t.push(`Attach,Owner Clearance (in),${e.attach.recommendation.clearanceIn}`)),t.push(`Span,Length,${e.span.spanFt} ft`),t.push(`Span,Wind,${e.span.wind} mph`),t.push(`Span,Sag,${r?te(e.span.sagFt):e.span.sagFmt}`),t.push(`Span,Midspan,${r?te(e.span.midspanFt):e.span.midspanFmt}`),t.push(`Clearances,Ground Target,${l(e.clearances.groundClearance)}`),t.push(`Clearances,Road Target,${l(e.clearances.roadClearance)}`),e.makeReadyTotal!=null&&t.push(`Make-ready,Total,$${e.makeReadyTotal}`),e.guy&&(t.push(`Guying,Required,${e.guy.required?"Yes":"No"}`),t.push(`Guying,Tension,${Math.round(e.guy.tension||0)} lb`),t.push(`Guying,Angle,${Math.round(e.guy.angle||0)} deg`)),a!=null&&a.length&&t.push(`Warnings,Count,${a.length}`),o&&t.push(`Notes,Make-ready,"${o.replace(/"/g,'""')}"`),t.join(`
`)}function Te(e,a=""){const o=Number(e)||0,r=Math.max(5,o*.1+2),t=Math.max(0,o-r),l=o<=30?"Class 6 typical":o<=35?"Class 4-5 typical":o<=40?"Class 3-4 typical":o<=45?"Class 2-3 typical":"Class 1-2 typical";return{buried:r,aboveGround:t,classInfo:a||l,recommendedClass:l}}function We(e,a,o,r=90,t=.5,l=0){const m=Number(e)||0,g=Math.max(1,Number(o)||1200),b=Math.max(0,(Number(t)||.5)+2*(Number(l)||0))/12,H=Math.max(0,Number(a)||.1),G=.00256*Math.pow(Math.max(0,Number(r)||0),2)*b;return Math.sqrt(H*H+G*G)*m*m/(8*g)}function Ve(e,a,o,r,t=90,l=0){if(!o||!r||!a)return null;const m=Number(a)||0,g=Number(r)||0,b=Number(t)||0,H=o.tension||1500,G=.00256*Math.pow(b,2)*((o.diameter||.6)/12)*g,z=H*.1+G,T=Math.max(1,Number(e)||1)*.85,O=T*.5,W=z*m/Math.max(1,T),ae=Math.atan(T/Math.max(.1,O))*(180/Math.PI),p=W>500,Y=p?350+Math.min(650,Math.round(W/10)):0;return{required:p,tension:W,angle:ae,leadDistance:O,guyHeight:T,pullDirection:l,totalCost:Y}}function Je(e){var Ce,Ne;const{poleHeight:a,poleClass:o,poleLatitude:r,poleLongitude:t,adjacentPoleLatitude:l,adjacentPoleLongitude:m,existingPowerHeight:g,existingPowerVoltage:b="distribution",spanDistance:H,isNewConstruction:B,adjacentPoleHeight:G,adjacentPowerHeight:z,adjacentProposedAttachFt:T,attachmentType:O,cableDiameter:W,windSpeed:ae,spanEnvironment:p="road",dripLoopHeight:Y,proposedLineHeight:Se,existingLines:S=[],iceThicknessIn:Pe,hasTransformer:le,presetProfile:oe,customMinTopSpace:ue,customRoadClearance:me,customCommToPower:pe,powerReference:ve,jobOwner:Ie,submissionProfile:q}=e||{},_={};if(a||(_.poleHeight="Pole height required for analysis"),!B&&!g&&b!=="communication"&&(_.existingPowerHeight="Power wire height required for existing pole analysis"),Object.keys(_).length)return{errors:_};const P=Te(Number(a)||0,o),J=ce.cableTypes.find(n=>n.value===O)||ce.cableTypes[0];let v=Number(H)||0;if(!v&&Number.isFinite(Number(r))&&Number.isFinite(Number(t))&&Number.isFinite(Number(l))&&Number.isFinite(Number(m))){const n=A=>Number(A)*Math.PI/180,u=Number(r),x=Number(t),s=Number(l),y=Number(m),D=n(s-u),F=n(y-x),C=Math.sin(D/2)**2+Math.cos(n(u))*Math.cos(n(s))*Math.sin(F/2)**2;v=6371e3*(2*Math.atan2(Math.sqrt(C),Math.sqrt(1-C)))*3.28084}const ie=Number(ae)||90,de=Number(G)||0,h=N(Se),he=N(Y),xe=(S||[]).map(n=>String((n==null?void 0:n.companyName)||"").toLowerCase()).filter(Boolean),De=oe==="firstEnergy"||oe==="firstEnergyMonPower",Le=xe.some(n=>$e.some(c=>n.includes(c))),fe=String(Ie||"").toLowerCase(),Re=fe?$e.some(n=>fe.includes(n)):!1,U=De||Le||Re;let i=Be(b,p);if(i=Oe(i,oe),U&&(i.powerClearanceDistribution=Math.max(i.powerClearanceDistribution||0,44/12),i.minimumPoleTopSpace=Math.max(i.minimumPoleTopSpace||0,2),p==="road"&&(i.groundClearance=Math.max(i.groundClearance||0,18))),q&&typeof q=="object"){const{commToPowerIn:n,minTopSpaceFt:c,roadClearanceFt:u,envRoadFt:x,envResidentialFt:s,envPedestrianFt:y,envFieldFt:D,envResidentialYardFt:F,envResidentialDrivewayFt:C,envNonResidentialDrivewayFt:L,envWaterwayFt:R,envWVHighwayFt:A,envInterstateFt:ne,envInterstateNewCrossingFt:ye,envRailroadFt:Fe}=q;Number.isFinite(n)&&(i.powerClearanceDistribution=Math.max(i.powerClearanceDistribution||0,Number(n)/12)),Number.isFinite(c)&&(i.minimumPoleTopSpace=Math.max(i.minimumPoleTopSpace||0,Number(c))),Number.isFinite(u)&&p==="road"&&(i.groundClearance=Math.max(i.groundClearance||0,Number(u))),p==="road"&&Number.isFinite(x)&&(i.groundClearance=Number(x)),p==="residential"&&Number.isFinite(s)&&(i.groundClearance=Number(s)),p==="pedestrian"&&Number.isFinite(y)&&(i.groundClearance=Number(y)),p==="field"&&Number.isFinite(D)&&(i.groundClearance=Number(D)),p==="residentialYard"&&Number.isFinite(F)&&(i.groundClearance=Number(F)),p==="residentialDriveway"&&Number.isFinite(C)&&(i.groundClearance=Number(C)),p==="waterway"&&Number.isFinite(R)&&(i.groundClearance=Number(R)),p==="wvHighway"&&Number.isFinite(A)&&(i.groundClearance=Number(A)),p==="interstate"&&Number.isFinite(ne)&&(i.groundClearance=Number(ne)),p==="interstateNewCrossing"&&Number.isFinite(ye)&&(i.groundClearance=Number(ye)),p==="nonResidentialDriveway"&&Number.isFinite(L)&&(i.groundClearance=Number(L)),p==="railroad"&&Number.isFinite(Fe)&&(i.groundClearance=Number(Fe))}ue&&(i.minimumPoleTopSpace=Number(ue)||i.minimumPoleTopSpace),me&&(i.roadClearance=Number(me)||i.roadClearance),pe&&(i.powerClearanceDistribution=Number(pe)||i.powerClearanceDistribution);let w=[],M=[],E=0;const Q=[],X=(n,c)=>{const u=N(n);u!=null&&Number.isFinite(u)&&u>0&&Q.push({name:c,ft:u})};X(g,"power conductor"),X(Y,"drip loop");for(const n of S||[]){const c=String((n==null?void 0:n.type)||"").toLowerCase();c.includes("neutral")&&X(n==null?void 0:n.height,"neutral"),c.includes("secondary")&&X(n==null?void 0:n.height,"secondary")}Q.sort((n,c)=>n.ft-c.ft);let d=null;const Z=n=>Q.find(c=>c.name===n)||null;switch(ve||"auto"){case"neutral":d=Z("neutral");break;case"secondary":d=Z("secondary");break;case"dripLoop":d=Z("drip loop");break;case"power":d=Z("power conductor");break;default:d=Q[0]||null;break}const re=!!d,Ee=(S||[]).some(n=>String((n==null?void 0:n.type)||"").toLowerCase().includes("communication")&&String((n==null?void 0:n.companyName)||"").trim().length>0),Ae=!re&&(b==="communication"||Ee),ge=b==="transmission"?i.powerClearanceTransmission||0:i.powerClearanceDistribution||0,He=b==="transmission"?ge:U?44/12:40/12,K=Math.max(ge,He),k=Math.round(K*12);let f=null,V=null;if(Ae)f=Math.max(0,P.aboveGround-1),V={basis:"owner-comm/no-power",detail:"1ft below pole top (comm owner, no power measurements)",clearanceIn:12,controlling:{name:"pole top",ft:P.aboveGround}},M.push("Owner rule: No power measurements provided and communication company present — setting proposed attach 1ft below pole top."),E+=B?150:200;else if(re)f=d.ft-K,V={basis:b==="transmission"?"NESC-transmission":U?"FE":"NESC",detail:`${k}" below ${d.name}`,clearanceIn:k,controlling:d},M.push(`Owner rule: ${k}" below ${d.name} (${$(d.ft)} → attach at ${$(f)})`),E+=200;else if(B)f=P.aboveGround-i.minimumPoleTopSpace,V={basis:"new-construction",detail:`${Math.round(i.minimumPoleTopSpace*12)}" below pole top`,clearanceIn:Math.round(i.minimumPoleTopSpace*12),controlling:{name:"pole top",ft:P.aboveGround}},M.push(`New construction: attach ${$(i.minimumPoleTopSpace)} below pole top`),E+=150;else{const n=b==="transmission"?i.powerClearanceTransmission:i.powerClearanceDistribution,c=N(g);f=(c!=null?c:0)-n,V={basis:"voltage-default",detail:`${Math.round((n||0)*12)}" below power conductor`,clearanceIn:Math.round((n||0)*12),controlling:{name:"power conductor",ft:c||0}},M.push(`Default rule: ${Math.round((n||0)*12)}" below power conductor`),E+=200}if(q&&Number.isFinite(q.minCommAttachFt)&&f!=null){const n=Number(q.minCommAttachFt),c=re?d.ft-K:1/0,u=Math.min(Math.max(f,n),c);u!==f&&(M.push(`Applied min communications attach height constraint: ${$(n)} (clamped to maintain required separation if needed)`),f=u)}le&&(M.push("Transformer present: add clearance review and potential construction complexity"),E+=300);let ee=0,I=null;if(v>0&&de>0&&f!=null){ee=We(v,J.weight,J.tension,ie,W||J.diameter,Number(Pe)||0);const n=Te(de);let c=null;if(T!=null&&Number.isFinite(Number(T))&&(c=Number(T)),c==null){const u=N(z);u!=null&&(c=u-K)}c==null&&(c=Math.max(0,n.aboveGround-i.minimumPoleTopSpace)),I=(f+c)/2-ee,I<i.groundClearance&&w.push(`CRITICAL: midspan ${$(I)} < min ground clearance ${$(i.groundClearance)}`),v>300&&(w.push("Spans > 300 ft require special engineering and utility approval"),E+=500),v>150&&String(O||"").includes("communication")&&w.push("Communication cable spans >150 ft may require intermediate support")}if(h!=null&&he!=null){const n=(he-h)*12,c=k;n<c&&(w.push(`Comm-to-Drip Loop at pole: ${n.toFixed(1)}" (need ${c}")`),le&&M.push("Owner last‑resort: tuck drip loop to ~1ft above bottom of transformer to regain clearance (utility approval required)."))}if(U){const n=k;if(h!=null&&(d!=null&&d.name)){const s=(d.ft-h)*12;s<n&&w.push(`Comm-to-${d.name} at pole: ${s.toFixed(1)}" (need ${n}")`)}const c=(Ce=(S||[]).find(s=>String((s==null?void 0:s.type)||"").toLowerCase().includes("transformer")))!=null&&Ce.height?N((S||[]).find(s=>String((s==null?void 0:s.type)||"").toLowerCase().includes("transformer")).height):null;if(h!=null&&c!=null){const s=(c-h)*12;s<30&&w.push(`Comm-to-Transformer bottom: ${s.toFixed(1)}" (need 30")`)}const u=N(e==null?void 0:e.streetLightHeight);if(h!=null&&u!=null){const y=(u-h)*12;y<20&&w.push(`Comm-to-Street Light: ${y.toFixed(1)}" (need 20")`)}const x=(Ne=(S||[]).find(s=>String((s==null?void 0:s.type)||"").toLowerCase().includes("street light drip")))!=null&&Ne.height?N((S||[]).find(s=>String((s==null?void 0:s.type)||"").toLowerCase().includes("street light drip")).height):null;if(h!=null&&x!=null){const s=(x-h)*12;s<12&&w.push(`Comm-to-Street Light Drip: ${s.toFixed(1)}" (need 12")`)}if(h!=null&&u!=null&&h>u){const s=(h-u)*12;s<4&&w.push(`Comm above Street Light: ${s.toFixed(1)}" (need 4")`)}if(I!=null)for(const s of S||[]){const y=String((s==null?void 0:s.type)||"").toLowerCase();if(y.includes("communication")){const D=N(s==null?void 0:s.height);if(D!=null){const F=Math.abs((I-D)*12),C=y.includes("drop"),L=C?4:12;F<L&&w.push(`Midspan comm-to-comm (${C?"drop":"main"}): ${F.toFixed(1)}" (need ${L}")`)}}}p==="railroad"&&M.push("Railroad crossing: target 27 ft minimum ground clearance."),(p==="wvHighway"||p==="road")&&M.push("State roads/highways: 18 ft minimum; Interstate 21 ft for new crossings.")}let be=0;h!=null&&S.forEach(n=>{if(!(n!=null&&n.type))return;const c=n.makeReady&&n.makeReadyHeight?N(n.makeReadyHeight):N(n.height);if(c==null)return;const u=c*12,x=h*12,s=String(n.type).toLowerCase().includes("drop"),y=String(n.type).toLowerCase().includes("neutral"),D=String(n.type).toLowerCase().includes("secondary");let F=12,C=9;s?(F=6,C=4):(y||D)&&(F=k,C=15);const L=x-u;if(L<F&&w.push(`Pole clearance to ${n.type}: ${L.toFixed(1)}" (need ${F}")`),I!=null){const R=I*12-u;R<C&&w.push(`Midspan clearance to ${n.type}: ${R.toFixed(1)}" (need ${C}")`)}if(n.makeReady&&n.makeReadyHeight&&n.height){const R=N(n.height),A=N(n.makeReadyHeight);if(R!=null&&A!=null){const ne=(A-R)*12;be+=Math.abs(Math.round(ne))*12.5}}});let j=null;v>0&&P.aboveGround>0&&f&&(j=Ve(P.aboveGround,f,J,v,ie),j!=null&&j.required&&(M.push("Down-guy likely required based on span and wind loading"),E+=j.totalCost||0));const we={pole:{inputHeight:Number(a)||0,buriedFt:P.buried,aboveGroundFt:P.aboveGround,classInfo:P.classInfo,latitude:r!=null?r:null,longitude:t!=null?t:null},attach:{proposedAttachFt:f,proposedAttachFmt:$(f),recommendation:V},span:{spanFt:v,wind:ie,sagFt:ee,sagFmt:$(ee),midspanFt:I,midspanFmt:$(I)},clearances:i,makeReadyTotal:be,guy:j},Ge=(E||0)+(we.makeReadyTotal||0);return{results:we,warnings:w,notes:M,cost:Ge}}export{ce as D,te as a,Ye as b,Je as c,ze as d,Oe as e,$ as f,Be as g,N as p,_e as r};
//# sourceMappingURL=app-calculations-BTm-MLQ7.js.map

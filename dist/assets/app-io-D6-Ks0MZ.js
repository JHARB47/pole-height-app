const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/zip-utils-BoTj1NZG.js","assets/polyfills-CELajPCl.js","assets/vendor-Cv8-97MN.js","assets/app-utils-BDwnIIkN.js","assets/app-calculations-BTm-MLQ7.js","assets/state-vendor-C5Drl_aA.js","assets/react-CcDwFy_c.js","assets/react-dom-CAPYOVrm.js","assets/app-calculator-BxQMOd7r.js","assets/app-editors-DF1OQL1O.js","assets/app-geodata-OF3I9fsg.js","assets/app-diagrams-CPhSrkc4.js","assets/app-permits-Dftu4pdj.js"])))=>i.map(i=>d[i]);
import{_ as T}from"./app-calculator-BxQMOd7r.js";import{a as P}from"./vendor-Cv8-97MN.js";const $=[{label:"Generic (CSV/GeoJSON/KML)",value:"generic"},{label:"ArcGIS (example)",value:"arcgis"},{label:"ikeGPS (example)",value:"ikegps"},{label:"Katapult Pro (example)",value:"katapultPro"},{label:"FirstEnergy Joint-Use (example)",value:"firstEnergy"}];function _(t){return Number.isFinite(t)?Number(t.toFixed(3)):""}function E({rows:t,headers:e}){const s=[e.join(",")];for(const r of t)s.push(e.map(n=>{var o;return(o=r[n])!=null?o:""}).join(","));return s.join(`
`)}function L(t=[]){const e=["id","label","latitude","longitude","height_ft","class","attach_height_ft","bearing_deg","pull_ft","notes"],s=t.map(r=>({id:r.id,label:r.label,latitude:_(r.lat),longitude:_(r.lng),height_ft:_(r.heightFt),class:r.class||"",attach_height_ft:_(r.attachHeightFt),bearing_deg:_(r.bearingDeg),pull_ft:_(r.pullFt),notes:r.notes||""}));return E({rows:s,headers:e})}function K(t=[]){return L(t)}function b(t=[]){const e=["id","from_pole_id","to_pole_id","length_ft","sag_ft","midspan_height_ft"],s=t.map(r=>({id:r.id,from_pole_id:r.fromPoleId,to_pole_id:r.toPoleId,length_ft:_(r.lengthFt),sag_ft:_(r.sagFt),midspan_height_ft:_(r.midspanHeightFt)}));return E({rows:s,headers:e})}function W(t=[]){return b(t)}function w(t=[]){const e=["id","type","latitude","longitude","height_ft","notes"],s=t.map(r=>({id:r.id,type:r.type||"",latitude:_(r.lat),longitude:_(r.lng),height_ft:_(r.heightFt),notes:r.notes||""}));return E({rows:s,headers:e})}function Y(t=[]){return w(t)}function H({poles:t=[],spans:e=[],existingLines:s=[]}){const r=[];for(const n of t)r.push({type:"Feature",geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:{id:n.id,label:n.label,height_ft:n.heightFt,attach_height_ft:n.attachHeightFt,bearing_deg:n.bearingDeg,pull_ft:n.pullFt}});for(const n of e)n.coordinates&&n.coordinates.length===2&&r.push({type:"Feature",geometry:{type:"LineString",coordinates:n.coordinates.map(o=>[o.lng,o.lat])},properties:{id:n.id,from:n.fromPoleId,to:n.toPoleId,length_ft:n.lengthFt}});for(const n of s)r.push({type:"Feature",geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:{id:n.id,type:n.type}});return{type:"FeatureCollection",features:r}}function J(t={}){return H(t)}function Z({poles:t=[],spans:e=[],name:s="Export"}){const r=o=>String(o!=null?o:"").replace(/[&<>]/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;"})[a]),n=['<?xml version="1.0" encoding="UTF-8"?>','<kml xmlns="http://www.opengis.net/kml/2.2">',`<Document><name>${r(s)}</name>`];for(const o of t)n.push("<Placemark>",`<name>${r(o.label||o.id)}</name>`,`<Point><coordinates>${o.lng},${o.lat},0</coordinates></Point>`,"</Placemark>");for(const o of e)if(o.coordinates&&o.coordinates.length===2){const[a,i]=o.coordinates;n.push("<Placemark>",`<name>Span ${r(o.id)}</name>`,`<LineString><coordinates>${a.lng},${a.lat},0 ${i.lng},${i.lat},0</coordinates></LineString>`,"</Placemark>")}return n.push("</Document></kml>"),n.join("")}function z({cachedMidspans:t=[],job:e={}}){const s=["job_name","span_id","length_ft","sag_ft","midspan_height_ft"],r=t.map(n=>({job_name:e.name||"",span_id:n.id,length_ft:_(n.lengthFt),sag_ft:_(n.sagFt),midspan_height_ft:_(n.midspanHeightFt)}));return E({rows:r,headers:s})}const U=[{label:"Generic (id,height,class,length,attach)",value:"generic",mapping:{pole:{id:"id",height:"height",class:"class",powerHeight:"power_ht",hasTransformer:"xfmr",latitude:"",longitude:""},span:{id:"id",fromId:"from_id",toId:"to_id",length:"length",proposedAttach:"attach"},line:{type:"type",height:"height",company:"company",makeReady:"mr",makeReadyHeight:"mr_height"}}},{label:"FirstEnergy sample",value:"firstEnergy",mapping:{pole:{id:"POLE_ID",height:"HGT_FT",class:"CLASS",powerHeight:"PWR_HT",hasTransformer:"XFMR",latitude:"",longitude:""},span:{id:"SPAN_ID",fromId:"FROM_ID",toId:"TO_ID",length:"SPAN_FT",proposedAttach:"ATTACH_FT"},line:{type:"TYPE",height:"HGT_FT",company:"COMPANY",makeReady:"MR",makeReadyHeight:"MR_HGT"}}},{label:"ArcGIS Hosted Feature Layer (example)",value:"arcgis",mapping:{pole:{id:"POLE_ID",height:"HEIGHT_FT",class:"CLASS",powerHeight:"PWR_HT",hasTransformer:"XFMR",latitude:"LATITUDE",longitude:"LONGITUDE"},span:{id:"SPAN_ID",fromId:"FROM_ID",toId:"TO_ID",length:"SPAN_FT",proposedAttach:"ATTACH_FT"},line:{type:"LINE_TYPE",height:"LINE_HT",company:"OWNER",makeReady:"MAKE_READY",makeReadyHeight:"NEW_HT"}}},{label:"ikeGPS (example)",value:"ikegps",mapping:{pole:{id:"POLE_ID",height:"POLE_HEIGHT_FT",class:"POLE_CLASS",powerHeight:"PRIMARY_HT_FT",hasTransformer:"TRANSFORMER",latitude:"LAT",longitude:"LON"},span:{id:"SPAN_ID",fromId:"FROM_ID",toId:"TO_ID",length:"SPAN_FT",proposedAttach:"ATTACH_FT"},line:{type:"LINE_TYPE",height:"LINE_HT",company:"COMPANY",makeReady:"MAKE_READY",makeReadyHeight:"NEW_HT"}}},{label:"Katapult Pro Maps (example)",value:"katapultPro",mapping:{pole:{id:"ID",height:"HEIGHT_FT",class:"CLASS",powerHeight:"PRIMARY_HT",hasTransformer:"XFMR",latitude:"LAT",longitude:"LON"},span:{id:"SPAN_ID",fromId:"FROM_ID",toId:"TO_ID",length:"SPAN_FT",proposedAttach:"ATTACH_FT"},line:{type:"TYPE",height:"HGT_FT",company:"OWNER",makeReady:"MAKE_READY",makeReadyHeight:"NEW_HT"}}},{label:"PSE sample",value:"pse",mapping:{pole:{id:"POLE",height:"HEIGHT",class:"CLASS",powerHeight:"PRIMARY_HT",hasTransformer:"TRANSFORMER",latitude:"",longitude:""},span:{id:"SPAN",fromId:"FROM_POLE",toId:"TO_POLE",length:"LENGTH_FT",proposedAttach:"PROPOSED_FT"},line:{type:"LINE_TYPE",height:"LINE_HT",company:"OWNER",makeReady:"MAKE_READY",makeReadyHeight:"NEW_HT"}}}];async function j(t){const e=((t==null?void 0:t.name)||"").toLowerCase();if(e.endsWith(".kml"))return R(await t.text());if(e.endsWith(".kmz"))return N(t);if(e.endsWith(".zip")||e.endsWith(".shp")||e.endsWith(".dbf"))return k(t);throw new Error("Unsupported file format. Please provide KML, KMZ, or Shapefile (.zip).")}async function R(t){try{const{kml:e}=await T(async()=>{const{kml:n}=await import("./geojson-utils-BtwwIPdU.js");return{kml:n}},[]),s=new DOMParser().parseFromString(t,"text/xml"),r=e(s);return I(r)}catch(e){throw console.error("Error parsing KML, dependency may be missing",e),new Error('KML parsing requires dependency "@tmcw/togeojson". Error: '+e.message)}}async function N(t){try{const s=await(await T(async()=>{const{default:o}=await import("./zip-utils-BoTj1NZG.js").then(a=>a.j);return{default:o}},__vite__mapDeps([0,1]))).default.loadAsync(t),r=Object.values(s.files).find(o=>o.name.toLowerCase().endsWith(".kml"));if(!r)throw new Error("KMZ missing KML file");const n=await r.async("text");return R(n)}catch(e){throw console.error("Error parsing KMZ, dependency may be missing",e),new Error('KMZ parsing requires dependency "jszip". Error: '+e.message)}}async function k(t){try{const e=await t.arrayBuffer(),s=(await T(async()=>{const{default:n}=await import("./vendor-Cv8-97MN.js").then(o=>o.w);return{default:n}},__vite__mapDeps([2,1]))).default,r=await s(e);return I(r)}catch(e){throw console.error("Error parsing shapefile, dependency may be missing",e),new Error('Shapefile parsing requires optional dependency "shpjs". Error: '+e.message)}}function I(t){return t?t.type==="FeatureCollection"?t:t.type==="Feature"?{type:"FeatureCollection",features:[t]}:Array.isArray(t)?{type:"FeatureCollection",features:t.flatMap(s=>(s==null?void 0:s.features)||[])}:{type:"FeatureCollection",features:[]}:{type:"FeatureCollection",features:[]}}function O(t){var n;const e=[],s=[],r=[];for(const o of t.features||[]){const a=(n=o.geometry)==null?void 0:n.type;a==="Point"?e.push(o):a==="LineString"||a==="MultiLineString"?s.push(o):r.push(o)}return{poles:e,lines:s,others:r}}function q(t){return Object.keys((t==null?void 0:t.properties)||{})}function X(t,e){var o,a,i,c,u,d,f;const{poles:s,lines:r}=O(t),n={poleTable:[],spanTable:[],existingLines:[]};for(const h of s){const l=h.properties||{},m=(e==null?void 0:e.pole)||{};n.poleTable.push({id:y(l,m.id),latitude:(i=(a=(o=h.geometry)==null?void 0:o.coordinates)==null?void 0:a[1])!=null?i:null,longitude:(d=(u=(c=h.geometry)==null?void 0:c.coordinates)==null?void 0:u[0])!=null?d:null,height:g(l,m.height),class:y(l,m.class),powerHeight:g(l,m.powerHeight),hasTransformer:p(l,m.hasTransformer)})}for(const h of r){const l=h.properties||{},m=(e==null?void 0:e.span)||{};n.spanTable.push({id:y(l,m.id),fromId:y(l,m.fromId),toId:y(l,m.toId),length:(f=g(l,m.length))!=null?f:C(h),proposedAttach:g(l,m.proposedAttach)})}for(const h of[...s,...r]){const l=h.properties||{},m=(e==null?void 0:e.line)||{},A=y(l,m.type),F=g(l,m.height);!A&&F==null||n.existingLines.push({type:A||"communication",height:F!=null?`${F}`:"",companyName:y(l,m.company)||"",makeReady:p(l,m.makeReady),makeReadyHeight:D(l,m.makeReadyHeight)})}return n}function y(t,e){if(e)return t&&Object.hasOwn(t,e)?t[e]:void 0}function g(t,e){if(!e)return;const s=t==null?void 0:t[e],r=S(s);return Number.isFinite(r)?r:void 0}function D(t,e){const s=g(t,e);return Number.isFinite(s)?`${s}`:""}function p(t,e){if(!e)return!1;const s=t==null?void 0:t[e];return typeof s=="boolean"?s:typeof s=="number"?s!==0:typeof s=="string"?/^(y|yes|true|1)$/i.test(s.trim()):!1}function C(t){try{const e=t.geometry;if(!e)return;const s=[];if(e.type==="LineString")s.push(e.coordinates);else if(e.type==="MultiLineString")for(const i of e.coordinates||[])s.push(i);else return;const r=i=>i*Math.PI/180,n=6371e3,o=(i,c,u,d)=>{const f=r(d-c),h=r(u-i),l=Math.sin(f/2)**2+Math.cos(r(c))*Math.cos(r(d))*Math.sin(h/2)**2,m=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));return n*m};let a=0;for(const i of s)for(let c=1;c<i.length;c++){const[u,d]=i[c-1],[f,h]=i[c];a+=o(u,d,f,h)}return a*3.28084}catch{return}}function S(t){if(t==null)return;if(typeof t=="number")return Number.isFinite(t)?t:void 0;let e=String(t).trim();if(!e)return;let s=!1;e.startsWith("(")&&e.endsWith(")")&&(s=!0,e=e.slice(1,-1).trim()),e=e.replace(/[’′]/g,"'").replace(/[“”″]/g,'"').replace(/°/g,""),e=e.replace(/\b(ft|feet|m|meter|meters)\b/gi,""),e=e.replace(/\s+/g,"");const r=e.match(/^(-?\d+)'(\d+(?:\.\d+)?)"?$/);if(r){const c=parseFloat(r[1]),u=parseFloat(r[2]),d=c+u/12;return s?-Math.abs(d):d}let n=1;/^[+-]/.test(e)&&(n=e[0]==="-"?-1:1,e=e.slice(1)),/^\d{1,3}(,\d{3})+(\.\d+)?$/.test(e)?e=e.replace(/,/g,""):/^\d{1,3}(\.\d{3})+(,\d+)?$/.test(e)?(e=e.replace(/\./g,""),/,\d+$/.test(e)&&(e=e.replace(",","."))):/^\d+,\d+$/.test(e)?e=e.replace(",","."):e=e.replace(/,(?=\d{3}(\D|$))/g,""),e=e.replace(/["']/g,"");const o=parseFloat(e);if(!Number.isFinite(o))return;const a=o*n;return s?-Math.abs(a):a}function B(t,e){const s=P.parse(t||"",{header:!0,skipEmptyLines:"greedy",dynamicTyping:!1});return(Array.isArray(s.data)?s.data:[]).map(n=>{const o=(c,u)=>{const d=c||u,f=d?n[d]:"";return typeof f=="string"?f.trim():f},a=o(e==null?void 0:e.height,"height"),i=S(a);return{type:o(e==null?void 0:e.type,"type")||"communication",height:Number.isFinite(i)?String(i):String(a||""),companyName:o(e==null?void 0:e.company,"company")||"",makeReady:/^(y|yes|true|1)$/i.test(String(o(e==null?void 0:e.makeReady,"makeReady")||"")),makeReadyHeight:String(o(e==null?void 0:e.makeReadyHeight,"makeReadyHeight")||"")}})}function v(t,e){const s=P.parse(t||"",{header:!0,skipEmptyLines:"greedy",dynamicTyping:!1});return(Array.isArray(s.data)?s.data:[]).map(n=>{var i,c;const o=(u,d)=>{const f=u||d,h=f?n[f]:"";return typeof h=="string"?h.trim():h},a=(u,d)=>{const f=o(u,d);if(f===""||f==null)return;const h=S(f);return Number.isFinite(h)?h:void 0};return{id:String(o(e==null?void 0:e.id,"id")||""),latitude:(i=a(e==null?void 0:e.latitude,"latitude"))!=null?i:null,longitude:(c=a(e==null?void 0:e.longitude,"longitude"))!=null?c:null,height:a(e==null?void 0:e.height,"height"),class:o(e==null?void 0:e.class,"class")||void 0,powerHeight:a(e==null?void 0:e.powerHeight,"power_ht"),hasTransformer:/^(y|yes|true|1)$/i.test(String(o(e==null?void 0:e.hasTransformer,"xfmr")||""))}})}function G(t,e){const s=P.parse(t||"",{header:!0,skipEmptyLines:"greedy",dynamicTyping:!1});return(Array.isArray(s.data)?s.data:[]).map(n=>{const o=(i,c)=>{const u=i||c,d=u?n[u]:"";return typeof d=="string"?d.trim():d},a=(i,c)=>{const u=o(i,c);if(u===""||u==null)return;const d=S(u);return Number.isFinite(d)?d:void 0};return{id:String(o(e==null?void 0:e.id,"id")||""),fromId:String(o(e==null?void 0:e.fromId,"from_id")||""),toId:String(o(e==null?void 0:e.toId,"to_id")||""),length:a(e==null?void 0:e.length,"length"),proposedAttach:a(e==null?void 0:e.proposedAttach,"attach")}})}async function Q(t,e){const s=v(t,e);try{const r=await T(()=>import("./app-utils-BDwnIIkN.js").then(n=>n.a),__vite__mapDeps([3,4,5,6,7,1,2,8,9,10,0,11,12]));if(r&&typeof r.validatePoles=="function"){const{errors:n,data:o}=r.validatePoles(s);return{data:o,errors:n}}}catch{}return{data:s,errors:[]}}async function M(t,e){const s=G(t,e);try{const r=await T(()=>import("./app-utils-BDwnIIkN.js").then(n=>n.a),__vite__mapDeps([3,4,5,6,7,1,2,8,9,10,0,11,12]));if(r&&typeof r.validateSpans=="function"){const{errors:n,data:o}=r.validateSpans(s);return{data:o,errors:n}}}catch{}return{data:s,errors:[]}}export{$ as E,U as M,Q as a,G as b,M as c,B as d,K as e,W as f,q as g,Y as h,j as i,z as j,J as k,Z as l,X as m,v as p,O as s};
//# sourceMappingURL=app-io-D6-Ks0MZ.js.map
